<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="gold">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>FITPULSE PRO</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#07090F">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon-192.png">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&family=Tajawal:wght@300;400;700;900&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
<style>
/* === THEMES === */
:root{--g:#D4A843;--gl:#F2C95C;--gd:#A07820;--n:#07090F;--d:#0D1120;--c:#111827;--c2:#162035;--t:#EDE8DA;--dim:#6B6357;--green:#1DB954;--red:#E74C3C;--blue:#2980B9;--orange:#F39C12;--r:14px;--rs:9px}
[data-theme=fire]{--g:#E85D04;--gl:#F48C06;--gd:#DC2F02;--n:#0D0500;--d:#160A00;--c:#1E0F00;--c2:#2A1500;--t:#FFF3E0;--dim:#7A5C3A}
[data-theme=ocean]{--g:#0096C7;--gl:#00B4D8;--gd:#023E8A;--n:#00070F;--d:#000D1A;--c:#001529;--c2:#00203F;--t:#CAF0F8;--dim:#4A7B8C;--green:#06D6A0;--red:#EF233C}
[data-theme=nature]{--g:#2D6A4F;--gl:#52B788;--gd:#1B4332;--n:#020A05;--d:#071A0E;--c:#0D2818;--c2:#143620;--t:#D8F3DC;--dim:#4A7C5A;--green:#95D5B2}
[data-theme=neon]{--g:#F900BF;--gl:#FF6FD8;--gd:#C500A3;--n:#050008;--d:#0A0012;--c:#12001F;--c2:#1A002E;--t:#FFE8FF;--dim:#7A4A80;--green:#00FFC6;--red:#FF2D55}
[data-theme=light]{--g:#B8860B;--gl:#DAA520;--gd:#8B6914;--n:#F5F0E8;--d:#EDE8DC;--c:#FFFFFF;--c2:#F0EBE0;--t:#1A1208;--dim:#8A7A6A;--green:#16A34A;--red:#DC2626}
[data-theme=purple]{--g:#9D4EDD;--gl:#C77DFF;--gd:#7B2FBE;--n:#07000F;--d:#0F0019;--c:#180028;--c2:#220038;--t:#F0E6FF;--dim:#6A4A80;--green:#06D6A0}
/* === RESET === */
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{min-height:100%;overflow-x:hidden}
body{font-family:'Cairo',sans-serif;background:var(--n);color:var(--t);transition:background .4s,color .4s}
button{font-family:'Cairo',sans-serif;cursor:pointer;border:none;background:none}
input,select,textarea{font-family:'Cairo',sans-serif}
/* === ANIMATIONS === */
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes pop{0%{transform:scale(.4);opacity:0}70%{transform:scale(1.1)}100%{transform:scale(1);opacity:1}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
@keyframes glow{from{filter:drop-shadow(0 0 6px rgba(212,168,67,.3))}to{filter:drop-shadow(0 0 22px rgba(212,168,67,.9))}}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
@keyframes burn{0%,100%{color:var(--gl)}50%{color:var(--red)}}
@keyframes confetti{0%{transform:translateY(-10px) rotate(0);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
@keyframes countIn{from{transform:scale(1.8);opacity:0}to{transform:scale(1);opacity:1}}
@keyframes tw{from{opacity:.15;transform:scale(.7)}to{opacity:.9;transform:scale(1.3)}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
@keyframes badgePop{0%{transform:translateX(-50%) translateY(-80px)}100%{transform:translateX(-50%) translateY(0)}}
/* === STARS === */
.stars{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
.star{position:absolute;border-radius:50%;animation:tw var(--d) ease-in-out infinite alternate}
/* === LAYOUT === */
#app{position:relative;z-index:1;padding-bottom:80px;min-height:100vh}
.view{display:none;padding:14px;animation:fadeUp .35s ease}
.view.active{display:block}
/* === ONBOARDING === */
#ob{position:fixed;inset:0;background:var(--n);z-index:900;display:flex;flex-direction:column;align-items:center;overflow-y:auto;padding-bottom:40px}
#ob.gone{display:none}
.ob-dots{display:flex;gap:5px;padding:20px 24px 0;width:100%;max-width:460px}
.ob-dot{flex:1;height:4px;border-radius:2px;background:rgba(212,168,67,.15);transition:.4s}
.ob-dot.on{background:var(--gl);animation:pulse 1s infinite}
.ob-dot.past{background:var(--g)}
.ob-pg{display:none;width:100%;max-width:460px;padding:24px}
.ob-pg.on{display:block;animation:fadeUp .4s ease}
.ob-ico{font-size:52px;text-align:center;margin-bottom:14px;display:block;animation:glow 3s infinite alternate}
.ob-h{font-family:'Tajawal',sans-serif;font-size:26px;font-weight:900;text-align:center;margin-bottom:6px;background:linear-gradient(135deg,var(--gl),var(--g));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.ob-s{font-size:13px;color:var(--dim);text-align:center;margin-bottom:24px;line-height:1.7}
.ob-field{margin-bottom:14px}
.ob-lbl{font-size:11px;font-weight:700;color:var(--dim);margin-bottom:6px;display:block}
.ob-in{width:100%;padding:12px 14px;background:var(--c);border:1.5px solid rgba(212,168,67,.18);color:var(--t);font-size:14px;border-radius:var(--rs);transition:.25s}
.ob-in:focus{outline:none;border-color:var(--g);background:var(--c2)}
.ob-grid{display:grid;grid-template-columns:1fr 1fr;gap:9px}
.ob-opt{padding:12px;background:var(--c);border:1.5px solid rgba(212,168,67,.12);border-radius:var(--rs);text-align:center;cursor:pointer;transition:.25s}
.ob-opt:hover{border-color:rgba(212,168,67,.4)}
.ob-opt.sel{background:rgba(212,168,67,.1);border-color:var(--g);color:var(--g)}
.ob-opt-ico{font-size:22px;display:block;margin-bottom:4px}
.ob-opt-lbl{font-size:11px;font-weight:700}
.ob-btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--g),var(--gd));color:var(--n);font-size:15px;font-weight:900;border-radius:var(--r);margin-top:10px;transition:.25s;border:none;cursor:pointer}
.ob-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(212,168,67,.4)}
.ob-back{width:100%;padding:11px;background:transparent;border:1.5px solid rgba(212,168,67,.2);color:var(--dim);font-size:13px;border-radius:var(--r);margin-top:8px;cursor:pointer;transition:.25s}
.ob-back:hover{border-color:var(--g);color:var(--t)}
/* === HEADER === */
.header{padding:14px 16px 0;display:flex;align-items:center;justify-content:space-between}
.app-title{font-family:'Inter',sans-serif;font-size:22px;font-weight:900;background:linear-gradient(135deg,var(--gl),var(--g),var(--gd));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:2px;line-height:1}
.app-sub{font-size:9px;color:var(--dim);letter-spacing:3px;margin-top:1px}
.hdr-r{display:flex;align-items:center;gap:8px}
.lang-btn{padding:5px 10px;background:var(--c);border:1.5px solid rgba(212,168,67,.25);color:var(--g);font-size:11px;font-weight:700;border-radius:20px;transition:.25s;cursor:pointer}
.lang-btn:hover{background:rgba(212,168,67,.1)}
.hdr-ico{width:34px;height:34px;background:var(--c);border:1.5px solid rgba(212,168,67,.15);border-radius:50%;color:var(--t);font-size:15px;display:flex;align-items:center;justify-content:center;transition:.25s;cursor:pointer}
.hdr-ico:hover{border-color:var(--g);color:var(--g)}
/* === STATS BAR === */
.stats-bar{display:flex;gap:7px;padding:12px 14px;overflow-x:auto;scrollbar-width:none}
.stats-bar::-webkit-scrollbar{display:none}
.stat-chip{flex-shrink:0;background:var(--c);border:1px solid rgba(212,168,67,.12);border-radius:10px;padding:8px 12px;text-align:center;min-width:68px;transition:.25s;cursor:default}
.stat-chip:hover{border-color:var(--g);transform:translateY(-2px)}
.stat-v{font-family:'Tajawal',sans-serif;font-size:18px;font-weight:900;color:var(--g);display:block;line-height:1}
.stat-l{font-size:9px;color:var(--dim);margin-top:2px}
/* === NAV TABS === */
.nav-tabs{display:flex;margin:10px 14px;background:var(--c);border-radius:11px;padding:3px;border:1px solid rgba(212,168,67,.09)}
.nav-tab{flex:1;padding:7px 2px;border:none;background:transparent;color:var(--dim);font-size:9px;font-weight:600;border-radius:8px;transition:.25s;display:flex;align-items:center;justify-content:center;gap:2px;flex-direction:column;cursor:pointer}
.nav-tab .ti{font-size:14px;line-height:1}
.nav-tab.on{background:linear-gradient(135deg,var(--g),var(--gd));color:var(--n);box-shadow:0 3px 12px rgba(212,168,67,.35)}
/* === DAY SELECTOR === */
.day-sel{display:flex;gap:6px;overflow-x:auto;scrollbar-width:none;margin-bottom:14px;padding-bottom:2px}
.day-sel::-webkit-scrollbar{display:none}
.day-btn{flex-shrink:0;width:48px;height:58px;border-radius:10px;border:1.5px solid rgba(212,168,67,.15);background:var(--c);color:var(--dim);font-size:9px;font-weight:600;transition:.3s;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;cursor:pointer}
.day-btn .dn{font-size:16px;font-weight:900;line-height:1}
.day-btn.on{background:linear-gradient(135deg,var(--g),var(--gd));color:var(--n);border-color:transparent;box-shadow:0 4px 16px rgba(212,168,67,.45);transform:scale(1.05)}
.day-btn.done{border-color:rgba(29,185,84,.28);background:rgba(29,185,84,.05);color:var(--green)}
.day-btn.done .dn{color:var(--green)}
.day-btn.rest{border-color:rgba(41,128,185,.18)}
/* === SECTION HDR === */
.sec{font-size:11px;color:var(--g);font-weight:700;letter-spacing:1px;margin-bottom:9px;display:flex;align-items:center;gap:7px}
.sec::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(212,168,67,.3),transparent)}
/* === EXERCISE CARD === */
.ec{background:var(--c);border:1.5px solid rgba(212,168,67,.08);border-radius:var(--r);margin-bottom:8px;overflow:hidden;transition:.3s;position:relative}
.ec:hover{border-color:rgba(212,168,67,.22)}
.ec.done{border-color:rgba(29,185,84,.28);background:rgba(29,185,84,.03)}
.ec-head{display:flex;align-items:center;gap:10px;padding:12px;cursor:pointer}
.ec-thumb{width:50px;height:50px;border-radius:10px;overflow:hidden;flex-shrink:0;background:var(--c2);display:flex;align-items:center;justify-content:center;font-size:22px}
.ec-thumb img{width:100%;height:100%;object-fit:cover}
.ec-info{flex:1;min-width:0}
.ec-name{font-size:13px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.ec-meta{font-size:10px;color:var(--dim);margin-top:2px;display:flex;gap:6px;flex-wrap:wrap}
.ec-tags{display:flex;gap:3px;flex-wrap:wrap;margin-top:4px}
.tag{font-size:8px;padding:2px 6px;border-radius:6px;background:rgba(212,168,67,.09);color:var(--gl)}
.ec-r{display:flex;flex-direction:column;align-items:flex-end;gap:5px;flex-shrink:0}
.ec-chk{width:26px;height:26px;border-radius:50%;border:2px solid rgba(212,168,67,.2);display:flex;align-items:center;justify-content:center;font-size:12px;transition:.3s;cursor:pointer}
.ec.done .ec-chk{background:var(--green);border-color:var(--green);color:#fff;animation:pop .4s ease}
.ec-ttag{font-size:9px;padding:3px 7px;background:rgba(212,168,67,.09);border-radius:6px;color:var(--g);font-weight:700;cursor:pointer;transition:.2s;white-space:nowrap}
.ec-ttag:hover{background:rgba(212,168,67,.2)}
/* DETAIL */
.ec-det{display:none;padding:0 12px 12px;border-top:1px solid rgba(255,255,255,.04)}
.ec-det.open{display:block;animation:fadeUp .3s ease}
.ex-illus{width:100%;height:140px;border-radius:10px;overflow:hidden;background:var(--c2);display:flex;align-items:center;justify-content:center;margin:10px 0;border:1px solid rgba(212,168,67,.07)}
.ex-illus svg,.ex-illus img{width:100%;height:100%;object-fit:cover}
/* Carousel */
.carousel{width:100%;height:140px;border-radius:10px;overflow:hidden;margin:10px 0;position:relative}
.carousel-inner{display:flex;height:100%;transition:transform .35s ease}
.carousel-slide{min-width:100%;height:140px;flex-shrink:0;background:var(--c2);display:flex;align-items:center;justify-content:center}
.carousel-slide img{width:100%;height:100%;object-fit:cover}
.c-dots{display:flex;justify-content:center;gap:5px;margin-top:-16px;position:relative;z-index:2;padding-bottom:4px}
.c-dot{width:6px;height:6px;border-radius:50%;background:rgba(212,168,67,.3);cursor:pointer;transition:.3s}
.c-dot.on{background:var(--g)}
.steps-list{list-style:none;display:flex;flex-direction:column;gap:6px;margin-top:8px}
.steps-list li{display:flex;gap:7px;font-size:11px;color:var(--dim);line-height:1.55;align-items:flex-start}
.sn{width:18px;height:18px;background:rgba(212,168,67,.12);color:var(--g);border-radius:50%;font-size:9px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px}
/* SET TRACKER */
.set-tr{background:var(--c2);border-radius:8px;padding:10px;margin-top:9px}
.set-dots{display:flex;gap:5px;margin-bottom:7px}
.sd{flex:1;height:5px;border-radius:3px;background:rgba(212,168,67,.1);transition:.4s}
.sd.done{background:var(--g)}
.sd.cur{background:var(--gl);animation:pulse .9s infinite}
.set-acts{display:flex;gap:6px}
.set-go{flex:1;padding:9px;background:linear-gradient(135deg,var(--g),var(--gd));color:var(--n);font-size:12px;font-weight:700;border:none;border-radius:8px;cursor:pointer;transition:.3s}
.set-go:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(212,168,67,.4)}
.set-go:disabled{opacity:.3;cursor:not-allowed;transform:none}
.set-t{padding:9px 11px;background:var(--c);border:1px solid rgba(212,168,67,.22);color:var(--g);font-size:10px;border-radius:8px;cursor:pointer;transition:.3s}
.set-t:hover{background:rgba(212,168,67,.1)}
/* ADJ */
.adj-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:10px}
.adj-box{background:var(--c2);border-radius:8px;padding:9px;text-align:center;border:1px solid rgba(212,168,67,.07)}
.adj-lbl{font-size:9px;color:var(--dim);margin-bottom:5px}
.adj-row{display:flex;align-items:center;justify-content:center;gap:5px}
.adj-b{width:22px;height:22px;border-radius:50%;border:1px solid rgba(212,168,67,.2);background:var(--c);color:var(--t);font-size:13px;display:flex;align-items:center;justify-content:center;transition:.2s;cursor:pointer}
.adj-b:hover{border-color:var(--g)}
.adj-v{font-size:14px;font-weight:900;color:var(--g);min-width:28px;text-align:center}
/* === BIG BTN === */
.bbtn{width:100%;padding:13px;font-size:14px;font-weight:700;border:none;border-radius:12px;transition:.3s;display:flex;align-items:center;justify-content:center;gap:7px;margin-top:8px;cursor:pointer}
.bbtn.red{background:linear-gradient(135deg,var(--red),#C0392B);color:#fff;box-shadow:0 4px 16px rgba(231,76,60,.3);animation:burn 3s infinite}
.bbtn.red:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(231,76,60,.5)}
.bbtn.grn{background:rgba(29,185,84,.09);border:1px solid rgba(29,185,84,.25);color:var(--green);animation:none}
.bbtn.grn:hover{background:rgba(29,185,84,.18)}
.bbtn.gold{background:linear-gradient(135deg,var(--g),var(--gd));color:var(--n);animation:none}
.bbtn.gold:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(212,168,67,.4)}
/* === PROGRESS BAR === */
.pbar{background:rgba(212,168,67,.07);border-radius:4px;height:5px;overflow:hidden;margin-top:5px}
.pfill{height:100%;background:linear-gradient(90deg,var(--gd),var(--gl));border-radius:4px;transition:width .6s ease}
/* === CHALLENGE === */
.ch-card{background:var(--c);border:1.5px solid rgba(212,168,67,.14);border-radius:16px;padding:16px;margin-bottom:14px;overflow:hidden;position:relative}
.ch-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--red),var(--orange),var(--g),var(--green))}
.ch-phases{display:flex;gap:2px;margin:12px 0 10px}
.ch-ph{flex:1;height:36px;border-radius:7px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:9px;font-weight:700;cursor:default;transition:.4s}
.ch-ph.past{opacity:.5}
.ch-ph.cur{transform:scaleY(1.1);box-shadow:0 3px 12px rgba(0,0,0,.4)}
.ch-ph.fut{opacity:.25}
.ch-bigbar{height:9px;background:rgba(255,255,255,.06);border-radius:5px;overflow:hidden;margin:8px 0 5px}
.ch-bf{height:100%;border-radius:5px;transition:width .8s ease}
.ch-meta{display:flex;justify-content:space-between;font-size:10px;color:var(--dim)}
/* === PLAN CARDS === */
.plan-card{background:var(--c);border:1.5px solid rgba(212,168,67,.12);border-radius:var(--r);padding:14px;margin-bottom:10px;display:flex;align-items:center;gap:12px;transition:.25s;cursor:pointer}
.plan-card:hover{border-color:rgba(212,168,67,.3)}
.plan-card.active{border-color:var(--g);background:rgba(212,168,67,.06)}
.plan-ico{width:44px;height:44px;border-radius:10px;background:rgba(212,168,67,.1);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.plan-info{flex:1;min-width:0}
.plan-name{font-size:13px;font-weight:700}
.plan-meta{font-size:10px;color:var(--dim);margin-top:2px}
.plan-bdg{font-size:9px;padding:2px 7px;border-radius:10px;background:rgba(212,168,67,.12);color:var(--g);font-weight:700}
.plan-bdg.def{background:rgba(29,185,84,.12);color:var(--green)}
/* === DAY EDITOR === */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.87);z-index:800;display:none;flex-direction:column}
.overlay.open{display:flex;animation:slideUp .35s ease}
.ov-hdr{display:flex;align-items:center;padding:14px 16px;background:var(--d);border-bottom:1px solid rgba(212,168,67,.1);gap:10px;flex-shrink:0}
.ov-title{flex:1;font-size:16px;font-weight:900;color:var(--g)}
.ov-close{width:34px;height:34px;border-radius:50%;background:var(--c);border:1px solid rgba(255,255,255,.07);color:var(--t);font-size:15px;display:flex;align-items:center;justify-content:center;transition:.2s;cursor:pointer}
.ov-close:hover{border-color:var(--g);color:var(--g)}
.ov-body{flex:1;overflow-y:auto;padding:14px}
.ov-footer{padding:14px 16px;background:var(--d);border-top:1px solid rgba(212,168,67,.1);flex-shrink:0;display:flex;gap:8px}
.ov-hint{font-size:11px;color:var(--dim);text-align:center;padding:10px;margin-bottom:10px;background:rgba(212,168,67,.05);border-radius:8px;border:1px solid rgba(212,168,67,.1)}
/* Draggable exercise row */
.de-row{background:var(--c);border:1.5px solid rgba(212,168,67,.1);border-radius:11px;padding:11px 12px;margin-bottom:8px;display:flex;align-items:center;gap:10px;cursor:grab;transition:.25s;user-select:none}
.de-row:active{cursor:grabbing}
.de-row.dragging{opacity:.3;transform:scale(.96)}
.de-row.drag-ov{border-color:var(--g);box-shadow:0 0 12px rgba(212,168,67,.35)}
.de-handle{font-size:18px;color:var(--dim);flex-shrink:0}
.de-ico{width:36px;height:36px;border-radius:7px;background:var(--c2);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.de-info{flex:1;min-width:0}
.de-name{font-size:12px;font-weight:700}
.de-meta{font-size:10px;color:var(--dim)}
.de-del{width:26px;height:26px;border-radius:7px;border:1px solid rgba(231,76,60,.25);background:rgba(231,76,60,.06);color:var(--red);font-size:13px;display:flex;align-items:center;justify-content:center;transition:.2s;flex-shrink:0;cursor:pointer}
.de-del:hover{background:rgba(231,76,60,.15)}
.ov-btn{flex:1;padding:12px;border:none;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;transition:.3s}
.ov-btn.gold{background:linear-gradient(135deg,var(--g),var(--gd));color:var(--n)}
.ov-btn.gold:hover{transform:translateY(-1px)}
.ov-btn.grn{background:rgba(29,185,84,.1);border:1px solid rgba(29,185,84,.25);color:var(--green)}
.ov-btn.grn:hover{background:rgba(29,185,84,.2)}
.ov-btn.dim{background:rgba(212,168,67,.07);border:1px solid rgba(212,168,67,.18);color:var(--g)}
/* === EXERCISE PICKER === */
.ep-search{width:calc(100% - 32px);margin:10px 16px;padding:10px 12px;background:var(--c);border:1.5px solid rgba(212,168,67,.18);color:var(--t);font-size:13px;border-radius:8px;display:block}
.ep-search:focus{outline:none;border-color:var(--g)}
.ep-tabs{display:flex;gap:0;margin:0 16px 0;background:var(--c);border-radius:8px;padding:2px;border:1px solid rgba(212,168,67,.1);flex-shrink:0}
.ep-tab{flex:1;padding:7px;border:none;background:transparent;color:var(--dim);font-size:11px;font-weight:700;border-radius:6px;transition:.25s;cursor:pointer}
.ep-tab.on{background:var(--g);color:var(--n)}
.ep-list{flex:1;overflow-y:auto;padding:10px 16px}
.ep-row{background:var(--c);border:1.5px solid rgba(212,168,67,.1);border-radius:10px;padding:11px 12px;display:flex;align-items:center;gap:10px;cursor:pointer;transition:.25s;margin-bottom:7px}
.ep-row:hover{border-color:var(--g);background:rgba(212,168,67,.05)}
.ep-ico{width:40px;height:40px;border-radius:8px;background:var(--c2);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;overflow:hidden}
.ep-ico img{width:100%;height:100%;object-fit:cover}
.ep-info{flex:1}
.ep-name{font-size:12px;font-weight:700}
.ep-meta{font-size:10px;color:var(--dim)}
.ep-new-btn{width:calc(100% - 32px);margin:10px 16px;padding:13px;background:rgba(212,168,67,.07);border:1.5px dashed rgba(212,168,67,.3);color:var(--g);font-size:13px;font-weight:700;border-radius:10px;transition:.3s;display:flex;align-items:center;justify-content:center;gap:7px;cursor:pointer;flex-shrink:0}
.ep-new-btn:hover{background:rgba(212,168,67,.14)}
/* === CREATE EXERCISE === */
.ce-field{margin-bottom:14px}
.ce-lbl{font-size:11px;font-weight:700;color:var(--dim);margin-bottom:6px;display:block}
.ce-in,.ce-sel,.ce-ta{width:100%;padding:10px 12px;background:var(--c);border:1.5px solid rgba(212,168,67,.18);color:var(--t);font-size:13px;border-radius:8px;transition:.25s}
.ce-in:focus,.ce-sel:focus,.ce-ta:focus{outline:none;border-color:var(--g)}
.ce-ta{resize:vertical;min-height:80px}
.ce-r2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
/* Photo upload */
.photo-area{display:flex;gap:8px}
.photo-slot{width:90px;height:90px;border-radius:10px;border:2px dashed rgba(212,168,67,.3);background:var(--c);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:.3s;overflow:hidden;position:relative;flex-shrink:0}
.photo-slot:hover{border-color:var(--g)}
.photo-slot img{width:100%;height:100%;object-fit:cover;position:absolute;inset:0}
.photo-slot .ps-ico{font-size:22px;position:relative;z-index:1}
.photo-slot .ps-lbl{font-size:8px;color:var(--dim);position:relative;z-index:1;margin-top:2px}
.photo-slot .ps-rm{position:absolute;top:4px;right:4px;width:20px;height:20px;border-radius:50%;background:rgba(0,0,0,.7);color:#fff;font-size:10px;z-index:2;display:flex;align-items:center;justify-content:center;cursor:pointer;opacity:0;transition:.2s}
.photo-slot:hover .ps-rm{opacity:1}
/* === BADGES === */
.badge-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:9px;margin-bottom:14px}
.bdg{background:var(--c);border:1.5px solid rgba(212,168,67,.1);border-radius:12px;padding:12px 8px;text-align:center;transition:.3s;cursor:default}
.bdg.earned{border-color:rgba(212,168,67,.35);background:rgba(212,168,67,.05)}
.bdg.earned:hover{transform:translateY(-3px);box-shadow:0 4px 16px rgba(212,168,67,.2)}
.bdg-ico{font-size:26px;display:block;margin-bottom:5px;filter:grayscale(1);opacity:.3;transition:.3s}
.bdg.earned .bdg-ico{filter:none;opacity:1}
.bdg-name{font-size:10px;font-weight:700;color:var(--dim)}
.bdg.earned .bdg-name{color:var(--g)}
/* Badge toast */
.bdg-toast{position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-80px);background:var(--c);border:1.5px solid var(--g);border-radius:var(--r);padding:14px 20px;z-index:1000;display:flex;align-items:center;gap:10px;box-shadow:0 8px 32px rgba(0,0,0,.5);transition:transform .4s cubic-bezier(.32,.72,0,1);min-width:240px}
.bdg-toast.show{transform:translateX(-50%) translateY(0)}
.bdg-toast-ico{font-size:28px}
.bdg-toast-title{font-size:12px;color:var(--dim);margin-bottom:2px}
.bdg-toast-name{font-size:14px;font-weight:900;color:var(--g)}
/* === TRACK === */
.track-grid{display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:14px}
.tr-stat{background:var(--c);border:1px solid rgba(212,168,67,.08);border-radius:12px;padding:12px;text-align:center;transition:.3s;cursor:default}
.tr-stat:hover{border-color:rgba(212,168,67,.28);transform:translateY(-2px)}
.tr-ico{font-size:22px;margin-bottom:5px}
.tr-v{font-family:'Tajawal',sans-serif;font-size:20px;font-weight:900;color:var(--g);display:block;line-height:1}
.tr-l{font-size:9px;color:var(--dim);margin-top:2px}
.body-card{background:var(--c);border:1px solid rgba(212,168,67,.08);border-radius:12px;padding:13px;margin-bottom:12px}
.body-title{font-size:12px;font-weight:700;color:var(--g);margin-bottom:10px;display:flex;align-items:center;gap:6px}
.body-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.body-lbl{font-size:11px;color:var(--dim)}
.body-in{background:var(--c2);border:1.5px solid rgba(212,168,67,.18);color:var(--t);font-size:12px;font-weight:700;padding:5px 8px;border-radius:7px;width:80px;text-align:center}
.body-in:focus{outline:none;border-color:var(--g)}
/* history */
.hist-item{background:var(--c);border:1px solid rgba(212,168,67,.07);border-radius:10px;padding:11px 13px;margin-bottom:7px;display:flex;align-items:center;gap:10px}
.hist-date{font-size:10px;color:var(--g);font-weight:700;flex-shrink:0;min-width:55px}
.hist-info{flex:1}
.hist-lbl{font-size:12px;font-weight:700}
.hist-meta{font-size:10px;color:var(--dim);margin-top:1px}
.hist-v{font-size:13px;font-weight:900;color:var(--g);flex-shrink:0}
/* Burn calc */
.burn-card{background:var(--c);border:1.5px solid rgba(231,76,60,.18);border-radius:var(--r);padding:14px;margin-bottom:14px}
.burn-res{background:linear-gradient(135deg,rgba(231,76,60,.12),rgba(212,168,67,.08));border:1px solid rgba(231,76,60,.2);border-radius:10px;padding:12px;text-align:center;margin-top:10px;display:none}
.burn-num{font-family:'Tajawal',sans-serif;font-size:36px;font-weight:900;color:var(--red)}
.burn-bd{display:flex;justify-content:center;gap:14px;margin-top:7px}
.burn-bi{text-align:center}
.burn-bi b{display:block;font-size:15px;font-weight:900;color:var(--orange)}
.burn-bi span{font-size:9px;color:var(--dim)}
.bc-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:9px}
.bc-lbl{font-size:11px;color:var(--dim)}
.bc-in{background:var(--c2);border:1px solid rgba(212,168,67,.18);color:var(--t);font-size:12px;font-weight:700;padding:5px 8px;border-radius:7px;width:76px;text-align:center}
.bc-in:focus{outline:none;border-color:var(--g)}
.bc-sel{background:var(--c2);border:1px solid rgba(212,168,67,.18);color:var(--t);font-size:11px;padding:5px 8px;border-radius:7px;cursor:pointer}
/* === ROPE === */
.rope-card{background:linear-gradient(135deg,rgba(29,185,84,.09),rgba(29,185,84,.04));border:1px solid rgba(29,185,84,.2);border-radius:var(--r);padding:14px;margin-bottom:14px}
.rt-big{text-align:center;margin-bottom:12px}
.rt-num{font-family:'Tajawal',sans-serif;font-size:42px;font-weight:900;color:var(--green);line-height:1}
.rt-unit{font-size:12px;color:var(--dim);margin-top:3px}
.rt-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px}
.rt-st{background:rgba(29,185,84,.08);border-radius:9px;padding:9px;text-align:center;border:1px solid rgba(29,185,84,.12)}
.rt-st b{display:block;font-size:16px;font-weight:900;color:var(--green)}
.rt-st span{font-size:9px;color:var(--dim)}
.rt-form{display:none;margin-top:10px;animation:fadeUp .3s ease}
.rt-form.open{display:block}
.rt-row{display:flex;gap:8px;margin-top:8px}
.rt-in{flex:1;background:var(--c2);border:1px solid rgba(29,185,84,.2);color:var(--t);font-size:12px;padding:8px 10px;border-radius:8px;text-align:center}
.rt-in:focus{outline:none;border-color:var(--green)}
.rt-save{flex:1;padding:8px;background:linear-gradient(135deg,var(--green),#15803d);color:#fff;font-size:12px;font-weight:700;border:none;border-radius:8px;cursor:pointer}
/* === TIMER === */
.timer-wrap{display:flex;flex-direction:column;align-items:center;padding:8px 14px}
.t-ring{position:relative;width:196px;height:196px;margin:10px auto}
.t-svg{transform:rotate(-90deg);width:196px;height:196px}
.t-track{fill:none;stroke:rgba(212,168,67,.07);stroke-width:8}
.t-prog{fill:none;stroke:url(#tg);stroke-width:8;stroke-linecap:round;stroke-dasharray:533;stroke-dashoffset:533;transition:stroke-dashoffset 1s linear}
.t-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.t-time{font-family:'Tajawal',sans-serif;font-size:42px;font-weight:900;color:var(--g);line-height:1;letter-spacing:-2px;text-shadow:0 0 18px rgba(212,168,67,.4)}
.t-phase{font-size:12px;font-weight:700;margin-top:3px}
.t-label{font-size:10px;color:var(--dim);margin-top:1px;text-align:center}
.t-ctrls{display:flex;gap:11px;margin-top:16px;align-items:center}
.tc{width:48px;height:48px;border-radius:50%;border:1px solid rgba(212,168,67,.22);background:var(--c);color:var(--t);font-size:18px;display:flex;align-items:center;justify-content:center;transition:.3s;cursor:pointer}
.tc:hover{border-color:var(--g);background:rgba(212,168,67,.08)}
.tc.main{width:62px;height:62px;font-size:23px;background:linear-gradient(135deg,var(--g),var(--gd));color:var(--n);border:none;box-shadow:0 4px 18px rgba(212,168,67,.35)}
.tc.main:hover{transform:scale(1.05);box-shadow:0 8px 26px rgba(212,168,67,.5)}
.presets{display:flex;gap:6px;flex-wrap:wrap;justify-content:center;margin-top:12px;width:100%}
.preset{padding:6px 11px;border-radius:15px;border:1px solid rgba(212,168,67,.18);background:var(--c);color:var(--t);font-size:10px;font-weight:600;cursor:pointer;transition:.3s}
.preset:hover,.preset.on{background:rgba(212,168,67,.14);border-color:var(--g);color:var(--g)}
.tabata-box{background:var(--c);border:1px solid rgba(212,168,67,.1);border-radius:12px;padding:12px;margin-top:12px;width:100%;max-width:320px}
.tab-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.tab-row span{font-size:11px;color:var(--dim)}
.tab-ctrl{display:flex;gap:5px;align-items:center}
.t-adj{width:24px;height:24px;border-radius:50%;border:1px solid rgba(212,168,67,.22);background:var(--c2);color:var(--t);font-size:14px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.2s}
.t-adj:hover{border-color:var(--g)}
.t-val{font-size:15px;font-weight:900;color:var(--g);min-width:25px;text-align:center}
/* === GUIDED === */
.guided-ov{position:fixed;inset:0;background:var(--n);z-index:600;display:none;flex-direction:column;overflow-y:auto}
.guided-ov.on{display:flex;animation:slideUp .4s ease}
.gd-hdr{display:flex;align-items:center;padding:12px 14px 8px;gap:9px;position:sticky;top:0;background:var(--n);z-index:10;border-bottom:1px solid rgba(255,255,255,.04)}
.gd-pw{flex:1;height:4px;background:rgba(212,168,67,.09);border-radius:2px;overflow:hidden}
.gd-pf{height:100%;background:linear-gradient(90deg,var(--gd),var(--gl));border-radius:2px;transition:width .5s ease}
.gd-cnt{font-size:10px;color:var(--dim);flex-shrink:0}
.gd-body{display:flex;flex-direction:column;align-items:center;padding:14px;flex:1}
.phase-pill{padding:5px 16px;border-radius:18px;font-size:11px;font-weight:700;margin-bottom:12px}
.phase-pill.ready{background:rgba(212,168,67,.14);color:var(--gl);border:1px solid rgba(212,168,67,.28)}
.phase-pill.work{background:rgba(231,76,60,.18);color:#F1948A;border:1px solid rgba(231,76,60,.38)}
.phase-pill.rest{background:rgba(29,185,84,.18);color:#A9DFBF;border:1px solid rgba(29,185,84,.38)}
.gd-name{font-family:'Tajawal',sans-serif;font-size:24px;font-weight:900;text-align:center;margin-bottom:3px}
.gd-sub{font-size:11px;color:var(--dim);text-align:center;margin-bottom:14px}
.gd-illus{width:100%;max-width:310px;height:180px;border-radius:16px;overflow:hidden;background:var(--c);display:flex;align-items:center;justify-content:center;margin-bottom:16px;border:1px solid rgba(212,168,67,.09)}
.gd-illus svg,.gd-illus img{width:100%;height:100%;object-fit:cover}
.gd-timer{font-family:'Tajawal',sans-serif;font-size:72px;font-weight:900;letter-spacing:-4px;line-height:1;text-align:center;margin-bottom:5px;transition:color .3s}
.gd-timer.work{color:var(--red);text-shadow:0 0 30px rgba(231,76,60,.4)}
.gd-timer.rest-t{color:var(--green);text-shadow:0 0 30px rgba(29,185,84,.4)}
.gd-timer.ready-t{color:var(--g);text-shadow:0 0 30px rgba(212,168,67,.4)}
.gd-tlbl{font-size:11px;color:var(--dim);text-align:center;margin-bottom:14px}
.gd-dots{display:flex;gap:6px;margin-bottom:16px}
.gd-dot{width:32px;height:6px;border-radius:3px;background:rgba(212,168,67,.1);transition:.4s}
.gd-dot.done{background:var(--g)}
.gd-dot.cur{background:var(--gl);animation:pulse .9s infinite}
.gd-stats{display:flex;gap:8px;width:100%;max-width:330px;margin-bottom:12px}
.gd-stat{background:var(--c);border-radius:11px;padding:9px 10px;text-align:center;border:1px solid rgba(212,168,67,.09);flex:1}
.gd-stat b{display:block;font-size:19px;font-weight:900;color:var(--g);font-family:'Tajawal',sans-serif}
.gd-stat span{font-size:9px;color:var(--dim)}
.gd-acts{display:flex;gap:8px;width:100%;max-width:330px}
.gd-main{flex:1;padding:14px;font-size:13px;font-weight:700;border:none;border-radius:13px;background:linear-gradient(135deg,var(--g),var(--gd));color:var(--n);transition:.3s;cursor:pointer}
.gd-main:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(212,168,67,.4)}
.gd-main:disabled{opacity:.3;cursor:not-allowed;transform:none}
.gd-skip{padding:14px;background:var(--c);border:1px solid rgba(255,255,255,.06);color:var(--dim);font-size:13px;border-radius:13px;cursor:pointer;transition:.3s;min-width:50px;display:flex;align-items:center;justify-content:center}
.gd-skip:hover{border-color:var(--g);color:var(--g)}
/* COUNTDOWN */
.cdown-ov{position:fixed;inset:0;background:rgba(7,9,15,.92);z-index:700;display:none;align-items:center;justify-content:center;flex-direction:column}
.cdown-ov.on{display:flex}
.cdown-n{font-family:'Tajawal',sans-serif;font-size:130px;font-weight:900;color:var(--g);text-shadow:0 0 50px rgba(212,168,67,.8);animation:countIn .8s ease;line-height:1}
/* COMPLETION */
.comp-ov{position:fixed;inset:0;background:rgba(7,9,15,.95);z-index:650;display:none;flex-direction:column;align-items:center;justify-content:center;padding:24px}
.comp-ov.on{display:flex;animation:fadeUp .4s ease}
.comp-ico{font-size:60px;margin-bottom:14px;animation:pop .5s ease}
.comp-title{font-family:'Tajawal',sans-serif;font-size:28px;font-weight:900;color:var(--g);text-align:center;margin-bottom:6px}
.comp-sub{font-size:13px;color:var(--dim);text-align:center;margin-bottom:20px;line-height:1.7}
.comp-stats{display:flex;gap:16px;margin-bottom:20px}
.cs b{display:block;font-family:'Tajawal',sans-serif;font-size:22px;font-weight:900;color:var(--g)}
.cs span{font-size:10px;color:var(--dim)}
/* === SETTINGS === */
.sett-card{background:var(--c);border:1px solid rgba(212,168,67,.14);border-radius:var(--r);padding:14px;margin-bottom:12px}
.sett-title{font-size:13px;font-weight:700;color:var(--g);margin-bottom:12px;display:flex;align-items:center;gap:7px}
.sett-row{display:flex;align-items:center;justify-content:space-between;padding:9px 0;border-bottom:1px solid rgba(255,255,255,.04)}
.sett-row:last-child{border-bottom:none}
.sett-lbl{font-size:12px}
.sett-sub{font-size:10px;color:var(--dim);margin-top:1px}
.sett-in{background:var(--c2);border:1px solid rgba(212,168,67,.2);color:var(--t);font-size:11px;font-weight:700;padding:6px 9px;border-radius:7px;width:140px}
.sett-in:focus{outline:none;border-color:var(--g)}
.sett-btn{padding:6px 13px;background:linear-gradient(135deg,var(--g),var(--gd));color:var(--n);font-size:11px;font-weight:700;border:none;border-radius:7px;cursor:pointer}
/* toggle */
.tog{position:relative;width:42px;height:24px;flex-shrink:0}
.tog input{opacity:0;width:0;height:0}
.tog-sl{position:absolute;inset:0;background:rgba(255,255,255,.1);border-radius:12px;cursor:pointer;transition:.3s}
.tog-sl::before{content:'';position:absolute;width:18px;height:18px;left:3px;bottom:3px;background:var(--dim);border-radius:50%;transition:.3s}
.tog input:checked+.tog-sl{background:var(--g)}
.tog input:checked+.tog-sl::before{transform:translateX(18px);background:var(--n)}
/* Profile */
.prof-card{background:var(--c);border:1.5px solid rgba(212,168,67,.15);border-radius:var(--r);padding:16px;margin-bottom:14px;display:flex;align-items:center;gap:14px}
.prof-av{width:54px;height:54px;border-radius:50%;background:linear-gradient(135deg,var(--g),var(--gd));display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0}
.prof-info{flex:1}
.prof-name{font-size:16px;font-weight:900}
.prof-meta{font-size:11px;color:var(--dim);margin-top:3px}
.prof-edit{padding:7px 14px;background:rgba(212,168,67,.1);border:1px solid rgba(212,168,67,.25);color:var(--g);font-size:11px;font-weight:700;border-radius:8px;cursor:pointer;transition:.2s}
.prof-edit:hover{background:rgba(212,168,67,.2)}
/* THEME PANEL */
.theme-panel{position:fixed;bottom:148px;left:14px;z-index:101;background:var(--c);border:1px solid rgba(255,255,255,.1);border-radius:16px;padding:10px;box-shadow:0 8px 32px rgba(0,0,0,.5);display:none;flex-direction:column;gap:6px;min-width:175px}
.theme-panel.open{display:flex;animation:fadeUp .3s ease}
.th-opt{display:flex;align-items:center;gap:10px;padding:8px 10px;border-radius:10px;cursor:pointer;border:1px solid transparent;transition:.2s}
.th-opt:hover{background:rgba(255,255,255,.07);border-color:rgba(255,255,255,.12)}
.th-opt.on{border-color:var(--g);background:rgba(255,255,255,.05)}
.th-dot{width:22px;height:22px;border-radius:50%;flex-shrink:0;border:2px solid rgba(255,255,255,.2)}
.th-name{font-size:12px;font-weight:700}
/* FABs */
.fab-theme{position:fixed;bottom:148px;right:14px;z-index:100;width:42px;height:42px;border-radius:50%;background:var(--c);border:2px solid var(--g);color:var(--t);font-size:18px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 16px rgba(0,0,0,.4);transition:.3s;cursor:pointer}
.fab-mode{position:fixed;bottom:90px;left:14px;z-index:100;padding:6px 12px;background:var(--c);border:1.5px solid rgba(212,168,67,.3);border-radius:16px;color:var(--g);font-size:10px;font-weight:700;box-shadow:0 2px 10px rgba(0,0,0,.4);cursor:pointer;transition:.2s}
.fab-theme:hover,.fab-mode:hover{background:rgba(212,168,67,.1)}
/* === BOTTOM NAV === */
.bnav{position:fixed;bottom:0;left:0;right:0;background:var(--d);border-top:1px solid rgba(212,168,67,.09);padding:6px 6px 8px;display:flex;justify-content:space-around;z-index:200}
.bn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:5px 8px;border-radius:10px;cursor:pointer;transition:.25s;border:1px solid transparent}
.bn.on{background:rgba(212,168,67,.09);border-color:rgba(212,168,67,.18)}
.bn-ico{font-size:18px;line-height:1}
.bn-lbl{font-size:9px;color:var(--dim);font-weight:600}
.bn.on .bn-lbl{color:var(--g)}
/* NOTIFY */
.notify{position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-70px);background:var(--c);border:1px solid rgba(212,168,67,.3);border-radius:10px;padding:10px 18px;z-index:900;font-size:13px;font-weight:700;color:var(--g);box-shadow:0 8px 32px rgba(0,0,0,.5);transition:transform .3s;white-space:nowrap;text-align:center}
.notify.show{transform:translateX(-50%) translateY(0)}
/* CONFIRM */
.confirm-ov{position:fixed;inset:0;background:rgba(0,0,0,.82);z-index:950;display:none;align-items:center;justify-content:center;padding:20px}
.confirm-ov.open{display:flex;animation:fadeUp .2s ease}
.confirm-box{background:var(--d);border:1px solid rgba(212,168,67,.2);border-radius:18px;padding:24px;max-width:320px;width:100%;text-align:center}
.confirm-ico{font-size:36px;margin-bottom:10px}
.confirm-msg{font-size:14px;font-weight:600;margin-bottom:18px;line-height:1.6}
.confirm-btns{display:flex;gap:10px}
.confirm-yes{flex:1;padding:11px;background:linear-gradient(135deg,var(--red),#C0392B);color:#fff;font-size:13px;font-weight:700;border:none;border-radius:9px;cursor:pointer}
.confirm-no{flex:1;padding:11px;background:var(--c);border:1px solid rgba(255,255,255,.08);color:var(--dim);font-size:13px;border-radius:9px;cursor:pointer}
/* CALENDAR */
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-top:8px}
.cal-d{aspect-ratio:1;border-radius:6px;border:1px solid rgba(212,168,67,.06);background:var(--c);display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;color:var(--dim)}
.cal-d.done{background:rgba(29,185,84,.15);border-color:rgba(29,185,84,.28);color:var(--green)}
.cal-d.today{border-color:var(--g);color:var(--g);box-shadow:0 0 6px rgba(212,168,67,.2)}
.cal-d.rest{background:rgba(41,128,185,.05);border-color:rgba(41,128,185,.12);color:var(--blue);font-size:7px}
.cal-d.fut{opacity:.2}
/* REST VIEW */
.rest-view{text-align:center;padding:28px 16px}
.rest-tips{margin-top:16px;padding:12px;background:rgba(41,128,185,.04);border-radius:10px;border:1px solid rgba(41,128,185,.12);text-align:right}
.rest-tips li{font-size:11px;color:var(--dim);line-height:1.85;list-style:none}
.rest-tips li::before{content:'âœ¦ ';color:var(--blue)}
/* TIPS */
.tip-card{background:var(--c);border:1px solid rgba(212,168,67,.08);border-radius:var(--r);padding:14px;margin-bottom:9px;display:flex;gap:10px;align-items:flex-start;transition:.3s}
.tip-card:hover{border-color:rgba(212,168,67,.26);transform:translateX(-3px)}
.tip-ico{font-size:22px;flex-shrink:0;width:40px;height:40px;background:rgba(212,168,67,.06);border-radius:9px;display:flex;align-items:center;justify-content:center}
.tip-cnt h4{font-size:13px;font-weight:700;margin-bottom:4px}
.tip-cnt p{font-size:11px;color:var(--dim);line-height:1.65}
/* QUOTE */
.quote-card{margin:10px 14px 0;padding:9px 14px;background:var(--c);border-radius:10px;border:1px solid rgba(255,255,255,.04);font-size:11px;color:var(--dim);text-align:center;font-style:italic}
/* CONFETTI */
.conf{position:fixed;width:8px;height:8px;border-radius:2px;animation:confetti 2.5s ease forwards;pointer-events:none;z-index:999}
/* DAILY MSG */
.daily-msg{margin:8px 14px 0;padding:10px 14px;border-radius:10px;border:1px solid;font-size:12px;font-weight:600;text-align:center;transition:.5s}
/* ===== DESKTOP MODE ===== */
#dtShell{display:none;position:fixed;inset:0;background:var(--n);z-index:500;overflow:hidden;flex-direction:column}
.desktop-mode #dtShell{display:flex}
.desktop-mode #app,.desktop-mode .bnav,.desktop-mode .fab-theme,.desktop-mode .fab-mode,.desktop-mode .theme-panel{display:none!important}
.desktop-mode .guided-ov,.desktop-mode .cdown-ov,.desktop-mode .comp-ov{z-index:5000!important}
/* Desktop topbar */
.dt-top{display:flex;align-items:center;padding:9px 20px;background:var(--d);border-bottom:1px solid rgba(212,168,67,.1);flex-shrink:0;gap:14px}
.dt-logo{font-family:'Inter',sans-serif;font-size:16px;font-weight:900;color:var(--g);letter-spacing:2px;flex-shrink:0;line-height:1}
.dt-sub{font-size:8px;color:var(--dim);letter-spacing:3px}
.dt-days{display:flex;gap:5px;overflow-x:auto;flex:1;scrollbar-width:none;padding:0 4px}
.dt-days::-webkit-scrollbar{display:none}
.dt-day{min-width:42px;height:42px;border-radius:8px;background:var(--c);border:1.5px solid transparent;color:var(--dim);font-size:10px;font-weight:700;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1px;transition:.2s;flex-shrink:0;cursor:pointer}
.dt-day .dn{font-size:14px;font-weight:900;line-height:1}
.dt-day:hover{border-color:rgba(212,168,67,.3)}
.dt-day.on{background:linear-gradient(135deg,var(--g),var(--gd));color:var(--n);border-color:transparent;box-shadow:0 2px 10px rgba(212,168,67,.4)}
.dt-day.done{border-color:rgba(29,185,84,.25);background:rgba(29,185,84,.05);color:var(--green)}
.dt-acts{display:flex;gap:7px;align-items:center;flex-shrink:0}
.dt-btn{padding:7px 13px;background:var(--c);border:1px solid rgba(212,168,67,.2);color:var(--g);font-size:11px;font-weight:700;border-radius:9px;cursor:pointer;transition:.2s;white-space:nowrap}
.dt-btn:hover{background:rgba(212,168,67,.1)}
/* Desktop 3-col */
.dt-main{display:flex;flex:1;overflow:hidden}
.dt-left{width:270px;flex-shrink:0;border-left:1px solid rgba(255,255,255,.05);overflow-y:auto;display:flex;flex-direction:column}
.dt-lhdr{padding:11px 13px 7px;border-bottom:1px solid rgba(255,255,255,.04);flex-shrink:0;display:flex;align-items:center;justify-content:space-between}
.dt-ltitle{font-size:11px;font-weight:700;color:var(--g);letter-spacing:.5px}
.dt-sess-btn{padding:5px 10px;background:linear-gradient(135deg,var(--red),#C0392B);border:none;border-radius:7px;color:#fff;font-size:10px;font-weight:700;cursor:pointer;animation:burn 3s infinite}
.dt-exlist{padding:7px;display:flex;flex-direction:column;gap:4px}
.dt-exrow{padding:9px 11px;background:var(--c);border-radius:10px;border:1.5px solid transparent;cursor:pointer;transition:.2s;display:flex;align-items:center;gap:8px}
.dt-exrow:hover{border-color:rgba(212,168,67,.25);background:rgba(212,168,67,.03)}
.dt-exrow.on{border-color:var(--g);background:rgba(212,168,67,.07)}
.dt-exrow.done{border-color:rgba(29,185,84,.2);background:rgba(29,185,84,.03);opacity:.6}
.dt-exth{width:34px;height:34px;border-radius:7px;overflow:hidden;flex-shrink:0;background:var(--c2);display:flex;align-items:center;justify-content:center;font-size:16px}
.dt-exth img{width:100%;height:100%;object-fit:cover}
.dt-exi{flex:1;min-width:0}
.dt-exname{font-size:11px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.dt-exmeta{font-size:9px;color:var(--dim);margin-top:1px}
.dt-extick{width:16px;height:16px;border-radius:50%;border:1.5px solid rgba(212,168,67,.18);display:flex;align-items:center;justify-content:center;font-size:8px;flex-shrink:0}
.dt-exrow.done .dt-extick{background:var(--green);border-color:var(--green);color:#fff}
.dt-center{flex:1;overflow-y:auto;padding:18px 20px}
.dt-right{width:250px;flex-shrink:0;border-right:1px solid rgba(255,255,255,.05);overflow-y:auto;display:flex;flex-direction:column}
.dt-panel{padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.04)}
.dt-ptitle{font-size:10px;font-weight:700;color:var(--g);letter-spacing:.8px;margin-bottom:10px;text-transform:uppercase}
.dt-srow{display:flex;align-items:center;justify-content:space-between;padding:5px 0;border-bottom:1px solid rgba(255,255,255,.03)}
.dt-srow:last-child{border-bottom:none}
.dt-slbl{font-size:10px;color:var(--dim)}
.dt-sval{font-family:'Tajawal',sans-serif;font-size:14px;font-weight:900;color:var(--g)}
/* Desktop timer ring */
.dt-tring{position:relative;width:110px;height:110px;margin:0 auto 10px}
.dt-tsvg{transform:rotate(-90deg);width:110px;height:110px}
.dt-ttrack{fill:none;stroke:rgba(212,168,67,.07);stroke-width:7}
.dt-tprog{fill:none;stroke:url(#dtg);stroke-width:7;stroke-linecap:round;stroke-dasharray:314;stroke-dashoffset:314;transition:stroke-dashoffset 1s linear}
.dt-tcenter{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.dt-ttime{font-family:'Tajawal',sans-serif;font-size:24px;font-weight:900;color:var(--g);line-height:1;letter-spacing:-1px}
.dt-tphase{font-size:9px;color:var(--dim);margin-top:2px}
.dt-tctrls{display:flex;gap:5px;justify-content:center;margin-bottom:8px}
.dt-tcb{width:32px;height:32px;border-radius:50%;border:1px solid rgba(212,168,67,.2);background:var(--c);color:var(--t);font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s}
.dt-tcb:hover{border-color:var(--g)}
.dt-tcb.main{background:linear-gradient(135deg,var(--g),var(--gd));color:var(--n);border:none;width:40px;height:40px;font-size:16px;box-shadow:0 2px 10px rgba(212,168,67,.3)}
/* Desktop keyboard shortcuts */
.kb-panel{position:fixed;bottom:20px;right:20px;background:var(--c);border:1px solid rgba(212,168,67,.2);border-radius:12px;padding:12px 16px;z-index:600;min-width:220px;display:none}
.kb-panel.open{display:block;animation:fadeUp .3s ease}
.kb-title{font-size:11px;font-weight:700;color:var(--g);margin-bottom:9px;display:flex;align-items:center;justify-content:space-between}
.kb-row{display:flex;align-items:center;justify-content:space-between;padding:4px 0;border-bottom:1px solid rgba(255,255,255,.03)}
.kb-row:last-child{border-bottom:none}
.kb-key{font-family:'Inter',sans-serif;font-size:11px;font-weight:700;background:var(--c2);border:1px solid rgba(212,168,67,.2);border-radius:4px;padding:2px 6px;color:var(--g)}
.kb-lbl{font-size:10px;color:var(--dim)}
/* TV MODE */
.tv-mode .dt-day{min-width:56px;height:56px;font-size:12px}
.tv-mode .dt-day .dn{font-size:18px}
.tv-mode .dt-exrow{padding:12px 14px}
.tv-mode .dt-exname{font-size:13px}

/* ===================================================
   NEW FEATURES CSS - FITPULSE PRO v7
   =================================================== */

/* MODE FAB - Old pill style */
.mode-fab{position:fixed;bottom:90px;right:14px;z-index:9999;display:flex;align-items:center;gap:6px;padding:7px 13px;background:var(--card);border:1.5px solid rgba(212,168,67,.35);border-radius:18px;color:var(--gold);font-family:'Cairo',sans-serif;font-size:11px;font-weight:700;cursor:pointer;box-shadow:0 2px 14px rgba(0,0,0,.5);transition:.25s;user-select:none}
.mode-fab:hover{background:rgba(212,168,67,.1);transform:translateY(-2px)}
.mode-fab .mf-dot{width:6px;height:6px;border-radius:50%;background:var(--gold);animation:pulse 2s infinite}

/* MODE CHANGE TOAST */
.mode-toast{position:fixed;bottom:160px;left:50%;transform:translateX(-50%) translateY(20px);z-index:99999;background:var(--card);border:1.5px solid rgba(212,168,67,.3);border-radius:16px;padding:12px 20px;display:flex;align-items:center;gap:12px;box-shadow:0 8px 32px rgba(0,0,0,.6);opacity:0;transition:.35s cubic-bezier(.34,1.56,.64,1);pointer-events:none;min-width:220px}
.mode-toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.mode-toast .mt-icon{font-size:28px;line-height:1}
.mode-toast .mt-info .mt-name{font-size:14px;font-weight:800;color:var(--gold)}
.mode-toast .mt-info .mt-desc{font-size:10px;color:var(--dim);margin-top:1px}

/* GIF EXERCISE DISPLAY */
.ex-gif{width:100%;height:200px;object-fit:contain;border-radius:10px;background:rgba(0,0,0,.2)}
.ex-gif-sm{width:48px;height:48px;object-fit:cover;border-radius:8px}
.gif-slideshow{position:relative;overflow:hidden;border-radius:12px;background:#000;min-height:180px}
.gif-slide{display:none;width:100%;text-align:center}
.gif-slide.active{display:block}
.gif-slide img{max-width:100%;max-height:220px;object-fit:contain}
.gif-slide .slide-cap{padding:8px 12px;font-size:11px;color:var(--dim);text-align:center;border-top:1px solid rgba(255,255,255,.05)}
.gif-nav{display:flex;align-items:center;justify-content:center;gap:8px;padding:8px}
.gif-nav-btn{padding:4px 12px;background:rgba(212,168,67,.1);border:1px solid rgba(212,168,67,.2);color:var(--gold);border-radius:8px;font-size:11px;cursor:pointer}
.gif-dots{display:flex;gap:4px}
.gif-dots span{width:5px;height:5px;border-radius:50%;background:rgba(212,168,67,.3);transition:.2s}
.gif-dots span.on{background:var(--gold)}

/* GIF GUIDE OVERLAY */
.gif-guide-ov{position:fixed;inset:0;z-index:1100;background:rgba(0,0,0,.85);display:flex;align-items:flex-end;opacity:0;pointer-events:none;transition:.3s}
.gif-guide-ov.open{opacity:1;pointer-events:all}
.gif-guide-box{background:var(--bg);border-radius:20px 20px 0 0;padding:20px;width:100%;max-height:80vh;overflow-y:auto;transform:translateY(100%);transition:.4s cubic-bezier(.34,1.56,.64,1)}
.gif-guide-ov.open .gif-guide-box{transform:translateY(0)}
.gg-step{display:flex;gap:12px;padding:12px;background:var(--card);border-radius:12px;margin-bottom:10px;border:1px solid rgba(212,168,67,.1)}
.gg-num{width:28px;height:28px;border-radius:50%;background:var(--gold);color:#000;font-weight:900;font-size:13px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.gg-text h4{font-size:13px;font-weight:700;margin-bottom:3px}
.gg-text p{font-size:11px;color:var(--dim);line-height:1.5}
.gg-text .gg-link{display:inline-block;margin-top:5px;padding:3px 10px;background:rgba(212,168,67,.1);border:1px solid rgba(212,168,67,.3);border-radius:6px;color:var(--gold);font-size:10px;font-weight:700}

/* TUTORIAL OVERLAY */
.tutorial-ov{position:fixed;inset:0;z-index:100000;pointer-events:none;opacity:0;transition:.4s}
.tutorial-ov.active{opacity:1;pointer-events:all}
.tutorial-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.75)}
.tutorial-spotlight{position:absolute;border-radius:14px;box-shadow:0 0 0 9999px rgba(0,0,0,.75);border:2px solid var(--gold);transition:.5s cubic-bezier(.34,1.2,.64,1);z-index:1}
.tutorial-card{position:absolute;background:var(--card);border:1.5px solid var(--gold);border-radius:16px;padding:16px 18px;max-width:280px;box-shadow:0 8px 32px rgba(0,0,0,.6);z-index:2;transition:.5s cubic-bezier(.34,1.2,.64,1)}
.tutorial-card::before{content:'';position:absolute;width:12px;height:12px;background:var(--card);border:1.5px solid var(--gold);transform:rotate(45deg)}
.tc-arrow-down::before{bottom:-7px;left:50%;transform:translateX(-50%) rotate(45deg);border-top:none;border-left:none}
.tc-arrow-up::before{top:-7px;left:50%;transform:translateX(-50%) rotate(45deg);border-bottom:none;border-right:none}
.tc-arrow-left::before{left:-7px;top:50%;transform:translateY(-50%) rotate(45deg);border-top:none;border-right:none}
.tutorial-step{font-size:10px;color:var(--gold);font-weight:700;opacity:.7;margin-bottom:4px}
.tutorial-title{font-size:15px;font-weight:900;margin-bottom:6px}
.tutorial-desc{font-size:12px;color:var(--dim);line-height:1.6;margin-bottom:14px}
.tutorial-actions{display:flex;gap:8px}
.tut-skip{padding:7px 14px;background:rgba(255,255,255,.05);color:var(--dim);border-radius:9px;font-size:11px;cursor:pointer;border:1px solid rgba(255,255,255,.08)}
.tut-next{flex:1;padding:7px 14px;background:linear-gradient(135deg,var(--gold),#F2C95C);color:#000;border-radius:9px;font-size:12px;font-weight:800;cursor:pointer}
.tutorial-dots{display:flex;gap:5px;justify-content:center;margin-bottom:10px}
.tutorial-dots span{width:5px;height:5px;border-radius:50%;background:rgba(212,168,67,.25);transition:.3s}
.tutorial-dots span.on{width:16px;background:var(--gold)}

/* SOUND CONTROL MODAL */
.sound-modal{position:fixed;inset:0;z-index:9000;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:.3s}
.sound-modal.open{opacity:1;pointer-events:all}
.sound-box{background:var(--bg);border:1.5px solid rgba(212,168,67,.2);border-radius:20px;padding:22px;width:calc(100% - 40px);max-width:380px;transform:scale(.9);transition:.35s cubic-bezier(.34,1.56,.64,1)}
.sound-modal.open .sound-box{transform:scale(1)}
.snd-title{font-size:17px;font-weight:900;margin-bottom:4px}
.snd-sub{font-size:11px;color:var(--dim);margin-bottom:18px}
.snd-row{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.04)}
.snd-row:last-child{border-bottom:none}
.snd-ico{font-size:22px;width:36px;text-align:center}
.snd-info{flex:1}
.snd-info .si-name{font-size:12px;font-weight:700}
.snd-info .si-desc{font-size:10px;color:var(--dim)}
.snd-toggle{position:relative}
.snd-toggle input{opacity:0;width:0;height:0}
.snd-sl{display:block;width:40px;height:22px;background:rgba(255,255,255,.1);border-radius:11px;cursor:pointer;transition:.3s;position:relative}
.snd-sl::after{content:'';position:absolute;width:16px;height:16px;background:#fff;border-radius:50%;top:3px;left:3px;transition:.3s;box-shadow:0 1px 4px rgba(0,0,0,.3)}
.snd-toggle input:checked+.snd-sl{background:var(--green)}
.snd-toggle input:checked+.snd-sl::after{transform:translateX(18px)}
.snd-start-btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--gold),#F2C95C);color:#000;border-radius:12px;font-size:15px;font-weight:900;margin-top:16px;cursor:pointer;transition:.2s}
.snd-start-btn:hover{opacity:.9;transform:translateY(-1px)}
.master-vol{display:flex;align-items:center;gap:10px;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.04);margin-bottom:4px}
.vol-slider{flex:1;height:4px;background:rgba(255,255,255,.1);border-radius:2px;outline:none;-webkit-appearance:none;cursor:pointer}
.vol-slider::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:var(--gold);cursor:pointer}

/* WATER REMINDER */
.water-toast{position:fixed;top:80px;left:50%;transform:translateX(-50%) translateY(-20px);z-index:99998;background:linear-gradient(135deg,#1a3a4a,#0d2535);border:1.5px solid rgba(100,180,255,.3);border-radius:16px;padding:14px 18px;display:flex;align-items:center;gap:12px;box-shadow:0 8px 32px rgba(0,0,0,.6);opacity:0;pointer-events:none;transition:.4s cubic-bezier(.34,1.56,.64,1);min-width:240px}
.water-toast.show{opacity:1;transform:translateX(-50%) translateY(0);pointer-events:all}
.wt-icon{font-size:28px;animation:waterWave 1.5s ease-in-out infinite}
@keyframes waterWave{0%,100%{transform:rotate(-10deg)}50%{transform:rotate(10deg)}}
.wt-text .wt-title{font-size:13px;font-weight:800;color:#6fd4ff}
.wt-text .wt-sub{font-size:10px;color:rgba(111,212,255,.6);margin-top:1px}
.wt-dismiss{padding:4px 10px;background:rgba(100,180,255,.1);border:1px solid rgba(100,180,255,.3);color:#6fd4ff;border-radius:7px;font-size:10px;cursor:pointer;font-weight:700}

/* WEEKLY SUMMARY */
.weekly-ov{position:fixed;inset:0;z-index:9500;background:var(--bg);overflow-y:auto;opacity:0;transform:translateY(40px);pointer-events:none;transition:.45s cubic-bezier(.34,1.56,.64,1)}
.weekly-ov.open{opacity:1;transform:translateY(0);pointer-events:all}
.wk-hero{padding:40px 20px 24px;text-align:center;background:linear-gradient(180deg,rgba(212,168,67,.08) 0%,transparent 100%)}
.wk-trophy{font-size:60px;animation:trophyBounce 1s ease infinite alternate}
@keyframes trophyBounce{from{transform:translateY(0) scale(1)}to{transform:translateY(-8px) scale(1.05)}}
.wk-week{font-size:11px;color:var(--dim);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px}
.wk-title{font-size:26px;font-weight:900;margin-bottom:4px}
.wk-sub{font-size:13px;color:var(--dim)}
.wk-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:0 14px;margin:16px 0}
.wk-stat{background:var(--card);border:1px solid rgba(212,168,67,.12);border-radius:14px;padding:14px;text-align:center}
.wk-stat-val{font-size:28px;font-weight:900;color:var(--gold);display:block}
.wk-stat-lbl{font-size:10px;color:var(--dim);margin-top:2px}
.wk-stat-diff{font-size:10px;margin-top:4px;padding:2px 7px;border-radius:5px;display:inline-block}
.wk-stat-diff.up{background:rgba(29,185,84,.12);color:var(--green)}
.wk-stat-diff.down{background:rgba(231,76,60,.1);color:var(--red)}
.wk-bar-section{padding:0 14px;margin-bottom:16px}
.wk-bar-title{font-size:12px;font-weight:700;margin-bottom:10px;color:var(--dim)}
.wk-day-bars{display:flex;gap:4px;align-items:flex-end;height:60px}
.wk-bar-wrap{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px}
.wk-bar{width:100%;background:rgba(212,168,67,.15);border-radius:3px 3px 0 0;transition:1s cubic-bezier(.34,1.2,.64,1);min-height:4px}
.wk-bar.done{background:linear-gradient(180deg,#F2C95C,var(--gold))}
.wk-bar-day{font-size:8px;color:var(--dim)}
.wk-msg{margin:0 14px 16px;padding:14px;background:rgba(212,168,67,.06);border:1px solid rgba(212,168,67,.15);border-radius:14px;text-align:center;font-size:13px;line-height:1.6}
.wk-close-btn{display:block;width:calc(100% - 28px);margin:0 14px 30px;padding:14px;background:linear-gradient(135deg,var(--gold),#F2C95C);color:#000;border-radius:14px;font-size:15px;font-weight:900;cursor:pointer;text-align:center}

/* DND MODE INDICATOR */
.dnd-badge{position:fixed;top:60px;right:14px;z-index:9999;padding:4px 10px;background:rgba(30,30,50,.9);border:1px solid rgba(150,130,200,.3);border-radius:10px;font-size:10px;color:rgba(200,180,255,.8);display:none;align-items:center;gap:5px}
.dnd-badge.active{display:flex}

/* AI COACH */
.ai-overlay{position:fixed;inset:0;z-index:9800;background:rgba(0,0,0,.9);display:flex;flex-direction:column;opacity:0;pointer-events:none;transition:.35s}
.ai-overlay.open{opacity:1;pointer-events:all}
.ai-header{display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--dark);border-bottom:1px solid rgba(212,168,67,.12);flex-shrink:0}
.ai-avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#4f46e5,#7c3aed);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;box-shadow:0 0 14px rgba(79,70,229,.4)}
.ai-hdr-info .ai-name{font-size:14px;font-weight:800}
.ai-hdr-info .ai-status{font-size:10px;color:var(--green);display:flex;align-items:center;gap:4px}
.ai-hdr-info .ai-status::before{content:'';width:5px;height:5px;border-radius:50%;background:var(--green);display:inline-block;animation:pulse 2s infinite}
.ai-messages{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:10px}
.ai-msg{max-width:85%;padding:11px 14px;border-radius:14px;font-size:12px;line-height:1.6;animation:msgIn .3s ease}
@keyframes msgIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.ai-msg.user{background:linear-gradient(135deg,rgba(212,168,67,.2),rgba(212,168,67,.1));border:1px solid rgba(212,168,67,.2);align-self:flex-end;border-radius:14px 14px 4px 14px}
.ai-msg.bot{background:var(--card);border:1px solid rgba(255,255,255,.07);align-self:flex-start;border-radius:4px 14px 14px 14px}
.ai-msg.bot .msg-time{font-size:9px;color:var(--dim);margin-top:5px;display:block}
.ai-typing{display:flex;gap:4px;align-items:center;padding:11px 14px;background:var(--card);border-radius:4px 14px 14px 14px;width:fit-content}
.ai-typing span{width:6px;height:6px;border-radius:50%;background:var(--dim);animation:typing 1.2s infinite}
.ai-typing span:nth-child(2){animation-delay:.2s}
.ai-typing span:nth-child(3){animation-delay:.4s}
@keyframes typing{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-6px)}}
.ai-chips{display:flex;gap:6px;padding:8px 14px;overflow-x:auto;scrollbar-width:none;flex-shrink:0;border-top:1px solid rgba(255,255,255,.04)}
.ai-chips::-webkit-scrollbar{display:none}
.ai-chip{flex-shrink:0;padding:7px 12px;background:rgba(212,168,67,.08);border:1px solid rgba(212,168,67,.2);border-radius:20px;color:var(--gold);font-size:11px;cursor:pointer;white-space:nowrap;transition:.2s}
.ai-chip:hover{background:rgba(212,168,67,.15)}
.ai-input-row{display:flex;gap:8px;padding:10px 14px;background:var(--dark);border-top:1px solid rgba(255,255,255,.05);flex-shrink:0}
.ai-input{flex:1;background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:22px;padding:10px 16px;color:var(--text);font-size:13px;font-family:'Cairo',sans-serif;outline:none;resize:none}
.ai-input:focus{border-color:rgba(212,168,67,.4)}
.ai-send{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--gold),#F2C95C);color:#000;font-size:16px;display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;transition:.2s}
.ai-send:hover{transform:scale(1.05)}
.ai-api-prompt{padding:20px;text-align:center}
.ai-api-input{width:100%;padding:12px;background:var(--card);border:1px solid rgba(212,168,67,.3);border-radius:10px;color:var(--text);font-size:12px;margin:10px 0;outline:none;font-family:'Cairo',sans-serif}
.ai-cmd-action{display:inline-flex;align-items:center;gap:6px;margin-top:8px;padding:8px 14px;background:rgba(79,70,229,.15);border:1px solid rgba(79,70,229,.3);border-radius:10px;color:#a5b4fc;font-size:11px;cursor:pointer}

/* ONBOARDING DATE */
.ob-date-opt{display:flex;gap:8px;margin-top:8px}
.ob-date-opt button{flex:1;padding:8px;background:var(--card);border:1.5px solid rgba(212,168,67,.2);color:var(--text);border-radius:9px;font-size:12px;font-family:'Cairo',sans-serif;cursor:pointer;transition:.2s}
.ob-date-opt button.active{border-color:var(--gold);background:rgba(212,168,67,.1);color:var(--gold);font-weight:700}

/* REDO DAY BUTTON */
.redo-btn{display:flex;align-items:center;justify-content:center;gap:6px;width:100%;padding:11px;background:rgba(212,168,67,.05);border:1.5px dashed rgba(212,168,67,.25);border-radius:12px;color:var(--dim);font-size:12px;font-family:'Cairo',sans-serif;cursor:pointer;margin-top:10px;transition:.2s}
.redo-btn:hover{border-color:rgba(212,168,67,.5);color:var(--gold)}

/* TAB TITLE INDICATOR */
/* handled in JS */

</style>
  <script src="gifs.js"></script>
</head>
<body>
<div class="stars" id="stars"></div>

<!-- ONBOARDING -->
<div id="ob">
  <div class="ob-dots" id="obDots">
    <div class="ob-dot on" id="d0"></div><div class="ob-dot" id="d1"></div>
    <div class="ob-dot" id="d2"></div><div class="ob-dot" id="d3"></div>
  </div>
  <!-- Step 0: Welcome + Lang -->
  <div class="ob-pg on" id="op0">
    <span class="ob-ico">âš¡</span>
    <div class="ob-h">FITPULSE PRO</div>
    <div class="ob-s" id="obs0">ØªØ­Ø¯ÙŠ Ø§Ù„Ù„ÙŠØ§Ù‚Ø© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ© â€” 30 ÙŠÙˆÙ…</div>
    <div class="ob-field">
      <label class="ob-lbl" id="obl-name">Ø§Ø³Ù…Ùƒ</label>
      <input class="ob-in" id="ob-name" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ...">
    </div>
    <div class="ob-field">
      <label class="ob-lbl" id="obl-dur">â±ï¸ Ù…Ø¯Ø© Ø§Ù„ØªØ­Ø¯ÙŠ / Challenge Duration</label>
      <div class="ob-grid" style="grid-template-columns:repeat(3,1fr);gap:8px;margin-top:6px">
        <div class="ob-opt" id="dur-7"  onclick="obDur(7)"  ><span class="ob-opt-ico">7</span><div class="ob-opt-lbl">Ø£ÙŠØ§Ù…</div></div>
        <div class="ob-opt" id="dur-14" onclick="obDur(14)" ><span class="ob-opt-ico">14</span><div class="ob-opt-lbl">ÙŠÙˆÙ…</div></div>
        <div class="ob-opt on" id="dur-30" onclick="obDur(30)"><span class="ob-opt-ico">30</span><div class="ob-opt-lbl">ÙŠÙˆÙ…</div></div>
        <div class="ob-opt" id="dur-60" onclick="obDur(60)" ><span class="ob-opt-ico">60</span><div class="ob-opt-lbl">ÙŠÙˆÙ…</div></div>
        <div class="ob-opt" id="dur-90" onclick="obDur(90)" ><span class="ob-opt-ico">90</span><div class="ob-opt-lbl">ÙŠÙˆÙ…</div></div>
        <div class="ob-opt" id="dur-custom" onclick="obDur(0)"><span class="ob-opt-ico">âœï¸</span><div class="ob-opt-lbl" id="dur-custom-lbl">Ù…Ø®ØµØµ</div></div>
      </div>
      <input class="ob-in" id="ob-custom-dur" type="number" min="7" max="365" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…..." style="display:none;margin-top:8px">
    </div>
    <div class="ob-field">
      <label class="ob-lbl">Ø§Ù„Ù„ØºØ© / Language / Langue</label>
      <div class="ob-grid" style="grid-template-columns:1fr 1fr 1fr">
        <div class="ob-opt" id="l-ar" onclick="obLang('ar')"><span class="ob-opt-ico">ðŸ‡©ðŸ‡¿</span><div class="ob-opt-lbl">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div></div>
        <div class="ob-opt" id="l-en" onclick="obLang('en')"><span class="ob-opt-ico">ðŸ‡¬ðŸ‡§</span><div class="ob-opt-lbl">English</div></div>
        <div class="ob-opt" id="l-fr" onclick="obLang('fr')"><span class="ob-opt-ico">ðŸ‡«ðŸ‡·</span><div class="ob-opt-lbl">FranÃ§ais</div></div>
      </div>
    </div>
    <button class="ob-btn" onclick="obNext()">Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
  </div>
  <!-- Step 1: Physical -->
  <div class="ob-pg" id="op1">
    <span class="ob-ico">ðŸ“</span>
    <div class="ob-h" id="obh1">Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø¬Ø³Ø¯ÙŠØ©</div>
    <div class="ob-s" id="obs1">Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø±Ø§Øª ÙˆØªØ®ØµÙŠØµ Ø§Ù„ØªØ¯Ø±ÙŠØ¨</div>
    <div class="ob-grid">
      <div class="ob-field"><label class="ob-lbl" id="obl-age">Ø§Ù„Ø¹Ù…Ø±</label><input class="ob-in" id="ob-age" type="number" min="10" max="80" placeholder="25"></div>
      <div class="ob-field"><label class="ob-lbl" id="obl-wt">Ø§Ù„ÙˆØ²Ù† (ÙƒØº)</label><input class="ob-in" id="ob-wt" type="number" min="30" max="200" placeholder="70"></div>
      <div class="ob-field"><label class="ob-lbl" id="obl-ht">Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)</label><input class="ob-in" id="ob-ht" type="number" min="100" max="220" placeholder="175"></div>
      <div class="ob-field"><label class="ob-lbl" id="obl-sex">Ø§Ù„Ø¬Ù†Ø³</label>
        <select class="ob-in" id="ob-sex"><option value="male">Ø°ÙƒØ±</option><option value="female">Ø£Ù†Ø«Ù‰</option></select>
      </div>
    </div>
    <button class="ob-btn" onclick="obNext()">Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
    <button class="ob-back" onclick="obBack()">â† Ø±Ø¬ÙˆØ¹</button>
  </div>
  <!-- Step 2: Level + Goal -->
  <div class="ob-pg" id="op2">
    <span class="ob-ico">ðŸŽ¯</span>
    <div class="ob-h" id="obh2">Ù‡Ø¯ÙÙƒ ÙˆÙ…Ø³ØªÙˆØ§Ùƒ</div>
    <div class="ob-s" id="obs2">Ø³Ù†Ø®ØµØµ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø°Ù„Ùƒ</div>
    <div class="ob-field">
      <label class="ob-lbl" id="obl-lv">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù„ÙŠØ§Ù‚Ø©</label>
      <div class="ob-grid">
        <div class="ob-opt" onclick="obSel(this,'level','beginner')"><span class="ob-opt-ico">ðŸŒ±</span><div class="ob-opt-lbl" id="lv0">Ù…Ø¨ØªØ¯Ø¦</div></div>
        <div class="ob-opt" onclick="obSel(this,'level','intermediate')"><span class="ob-opt-ico">ðŸ’ª</span><div class="ob-opt-lbl" id="lv1">Ù…ØªÙˆØ³Ø·</div></div>
        <div class="ob-opt" onclick="obSel(this,'level','advanced')"><span class="ob-opt-ico">ðŸ”¥</span><div class="ob-opt-lbl" id="lv2">Ù…ØªÙ‚Ø¯Ù…</div></div>
        <div class="ob-opt" onclick="obSel(this,'level','elite')"><span class="ob-opt-ico">âš¡</span><div class="ob-opt-lbl" id="lv3">Ù…Ø­ØªØ±Ù</div></div>
      </div>
    </div>
    <div class="ob-field" style="margin-top:10px">
      <label class="ob-lbl" id="obl-goal">Ù‡Ø¯ÙÙƒ Ù…Ù† Ø§Ù„ØªØ¯Ø±ÙŠØ¨</label>
      <div class="ob-grid">
        <div class="ob-opt" onclick="obSel(this,'goal','burn')"><span class="ob-opt-ico">ðŸ”¥</span><div class="ob-opt-lbl" id="gl0">Ø­Ø±Ù‚ Ø¯Ù‡ÙˆÙ†</div></div>
        <div class="ob-opt" onclick="obSel(this,'goal','muscle')"><span class="ob-opt-ico">ðŸ’ª</span><div class="ob-opt-lbl" id="gl1">Ø¨Ù†Ø§Ø¡ Ø¹Ø¶Ù„Ø§Øª</div></div>
        <div class="ob-opt" onclick="obSel(this,'goal','fitness')"><span class="ob-opt-ico">ðŸƒ</span><div class="ob-opt-lbl" id="gl2">Ù„ÙŠØ§Ù‚Ø© Ø¹Ø§Ù…Ø©</div></div>
        <div class="ob-opt" onclick="obSel(this,'goal','health')"><span class="ob-opt-ico">â¤ï¸</span><div class="ob-opt-lbl" id="gl3">ØµØ­Ø© ÙˆÙ†Ø´Ø§Ø·</div></div>
      </div>
    </div>
    <button class="ob-btn" onclick="obNext()">Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
    <button class="ob-back" onclick="obBack()">â† Ø±Ø¬ÙˆØ¹</button>
  </div>
  <!-- Step 3: Ready -->
  <div class="ob-pg" id="op3">
    <span class="ob-ico" style="font-size:64px">ðŸš€</span>
    <div class="ob-h" id="obh3">Ø£Ù†Øª Ø¬Ø§Ù‡Ø²!</div>
    <div class="ob-s" id="obs3">ØªØ­Ø¯ÙŠ 30 ÙŠÙˆÙ… Ø¨Ø¯Ø£. ÙƒÙ„ ÙŠÙˆÙ… Ø®Ø·ÙˆØ© Ù†Ø­Ùˆ Ø§Ù„Ø£ÙØ¶Ù„.</div>
    <div style="background:var(--c);border:1.5px solid rgba(212,168,67,.2);border-radius:14px;padding:16px;margin-bottom:16px" id="ob-sum"></div>
    <div class="ob-field" style="margin-bottom:16px">
  <label class="ob-lbl" id="obl-startdate" style="font-size:13px">ðŸ“… Ù…Ù† Ø£ÙŠ ØªØ§Ø±ÙŠØ® ØªØ¨Ø¯Ø£ØŸ</label>
  <div class="ob-date-opt">
    <button class="active" onclick="obSelectDate('today',this)" id="ob-today-btn">Ø§Ù„ÙŠÙˆÙ…</button>
    <button onclick="obSelectDate('custom',this)" id="ob-custom-btn">ØªØ§Ø±ÙŠØ® Ù…Ø­Ø¯Ø¯</button>
  </div>
  <input type="date" class="ob-in" id="ob-start-date" style="margin-top:8px;opacity:.4" onchange="obDateChange()">
</div>
<button class="ob-btn" onclick="obFinish()">ðŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ</button>
  </div>
</div>

<!-- MAIN APP -->
<div id="app">
  <div class="header">
    <div>
      <div class="app-title">âš¡ FITPULSE PRO</div>
      <div class="app-sub" id="app-sub">BURN MAX Â· 30 DAYS</div>
    </div>
    <div class="hdr-r">
      <button class="lang-btn" id="lngBtn" onclick="cycleLang()">AR</button>
      <button class="hdr-ico" id="aiBtnHdr" onclick="openAI()" title="AI Coach">ðŸ¤–</button>
      <button class="hdr-ico" onclick="showView('settings')">âš™ï¸</button>
    </div>
  </div>
  <div class="quote-card" id="quoteCard"></div>
  <div class="daily-msg" id="dailyMsg" style="display:none"></div>
  <div class="stats-bar">
    <div class="stat-chip"><span class="stat-v" id="st0">0</span><div class="stat-l" id="stl0">Ø³Ù„Ø³Ù„Ø©</div></div>
    <div class="stat-chip"><span class="stat-v" id="st1">0</span><div class="stat-l" id="stl1">ÙŠÙˆÙ… Ù…ÙƒØªÙ…Ù„</div></div>
    <div class="stat-chip"><span class="stat-v" id="st2">0</span><div class="stat-l" id="stl2">Ø³Ø¹Ø±Ø©</div></div>
    <div class="stat-chip"><span class="stat-v" id="st3">0</span><div class="stat-l" id="stl3">Ø¯Ù‚ÙŠÙ‚Ø©</div></div>
    <div class="stat-chip"><span class="stat-v" id="st4">0</span><div class="stat-l" id="stl4">Ø´Ø§Ø±Ø©</div></div>
  </div>
  <div class="nav-tabs" id="navTabs">
    <button class="nav-tab on" onclick="showView('workout')" data-v="workout"><span class="ti">ðŸ‹ï¸</span><span id="nt0">ØªØ¯Ø±ÙŠØ¨</span></button>
    <button class="nav-tab" onclick="showView('challenge')" data-v="challenge"><span class="ti">ðŸ“…</span><span id="nt1">ØªØ­Ø¯ÙŠ</span></button>
    <button class="nav-tab" onclick="showView('timer')" data-v="timer"><span class="ti">â±ï¸</span><span id="nt2">Ù…Ø¤Ù‚Øª</span></button>
    <button class="nav-tab" onclick="showView('track')" data-v="track"><span class="ti">ðŸ“Š</span><span id="nt3">ØªØªØ¨Ø¹</span></button>
    <button class="nav-tab" onclick="showView('tips')" data-v="tips"><span class="ti">ðŸ’¡</span><span id="nt4">Ù†ØµØ§Ø¦Ø­</span></button>
  </div>

  <div class="view active" id="view-workout">
    <div class="day-sel" id="daySel"></div>
    <div id="wkContent"></div>
  </div>
  <div class="view" id="view-challenge">
    <div class="ch-card" id="chCard"></div>
    <div class="sec" id="sec-cal">ðŸ“… Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</div>
    <div class="cal-grid" id="calGrid"></div>
    <div class="sec" style="margin-top:18px" id="sec-plans">ðŸ“‹ Ø§Ù„Ø®Ø·Ø·</div>
    <div id="plansList"></div>
    <button class="bbtn gold" onclick="createPlan()" style="margin-top:4px">âž• <span id="btn-newplan">Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø¬Ø¯ÙŠØ¯Ø©</span></button>
  </div>
  <div class="view" id="view-timer">
    <div class="timer-wrap">
      <svg width="0" height="0" style="position:absolute"><defs><linearGradient id="tg" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#A07820"/><stop offset="100%" stop-color="#F2C95C"/></linearGradient></defs></svg>
      <div class="t-ring">
        <svg class="t-svg" viewBox="0 0 196 196"><circle class="t-track" cx="98" cy="98" r="85"/><circle class="t-prog" id="tProg" cx="98" cy="98" r="85"/></svg>
        <div class="t-center">
          <div class="t-time" id="tDisp">00:00</div>
          <div class="t-phase" id="tPhase">Ø¬Ø§Ù‡Ø²</div>
          <div class="t-label" id="tLabel"></div>
        </div>
      </div>
      <div class="t-ctrls">
        <button class="tc" onclick="tAct('reset')">â†º</button>
        <button class="tc main" id="tMainBtn" onclick="tAct('toggle')">â–¶</button>
        <button class="tc" id="tSndBtn" onclick="tAct('sound')">ðŸ””</button>
        <button class="tc" onclick="openSoundSettings()" title="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª">âš™ï¸ðŸŽµ</button>
      </div>
      <div class="presets" id="timerPresets"></div>
      <div class="tabata-box">
        <div class="tab-row"><span id="tbl-work">ÙˆÙ‚Øª Ø§Ù„Ø¹Ù…Ù„ (Ø«)</span><div class="tab-ctrl"><button class="t-adj" onclick="adjT('w',-5)">âˆ’</button><div class="t-val" id="tv-w">20</div><button class="t-adj" onclick="adjT('w',5)">+</button></div></div>
        <div class="tab-row"><span id="tbl-rest">ÙˆÙ‚Øª Ø§Ù„Ø±Ø§Ø­Ø© (Ø«)</span><div class="tab-ctrl"><button class="t-adj" onclick="adjT('r',-5)">âˆ’</button><div class="t-val" id="tv-r">10</div><button class="t-adj" onclick="adjT('r',5)">+</button></div></div>
        <div class="tab-row"><span id="tbl-rnds">Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</span><div class="tab-ctrl"><button class="t-adj" onclick="adjT('n',-1)">âˆ’</button><div class="t-val" id="tv-n">8</div><button class="t-adj" onclick="adjT('n',1)">+</button></div></div>
        <button class="bbtn red" style="padding:10px;margin-top:8px;font-size:13px" onclick="startTabata()">ðŸ”¥ <span id="btn-tabata">Ø¨Ø¯Ø¡ ØªØ§Ø¨Ø§ØªØ§</span></button>
      </div>
    </div>
    <div style="padding:0 14px"><div class="rope-card" id="ropeCard"></div></div>
  </div>
  <div class="view" id="view-track">
    <div class="track-grid" id="trackGrid"></div>
    <div class="body-card" id="bodyCard"></div>
    <div class="burn-card" id="burnCard"></div>
    <div class="sec" id="sec-badges">ðŸ† Ø§Ù„Ø´Ø§Ø±Ø§Øª</div>
    <div class="badge-grid" id="badgeGrid"></div>
    <div class="sec" id="sec-hist">ðŸ“œ Ø§Ù„Ø³Ø¬Ù„</div>
    <div id="histList"></div>
  </div>
  <div class="view" id="view-tips"><div id="tipsContent"></div></div>
  <div class="view" id="view-settings">
    <div class="prof-card" id="profCard"></div>
    <div id="settContent"></div>
  </div>
</div>

<!-- FABs -->
<button class="fab-theme" id="fabTheme" onclick="toggleTheme()">ðŸŽ¨</button>
<div class="theme-panel" id="themePanel"></div>
<button class="mode-fab" id="fabMode" onclick="cycleMode()"><div class="mf-dot"></div><span id="modeLabel">ðŸ“±</span></button>


<!-- BOTTOM NAV -->
<div class="bnav">
  <div class="bn on" onclick="showView('workout')" data-v="workout"><div class="bn-ico">ðŸ‹ï¸</div><div class="bn-lbl" id="bn0">ØªØ¯Ø±ÙŠØ¨</div></div>
  <div class="bn" onclick="showView('challenge')" data-v="challenge"><div class="bn-ico">ðŸ“…</div><div class="bn-lbl" id="bn1">ØªØ­Ø¯ÙŠ</div></div>
  <div class="bn" onclick="showView('timer')" data-v="timer"><div class="bn-ico">â±ï¸</div><div class="bn-lbl" id="bn2">Ù…Ø¤Ù‚Øª</div></div>
  <div class="bn" onclick="showView('track')" data-v="track"><div class="bn-ico">ðŸ“Š</div><div class="bn-lbl" id="bn3">ØªØªØ¨Ø¹</div></div>
  <div class="bn" onclick="showView('tips')" data-v="tips"><div class="bn-ico">ðŸ’¡</div><div class="bn-lbl" id="bn4">Ù†ØµØ§Ø¦Ø­</div></div>
</div>

<!-- OVERLAYS -->
<!-- Day Editor -->
<div class="overlay" id="dayEditor">
  <div class="ov-hdr">
    <button class="ov-close" onclick="closeDayEditor()">âœ•</button>
    <div class="ov-title" id="deTitle">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…</div>
    <button class="ov-btn dim" style="flex:unset;padding:6px 12px;font-size:11px" onclick="restoreDay()">â†© <span id="btn-restore">Ø§Ø³ØªØ¹Ø§Ø¯Ø©</span></button>
  </div>
  <div class="ov-body">
    <div class="ov-hint" id="deHint">Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹ Ø¹Ù„Ù‰ ØªÙ…Ø±ÙŠÙ† Ù„ØªØ­Ø±ÙŠÙƒÙ‡ â€¢ Ø§Ø³Ø­Ø¨ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨</div>
    <div id="deList"></div>
  </div>
  <div class="ov-footer">
    <button class="ov-btn gold" onclick="openExPicker('add')">âž• <span id="btn-addex">Ø¥Ø¶Ø§ÙØ©</span></button>
    <button class="ov-btn grn" onclick="saveDayEdit()">âœ“ <span id="btn-save">Ø­ÙØ¸</span></button>
  </div>
</div>

<!-- Exercise Picker -->
<div class="overlay" id="exPicker" style="z-index:850">
  <div class="ov-hdr">
    <button class="ov-close" onclick="closeExPicker()">âœ•</button>
    <div class="ov-title" id="epTitle">Ø§Ø®ØªØ± ØªÙ…Ø±ÙŠÙ†Ø§Ù‹</div>
  </div>
  <input class="ep-search" id="epSearch" placeholder="ðŸ” Ø§Ø¨Ø­Ø«..." oninput="renderEpList()">
  <div class="ep-tabs">
    <button class="ep-tab on" onclick="epSetTab('all')" id="ept-all">Ø§Ù„ÙƒÙ„</button>
    <button class="ep-tab" onclick="epSetTab('custom')" id="ept-custom">Ù…Ø®ØµØµØ©</button>
    <button class="ep-tab" onclick="epSetTab('fav')" id="ept-fav">Ø§Ù„Ù…ÙØ¶Ù„Ø©</button>
  </div>
  <div class="ep-list" id="epList"></div>
  <button class="ep-new-btn" onclick="openCreateEx()">âœ¨ <span id="btn-createex">Ø¥Ù†Ø´Ø§Ø¡ ØªÙ…Ø±ÙŠÙ† Ø¬Ø¯ÙŠØ¯</span></button>
</div>

<!-- Create Exercise -->
<div class="overlay" id="createExOv" style="z-index:900">
  <div class="ov-hdr">
    <button class="ov-close" onclick="closeCreateEx()">âœ•</button>
    <div class="ov-title" id="ceTitle">ØªÙ…Ø±ÙŠÙ† Ø¬Ø¯ÙŠØ¯</div>
  </div>
  <div class="ov-body">
    <div class="ce-field"><label class="ce-lbl" id="cel-name">Ø§Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ† (Ø¹Ø±Ø¨ÙŠ)</label><input class="ce-in" id="ce-nameAr" placeholder="Ø§Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ†..."></div>
    <div class="ce-field"><label class="ce-lbl">Exercise Name (English)</label><input class="ce-in" id="ce-nameEn" placeholder="Exercise name..."></div>
    <div class="ce-r2">
      <div class="ce-field"><label class="ce-lbl" id="cel-sets">Ø§Ù„Ø¬Ù„Ø³Ø§Øª</label><input class="ce-in" id="ce-sets" type="number" value="3" min="1" max="20"></div>
      <div class="ce-field"><label class="ce-lbl" id="cel-reps">Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª</label><input class="ce-in" id="ce-reps" type="number" value="12" min="1" max="200"></div>
      <div class="ce-field"><label class="ce-lbl" id="cel-dur">Ù…Ø¯Ø© (Ø«Ø§Ù†ÙŠØ©)</label><input class="ce-in" id="ce-dur" type="number" value="30" min="0" max="600"></div>
      <div class="ce-field"><label class="ce-lbl" id="cel-rest">Ø±Ø§Ø­Ø© (Ø«Ø§Ù†ÙŠØ©)</label><input class="ce-in" id="ce-rest" type="number" value="60" min="0" max="300"></div>
    </div>
    <div class="ce-field"><label class="ce-lbl" id="cel-muscle">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¹Ø¶Ù„ÙŠØ©</label>
      <select class="ce-sel" id="ce-muscle">
        <option value="full">Ø§Ù„Ø¬Ø³Ù… ÙƒØ§Ù…Ù„</option><option value="chest">Ø§Ù„ØµØ¯Ø±</option>
        <option value="back">Ø§Ù„Ø¸Ù‡Ø±</option><option value="legs">Ø§Ù„Ø£Ø±Ø¬Ù„</option>
        <option value="arms">Ø§Ù„Ø£Ø°Ø±Ø¹</option><option value="core">Ø§Ù„ÙƒÙˆØ±</option>
        <option value="cardio">ÙƒØ§Ø±Ø¯ÙŠÙˆ</option><option value="shoulders">Ø§Ù„Ø£ÙƒØªØ§Ù</option>
      </select>
    </div>
    <div class="ce-field"><label class="ce-lbl" id="cel-instr">Ø§Ù„Ø®Ø·ÙˆØ§Øª / Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª</label><textarea class="ce-ta" id="ce-instr" placeholder="Ø§Ø´Ø±Ø­ Ø·Ø±ÙŠÙ‚Ø© Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙ…Ø±ÙŠÙ† (Ø³Ø·Ø± Ù„ÙƒÙ„ Ø®Ø·ÙˆØ©)..."></textarea></div>
    <button onclick="openGifGuide()" style="display:flex;align-items:center;gap:6px;width:100%;padding:10px 14px;background:rgba(99,102,241,.08);border:1.5px solid rgba(99,102,241,.25);border-radius:12px;color:#a5b4fc;font-size:12px;font-family:'Cairo',sans-serif;cursor:pointer;margin-bottom:12px">
  <span style="font-size:16px">ðŸŽ¬</span>
  <div style="text-align:right"><div style="font-weight:700" id="gifGuideBtn">ÙƒÙŠÙ Ø£Ø­ØµÙ„ Ø¹Ù„Ù‰ ØµÙˆØ± GIF Ù…ØªØ­Ø±ÙƒØ©ØŸ</div><div style="font-size:10px;opacity:.7" id="gifGuideSub">Ø¯Ù„ÙŠÙ„ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©</div></div>
  <span style="margin-right:auto">â€º</span>
</button>
<div class="ce-field">
      <label class="ce-lbl" id="cel-photos">ØµÙˆØ± Ø§Ù„ØªÙ…Ø±ÙŠÙ† (Ø­ØªÙ‰ 3 ØµÙˆØ±)</label>
      <div class="photo-area" id="photoArea">
        <div class="photo-slot" id="ps0" onclick="triggerPhoto(0)"><span class="ps-ico">ðŸ“·</span><span class="ps-lbl" id="psl0">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</span></div>
        <div class="photo-slot" id="ps1" onclick="triggerPhoto(1)" style="opacity:.5"><span class="ps-ico">ðŸ“·</span><span class="ps-lbl" id="psl1">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</span></div>
        <div class="photo-slot" id="ps2" onclick="triggerPhoto(2)" style="opacity:.5"><span class="ps-ico">ðŸ“·</span><span class="ps-lbl" id="psl2">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</span></div>
      </div>
      <input type="file" id="photoInput" accept="image/*" style="display:none" onchange="onPhoto(event)">
    </div>
  </div>
  <div class="ov-footer">
    <button class="ov-btn dim" onclick="closeCreateEx()"><span id="btn-cancel">Ø¥Ù„ØºØ§Ø¡</span></button>
    <button class="ov-btn gold" onclick="saveCustomEx()">ðŸ’¾ <span id="btn-saveex">Ø­ÙØ¸ Ø§Ù„ØªÙ…Ø±ÙŠÙ†</span></button>
  </div>
</div>

<!-- Guided Session -->
<div class="guided-ov" id="guidedOv">
  <div class="gd-hdr">
    <button class="ov-close" onclick="closeGuided()">âœ•</button>
    <div class="gd-pw"><div class="gd-pf" id="gdPF"></div></div>
    <div class="gd-cnt" id="gdCnt">0/0</div>
    <button class="tc" style="width:30px;height:30px;font-size:12px" onclick="toggleGdList()">â˜°</button>
  </div>
  <div class="gd-body">
    <div class="phase-pill ready" id="gdPill">Ø¬Ø§Ù‡Ø²</div>
    <div class="gd-name" id="gdName">-</div>
    <div class="gd-sub" id="gdSub">-</div>
    <div class="gd-illus" id="gdIllus"></div>
    <div class="gd-timer ready-t" id="gdTimer">GO</div>
    <div class="gd-tlbl" id="gdTlbl"></div>
    <div class="gd-dots" id="gdDots"></div>
    <div class="gd-stats">
      <div class="gd-stat"><b id="gds0">0</b><span id="gdsl0">ØªÙ…Ø§Ø±ÙŠÙ†</span></div>
      <div class="gd-stat"><b id="gds1">00:00</b><span id="gdsl1">Ø§Ù„ÙˆÙ‚Øª</span></div>
      <div class="gd-stat"><b id="gds2">0</b><span id="gdsl2">Ø³Ø¹Ø±Ø©</span></div>
    </div>
    <div class="gd-acts">
      <button class="gd-skip" onclick="gdSkip()">â­</button>
      <button class="gd-main" id="gdMainBtn" onclick="gdAction()">Ø§Ø¨Ø¯Ø£</button>
      <button class="gd-skip" onclick="gdPause()" id="gdPauseBtn">â¸</button>
    </div>
  </div>
  <div id="gdListPanel" style="display:none;padding:10px 14px;border-top:1px solid rgba(255,255,255,.04)"></div>
</div>

<!-- Countdown -->
<div class="cdown-ov" id="cdownOv"><div class="cdown-n" id="cdownN">3</div><div style="font-size:15px;color:var(--dim)" id="cdownLbl">Ø§Ø³ØªØ¹Ø¯!</div></div>

<!-- Completion -->
<div class="comp-ov" id="compOv">
  <div class="comp-ico">ðŸŽ‰</div>
  <div class="comp-title" id="compTitle">Ø£Ø­Ø³Ù†Øª!</div>
  <div class="comp-sub" id="compSub"></div>
  <div class="comp-stats" id="compStats"></div>
  <button class="ob-btn" onclick="closeComp()" style="max-width:200px">âœ“ Ø¥ØºÙ„Ø§Ù‚</button>
<button class="redo-btn" id="redoDayBtn" onclick="redoDay(S.day)" style="max-width:300px;margin:8px auto 0">
  <span>ðŸ”</span><span id="redoBtnTxt">Ø£Ø¹Ø¯ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</span>
</button>
</div>

<!-- Badge Toast -->
<div class="bdg-toast" id="bdgToast">
  <div class="bdg-toast-ico" id="bdgIco">ðŸ†</div>
  <div><div class="bdg-toast-title" id="bdgTtl">Ø´Ø§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©!</div><div class="bdg-toast-name" id="bdgName"></div></div>
</div>

<!-- Notify -->
<div class="notify" id="notify"></div>

<!-- Confirm -->
<div class="confirm-ov" id="confirmOv">
  <div class="confirm-box">
    <div class="confirm-ico" id="cfmIco">âš ï¸</div>
    <div class="confirm-msg" id="cfmMsg"></div>
    <div class="confirm-btns">
      <button class="confirm-yes" id="cfmYes">Ù†Ø¹Ù…</button>
      <button class="confirm-no" onclick="closeConfirm()">Ù„Ø§</button>
    </div>
  </div>
</div>

<!-- Desktop Shell -->
<div id="dtShell">
  <svg width="0" height="0" style="position:absolute"><defs><linearGradient id="dtg" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#A07820"/><stop offset="100%" stop-color="#F2C95C"/></linearGradient></defs></svg>
  <div class="dt-top">
    <div><div class="dt-logo">âš¡ FITPULSE PRO</div><div class="dt-sub">BURN MAX</div></div>
    <div class="dt-days" id="dtDays"></div>
    <div class="dt-acts">
      <button class="lang-btn" onclick="cycleLang()" id="dtLngBtn">AR</button>
      <button class="dt-btn" onclick="dtStartSession()">ðŸ”¥ <span id="dt-startsess">Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©</span></button>
      <button class="dt-btn" onclick="openDayEditor(S.day)">âœï¸ <span id="dt-editday">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…</span></button>
      <button class="dt-btn" onclick="toggleKb()" title="Shortcuts">âŒ¨ï¸</button>
      <button class="dt-btn" onclick="toggleTheme()">ðŸŽ¨</button>
      <button class="dt-btn" onclick="cycleMode()">ðŸ“±</button>
    </div>
  </div>
  <div class="dt-main">
    <div class="dt-left">
      <div class="dt-lhdr">
        <div class="dt-ltitle" id="dt-extitle">Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†</div>
        <button class="dt-sess-btn" onclick="dtStartSession()">ðŸ”¥ <span id="dt-start">Ø§Ø¨Ø¯Ø£</span></button>
      </div>
      <div class="dt-exlist" id="dtExList"></div>
    </div>
    <div class="dt-center" id="dtCenter"></div>
    <div class="dt-right">
      <div class="dt-panel">
        <div class="dt-ptitle" id="dt-todaytitle">Ø¥Ø­ØµØ§Ø¡ Ø§Ù„ÙŠÙˆÙ…</div>
        <div class="dt-srow"><span class="dt-slbl" id="dt-donel">Ù…ÙƒØªÙ…Ù„</span><span class="dt-sval" id="dt-done">0/0</span></div>
        <div class="dt-srow"><span class="dt-slbl" id="dt-kcall">Ø³Ø¹Ø±Ø©</span><span class="dt-sval" id="dt-kcal">0</span></div>
        <div class="dt-srow"><span class="dt-slbl" id="dt-strkl">Ø³Ù„Ø³Ù„Ø©</span><span class="dt-sval" id="dt-strk">0</span></div>
        <div class="dt-srow"><span class="dt-slbl" id="dt-totl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><span class="dt-sval" id="dt-tot">0</span></div>
      </div>
      <div class="dt-panel">
        <div class="dt-ptitle" id="dt-timerl">Ø§Ù„Ù…Ø¤Ù‚Øª</div>
        <div class="dt-tring">
          <svg class="dt-tsvg" viewBox="0 0 110 110"><circle class="dt-ttrack" cx="55" cy="55" r="50"/><circle class="dt-tprog" id="dtTProg" cx="55" cy="55" r="50"/></svg>
          <div class="dt-tcenter"><div class="dt-ttime" id="dtTDisp">00:00</div><div class="dt-tphase" id="dtTPhase">Ø¬Ø§Ù‡Ø²</div></div>
        </div>
        <div class="dt-tctrls">
          <button class="dt-tcb" onclick="tAct('reset')">â†º</button>
          <button class="dt-tcb main" onclick="tAct('toggle')" id="dtTMain">â–¶</button>
          <button class="dt-tcb" onclick="tAct('sound')" id="dtSnd">ðŸ””</button>
        </div>
        <div class="presets" style="margin-top:7px;gap:3px" id="dtPresets"></div>
      </div>
    </div>
  </div>
  <div class="kb-panel" id="kbPanel">
    <div class="kb-title"><span>âŒ¨ï¸ Shortcuts</span><button onclick="toggleKb()" style="background:none;border:none;color:var(--dim);cursor:pointer;font-size:14px">âœ•</button></div>
    <div id="kbList"></div>
  </div>
</div>

<!-- CONFIRM MODAL -->
<div class="co-modal" id="confirmOv">
  <div class="co-box">
    <div class="co-ico" id="confirmIco">âš ï¸</div>
    <div class="co-msg" id="confirmMsg"></div>
    <div class="co-btns">
      <button class="co-yes" onclick="doConfirmYes()" id="t-yes">Ù†Ø¹Ù…</button>
      <button class="co-no" onclick="closeConfirm()">Ù„Ø§</button>
    </div>
  </div>
</div>

<!-- NOTIFY -->
<div class="notify" id="notify"></div>

<!-- BADGE TOAST -->
<div class="badge-toast" id="badgeToast">
  <div style="font-size:26px" id="btIcon">ðŸ†</div>
  <div>
    <div style="font-size:10px;color:var(--dim)" id="t-badgeearn">Ø´Ø§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©!</div>
    <div style="font-size:14px;font-weight:900;color:var(--g)" id="btName"></div>
  </div>
</div>

<!-- CONFETTI container -->
<div id="confetti" style="position:fixed;inset:0;pointer-events:none;z-index:999"></div>
<style>
.co-modal{position:fixed;inset:0;background:rgba(0,0,0,.82);z-index:950;display:none;align-items:center;justify-content:center;padding:20px}
.co-modal.open{display:flex;animation:fadeIn .2s ease}
.co-box{background:var(--d);border:1px solid rgba(212,168,67,.2);border-radius:18px;padding:24px;max-width:320px;width:100%;text-align:center}
.co-ico{font-size:36px;margin-bottom:10px}
.co-msg{font-size:14px;font-weight:600;margin-bottom:18px;line-height:1.6}
.co-btns{display:flex;gap:10px}
.co-yes{flex:1;padding:11px;background:linear-gradient(135deg,var(--red),#C0392B);color:#fff;font-size:13px;font-weight:700;border:none;border-radius:9px;cursor:pointer}
.co-no{flex:1;padding:11px;background:var(--c);border:1px solid rgba(255,255,255,.08);color:var(--dim);font-size:13px;border-radius:9px;cursor:pointer}
.badge-toast{position:fixed;top:-80px;left:50%;transform:translateX(-50%);background:var(--c);border:1.5px solid var(--g);border-radius:14px;padding:14px 20px;z-index:1000;display:flex;align-items:center;gap:10px;box-shadow:0 8px 32px rgba(0,0,0,.5);transition:top .4s cubic-bezier(.32,.72,0,1);min-width:240px}
.badge-toast.show{top:20px}
.notify{position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-70px);background:var(--c);border:1px solid rgba(212,168,67,.3);border-radius:10px;padding:10px 18px;z-index:900;font-size:13px;font-weight:700;color:var(--g);box-shadow:0 8px 24px rgba(0,0,0,.4);transition:transform .3s;white-space:nowrap}
.notify.show{transform:translateX(-50%) translateY(0)}
</style>


<!-- MODE TOAST -->
<div class="mode-toast" id="modeToast">
  <div class="mt-icon" id="modeToastIco">ðŸ“±</div>
  <div class="mt-info">
    <div class="mt-name" id="modeToastName">ÙˆØ¶Ø¹ Ø§Ù„Ø¬ÙˆØ§Ù„</div>
    <div class="mt-desc" id="modeToastDesc">Ø´Ø§Ø´Ø© ØµØºÙŠØ±Ø© Ù…Ø­Ø³Ù‘Ù†Ø©</div>
  </div>
</div>

<!-- WATER REMINDER -->
<div class="water-toast" id="waterToast">
  <div class="wt-icon">ðŸ’§</div>
  <div class="wt-text">
    <div class="wt-title" id="wtTitle">ÙˆÙ‚Øª Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡!</div>
    <div class="wt-sub" id="wtSub">Ø§Ø¨Ù‚ Ø±Ø·Ø¨Ø§Ù‹ â€¢ Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ ÙŠØ­Ø³Ù‘Ù† Ø§Ù„Ø£Ø¯Ø§Ø¡</div>
  </div>
  <button class="wt-dismiss" onclick="dismissWater()">âœ“</button>
</div>

<!-- DND BADGE -->
<div class="dnd-badge" id="dndBadge">ðŸŒ™ <span id="dndText">ÙˆØ¶Ø¹ Ø§Ù„Ù‡Ø¯ÙˆØ¡</span></div>

<!-- GIF GUIDE OVERLAY -->
<div class="gif-guide-ov" id="gifGuideOv">
  <div class="gif-guide-box">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
      <div>
        <div style="font-size:17px;font-weight:900">ðŸŽ¯ ÙƒÙŠÙ ØªØ­ØµÙ„ Ø¹Ù„Ù‰ ØµÙˆØ± GIFØŸ</div>
        <div style="font-size:11px;color:var(--dim);margin-top:2px" id="ggSub">Ø¯Ù„ÙŠÙ„ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©</div>
      </div>
      <button onclick="closeGifGuide()" style="width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,.07);color:var(--dim);font-size:14px">âœ•</button>
    </div>
    <div class="gg-step">
      <div class="gg-num">1</div>
      <div class="gg-text">
        <h4 id="gg1t">Ø§ÙØªØ­ Google Ø£Ùˆ Giphy</h4>
        <p id="gg1d">Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© + ÙƒÙ„Ù…Ø© "gif" Ù…Ø«Ù„: "push up exercise gif"</p>
        <span class="gg-link">ðŸ” Google Images</span>
        <span class="gg-link" style="margin-right:6px">ðŸŽ¬ Giphy.com</span>
      </div>
    </div>
    <div class="gg-step">
      <div class="gg-num">2</div>
      <div class="gg-text">
        <h4 id="gg2t">Ø§Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©</h4>
        <p id="gg2d">Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ: Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© â† "Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©" | Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨: ÙƒÙ„ÙŠÙƒ ÙŠÙ…ÙŠÙ† â† "Ø­ÙØ¸ Ø¨Ø§Ø³Ù…"</p>
      </div>
    </div>
    <div class="gg-step">
      <div class="gg-num">3</div>
      <div class="gg-text">
        <h4 id="gg3t">ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ù„Ù GIF</h4>
        <p id="gg3d">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙ†ØªÙ‡ÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø¨Ù€ .gif Ø­ØªÙ‰ ØªØ¸Ù‡Ø± Ø§Ù„Ø­Ø±ÙƒØ© Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</p>
      </div>
    </div>
    <div class="gg-step">
      <div class="gg-num">4</div>
      <div class="gg-text">
        <h4 id="gg4t">Ø§Ø±ÙØ¹Ù‡Ø§ ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„ØµÙˆØ±</h4>
        <p id="gg4d">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…Ù†Ø·Ù‚Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ÙˆØ§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø°ÙŠ Ø­ÙØ¸ØªÙ‡ â€” Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø­Ø±ÙƒØ© Ù…Ø¨Ø§Ø´Ø±Ø©!</p>
      </div>
    </div>
    <div style="background:rgba(212,168,67,.05);border:1px solid rgba(212,168,67,.15);border-radius:12px;padding:12px;margin-top:4px">
      <div style="font-size:11px;font-weight:700;color:var(--gold);margin-bottom:4px" id="ggTipTitle">ðŸ’¡ Ù†ØµÙŠØ­Ø©</div>
      <div style="font-size:11px;color:var(--dim)" id="ggTipText">Ø§Ø¨Ø­Ø« Ø¹Ù† GIF Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ø£ÙØ¶Ù„. Ù…Ø«Ø§Ù„: "squat exercise animation gif"</div>
    </div>
  </div>
</div>

<!-- SOUND CONTROL MODAL -->
<div class="sound-modal" id="soundModal">
  <div class="sound-box">
    <div class="snd-title" id="sndTitle">ðŸŽµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª</div>
    <div class="snd-sub" id="sndSub">Ø§Ø®ØªØ± Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯Ù‡Ø§ Ø®Ù„Ø§Ù„ Ø§Ù„Ø¬Ù„Ø³Ø©</div>
    <div class="master-vol">
      <span style="font-size:14px">ðŸ”Š</span>
      <input type="range" class="vol-slider" id="masterVol" min="0" max="100" value="80" oninput="setMasterVol(this.value)">
      <span style="font-size:11px;color:var(--dim);min-width:28px" id="volPct">80%</span>
    </div>
    <div class="snd-row">
      <div class="snd-ico">â±</div>
      <div class="snd-info"><div class="si-name" id="snd1n">ØµÙˆØª Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ</div><div class="si-desc" id="snd1d">3-2-1 Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ ÙƒÙ„ ØªÙ…Ø±ÙŠÙ†</div></div>
      <label class="snd-toggle"><input type="checkbox" id="sndCountdown" checked><span class="snd-sl"></span></label>
    </div>
    <div class="snd-row">
      <div class="snd-ico">ðŸ””</div>
      <div class="snd-info"><div class="si-name" id="snd2n">Ø¬Ø±Ø³ Ø§Ù„Ø±Ø§Ø­Ø©</div><div class="si-desc" id="snd2d">ØµÙˆØª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ ÙˆÙ‚Øª Ø§Ù„Ø±Ø§Ø­Ø©</div></div>
      <label class="snd-toggle"><input type="checkbox" id="sndRest" checked><span class="snd-sl"></span></label>
    </div>
    <div class="snd-row">
      <div class="snd-ico">âœ…</div>
      <div class="snd-info"><div class="si-name" id="snd3n">Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¬Ù„Ø³Ø©</div><div class="si-desc" id="snd3d">Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø¹Ù†Ø¯ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØ¯Ø±ÙŠØ¨</div></div>
      <label class="snd-toggle"><input type="checkbox" id="sndComplete" checked><span class="snd-sl"></span></label>
    </div>
    <div class="snd-row">
      <div class="snd-ico">ðŸ’ª</div>
      <div class="snd-info"><div class="si-name" id="snd4n">Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¬Ù„Ø³Ø©</div><div class="si-desc" id="snd4d">Ù†Ù‚Ø±Ø© Ø¹Ù†Ø¯ Ø¥Ù†Ù‡Ø§Ø¡ ÙƒÙ„ Ø¬Ù„Ø³Ø©</div></div>
      <label class="snd-toggle"><input type="checkbox" id="sndSet" checked><span class="snd-sl"></span></label>
    </div>
    <button class="snd-start-btn" id="sndStartBtn" onclick="confirmStartSession()">ðŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
  </div>
</div>

<!-- TUTORIAL OVERLAY -->
<div class="tutorial-ov" id="tutorialOv">
  <div class="tutorial-spotlight" id="tutSpotlight"></div>
  <div class="tutorial-card" id="tutCard">
    <div class="tutorial-dots" id="tutDots"></div>
    <div class="tutorial-step" id="tutStep">Ø§Ù„Ø®Ø·ÙˆØ© 1 Ù…Ù† 7</div>
    <div class="tutorial-title" id="tutTitle">Ù…Ø±Ø­Ø¨Ø§Ù‹!</div>
    <div class="tutorial-desc" id="tutDesc">Ø¯Ø¹Ù†Ø§ Ù†ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¹Ø§Ù‹</div>
    <div class="tutorial-actions">
      <button class="tut-skip" onclick="skipTutorial()" id="tutSkipBtn">ØªØ®Ø·ÙŠ</button>
      <button class="tut-next" onclick="nextTutorial()" id="tutNextBtn">Ø§Ù„ØªØ§Ù„ÙŠ â†</button>
    </div>
  </div>
</div>

<!-- WEEKLY SUMMARY -->
<div class="weekly-ov" id="weeklyOv">
  <div class="wk-hero">
    <div class="wk-trophy" id="wkTrophy">ðŸ†</div>
    <div class="wk-week" id="wkWeekLbl">Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
    <div class="wk-title" id="wkTitle">Ø£Ø³Ø¨ÙˆØ¹ Ø±Ø§Ø¦Ø¹!</div>
    <div class="wk-sub" id="wkSub">Ø¥Ù„ÙŠÙƒ Ù†ØªØ§Ø¦Ø¬Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
  </div>
  <div class="wk-grid" id="wkGrid"></div>
  <div class="wk-bar-section">
    <div class="wk-bar-title" id="wkBarTitle">Ù†Ø´Ø§Ø· Ø§Ù„Ø£ÙŠØ§Ù…</div>
    <div class="wk-day-bars" id="wkDayBars"></div>
  </div>
  <div class="wk-msg" id="wkMsg"></div>
  <button class="wk-close-btn" id="wkCloseBtn" onclick="closeWeekly()">âœ“ Ø§Ø³ØªÙ…Ø±</button>
</div>

<!-- AI COACH OVERLAY -->
<div class="ai-overlay" id="aiOverlay">
  <div class="ai-header">
    <div class="ai-avatar">ðŸ¤–</div>
    <div class="ai-hdr-info">
      <div class="ai-name" id="aiName">Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø°ÙƒÙŠ</div>
      <div class="ai-status" id="aiStatus">Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</div>
    </div>
    <button onclick="closeAI()" style="margin-right:auto;padding:6px 12px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);color:var(--dim);border-radius:8px;font-size:11px;cursor:pointer" id="aiCloseBtn">âœ•</button>
  </div>
  <div class="ai-messages" id="aiMessages"></div>
  <div class="ai-chips" id="aiChips"></div>
  <div class="ai-input-row">
    <textarea class="ai-input" id="aiInput" rows="1" id="aiInputBox" placeholder="Ø§Ø³Ø£Ù„ Ù…Ø¯Ø±Ø¨Ùƒ..."></textarea>
    <div class="ai-send" onclick="sendAIMsg()">âž¤</div>
  </div>
</div>


<script>
'use strict';

// ============================================================
// LANGUAGE SYSTEM
// ============================================================
const LANG = {
  ar:{dir:'rtl',
    streak:'Ø³Ù„Ø³Ù„Ø©',days:'ÙŠÙˆÙ…',kcal:'Ø³Ø¹Ø±Ø©',min:'Ø¯Ù‚ÙŠÙ‚Ø©',badges:'Ø´Ø§Ø±Ø©',
    sets:'Ø¬Ù„Ø³Ø§Øª',reps:'ØªÙƒØ±Ø§Ø±Ø§Øª',dur:'Ù…Ø¯Ø©',rest_s:'Ø±Ø§Ø­Ø© (Ø«)',
    start:'Ø§Ø¨Ø¯Ø£',start_sess:'Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©',edit_day:'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…',mark_done:'Ø¥ØªÙ…Ø§Ù… Ø§Ù„ÙŠÙˆÙ…',
    restore:'Ø§Ø³ØªØ¹Ø§Ø¯Ø©',save:'Ø­ÙØ¸',cancel:'Ø¥Ù„ØºØ§Ø¡',back:'Ø±Ø¬ÙˆØ¹',
    add_ex:'Ø¥Ø¶Ø§ÙØ© ØªÙ…Ø±ÙŠÙ†',create_ex:'Ø¥Ù†Ø´Ø§Ø¡ ØªÙ…Ø±ÙŠÙ† Ø¬Ø¯ÙŠØ¯',add_photo:'Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©',save_ex:'Ø­ÙØ¸ Ø§Ù„ØªÙ…Ø±ÙŠÙ†',
    work_t:'ÙˆÙ‚Øª Ø§Ù„Ø¹Ù…Ù„ (Ø«)',rest_t:'ÙˆÙ‚Øª Ø§Ù„Ø±Ø§Ø­Ø© (Ø«)',rounds:'Ø§Ù„Ø¬ÙˆÙ„Ø§Øª',start_tabata:'Ø¨Ø¯Ø¡ ØªØ§Ø¨Ø§ØªØ§',
    ready:'Ø¬Ø§Ù‡Ø²',get_ready:'Ø§Ø³ØªØ¹Ø¯!',exercises:'ØªÙ…Ø§Ø±ÙŠÙ†',time_lbl:'Ø§Ù„ÙˆÙ‚Øª',
    calendar:'Ø§Ù„ØªÙ‚ÙˆÙŠÙ…',plans:'Ø§Ù„Ø®Ø·Ø·',new_plan:'Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø©',
    challenge_ttl:'ØªØ­Ø¯ÙŠ 30 ÙŠÙˆÙ…',day:'ÙŠÙˆÙ…',rest_day:'Ø±Ø§Ø­Ø©',
    ph1:'ØªÙ‡ÙŠØ¦Ø©',ph2:'Ø­Ø±Ù‚',ph3:'Ø°Ø±ÙˆØ©',ph4:'ÙˆØ­Ø´',
    today_stats:'Ø¥Ø­ØµØ§Ø¡',completed:'Ù…ÙƒØªÙ…Ù„',total:'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ',
    badges_sec:'Ø§Ù„Ø´Ø§Ø±Ø§Øª',history_sec:'Ø§Ù„Ø³Ø¬Ù„',all_tab:'Ø§Ù„ÙƒÙ„',custom_tab:'Ù…Ø®ØµØµØ©',fav_tab:'Ø§Ù„Ù…ÙØ¶Ù„Ø©',
    settings:'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',profile:'Ø§Ù„Ù…Ù„Ù',language:'Ø§Ù„Ù„ØºØ©',
    theme:'Ø§Ù„Ø«ÙŠÙ…',start_date:'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©',sound:'Ø§Ù„ØµÙˆØª',auto_adv:'Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ',
    reset_data:'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†',badge_earned:'Ø´Ø§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©!',
    day_complete:'Ø§Ù„ÙŠÙˆÙ… Ù…ÙƒØªÙ…Ù„! ðŸŽ‰',well_done:'Ø£Ø­Ø³Ù†Øª!',
    confirm_restore:'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØŸ',
    confirm_reset:'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ',
    wt_kg:'Ø§Ù„ÙˆØ²Ù† (ÙƒØº)',ht_cm:'Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)',age:'Ø§Ù„Ø¹Ù…Ø±',
    chest:'Ø§Ù„ØµØ¯Ø± (Ø³Ù…)',waist:'Ø§Ù„Ø®ØµØ± (Ø³Ù…)',hip:'Ø§Ù„Ø£Ø±Ø¯Ø§Ù (Ø³Ù…)',
    save_meas:'Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª',
    burn_ttl:'Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø³Ø¹Ø±Ø§Øª',weight:'Ø§Ù„ÙˆØ²Ù†',intensity:'Ø§Ù„Ø´Ø¯Ø©',dur_min:'Ø§Ù„Ù…Ø¯Ø© (Ø¯)',
    i_low:'Ø®ÙÙŠÙ',i_med:'Ù…ØªÙˆØ³Ø·',i_high:'Ù…Ø±ØªÙØ¹',i_max:'Ù‚ØµÙˆÙ‰',
    calc:'Ø§Ø­Ø³Ø¨',kcal_burned:'Ø³Ø¹Ø±Ø© Ù…Ø­Ø±ÙˆÙ‚Ø©',
    rope:'Ù‚ÙØ² Ø§Ù„Ø­Ø¨Ù„',total_jumps:'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙØ²Ø§Øª',best_sess:'Ø£ÙØ¶Ù„ Ø¬Ù„Ø³Ø©',
    log_sess:'ØªØ³Ø¬ÙŠÙ„ Ø¬Ù„Ø³Ø©',jumps:'Ù‚ÙØ²Ø§Øª',dur_lbl:'Ø§Ù„Ù…Ø¯Ø©',
    drag_hint:'Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹ Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„ØªÙ…Ø±ÙŠÙ†',
    beginner:'Ù…Ø¨ØªØ¯Ø¦',intermediate:'Ù…ØªÙˆØ³Ø·',advanced:'Ù…ØªÙ‚Ø¯Ù…',elite:'Ù…Ø­ØªØ±Ù',
    burn_fat:'Ø­Ø±Ù‚ Ø¯Ù‡ÙˆÙ†',build_muscle:'Ø¨Ù†Ø§Ø¡ Ø¹Ø¶Ù„Ø§Øª',fitness:'Ù„ÙŠØ§Ù‚Ø© Ø¹Ø§Ù…Ø©',health:'ØµØ­Ø©',
    t_workout:'ØªØ¯Ø±ÙŠØ¨',t_challenge:'ØªØ­Ø¯ÙŠ',t_timer:'Ù…Ø¤Ù‚Øª',t_track:'ØªØªØ¨Ø¹',t_tips:'Ù†ØµØ§Ø¦Ø­',
    muscle_grp:'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¹Ø¶Ù„ÙŠØ©',instructions:'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª',photos:'ØµÙˆØ± (Ø­ØªÙ‰ 3)',
  },
  en:{dir:'ltr',
    streak:'Streak',days:'Days',kcal:'Kcal',min:'Minutes',badges:'Badges',
    sets:'Sets',reps:'Reps',dur:'Duration',rest_s:'Rest (s)',
    start:'Start',start_sess:'Start Session',edit_day:'Edit Day',mark_done:'Mark Done',
    restore:'Restore',save:'Save',cancel:'Cancel',back:'Back',
    add_ex:'Add Exercise',create_ex:'Create Exercise',add_photo:'Add Photo',save_ex:'Save Exercise',
    work_t:'Work Time (s)',rest_t:'Rest Time (s)',rounds:'Rounds',start_tabata:'Start Tabata',
    ready:'Ready',get_ready:'Get Ready!',exercises:'Exercises',time_lbl:'Time',
    calendar:'Calendar',plans:'Plans',new_plan:'New Plan',
    challenge_ttl:'30-Day Challenge',day:'Day',rest_day:'Rest',
    ph1:'Warmup',ph2:'Burn',ph3:'Peak',ph4:'Beast',
    today_stats:'Stats',completed:'Done',total:'Total',
    badges_sec:'Badges',history_sec:'History',all_tab:'All',custom_tab:'Custom',fav_tab:'Favorites',
    settings:'Settings',profile:'Profile',language:'Language',
    theme:'Theme',start_date:'Start Date',sound:'Sound',auto_adv:'Auto Advance',
    reset_data:'Reset Data',badge_earned:'New Badge!',
    day_complete:'Day Complete! ðŸŽ‰',well_done:'Well Done!',
    confirm_restore:'Restore default schedule?',
    confirm_reset:'Reset all data?',
    wt_kg:'Weight (kg)',ht_cm:'Height (cm)',age:'Age',
    chest:'Chest (cm)',waist:'Waist (cm)',hip:'Hip (cm)',
    save_meas:'Save Measurements',
    burn_ttl:'Calorie Calculator',weight:'Weight',intensity:'Intensity',dur_min:'Duration (min)',
    i_low:'Light',i_med:'Moderate',i_high:'High',i_max:'Max',
    calc:'Calculate',kcal_burned:'Calories Burned',
    rope:'Jump Rope',total_jumps:'Total Jumps',best_sess:'Best Session',
    log_sess:'Log Session',jumps:'Jumps',dur_lbl:'Duration',
    drag_hint:'Long press to drag exercises',
    beginner:'Beginner',intermediate:'Intermediate',advanced:'Advanced',elite:'Elite',
    burn_fat:'Burn Fat',build_muscle:'Build Muscle',fitness:'General Fitness',health:'Health',
    t_workout:'Workout',t_challenge:'Challenge',t_timer:'Timer',t_track:'Track',t_tips:'Tips',
    muscle_grp:'Muscle Group',instructions:'Instructions',photos:'Photos (up to 3)',
  },
  fr:{dir:'ltr',
    streak:'SÃ©rie',days:'Jours',kcal:'Kcal',min:'Minutes',badges:'Badges',
    sets:'SÃ©ries',reps:'RÃ©p.',dur:'DurÃ©e',rest_s:'Repos (s)',
    start:'DÃ©marrer',start_sess:'DÃ©marrer',edit_day:'Modifier',mark_done:'Terminer',
    restore:'Restaurer',save:'Sauvegarder',cancel:'Annuler',back:'Retour',
    add_ex:'Ajouter',create_ex:'CrÃ©er exercice',add_photo:'Ajouter photo',save_ex:'Sauvegarder',
    work_t:'Travail (s)',rest_t:'Repos (s)',rounds:'Tours',start_tabata:'Tabata',
    ready:'PrÃªt',get_ready:'PrÃªt!',exercises:'Exercices',time_lbl:'Temps',
    calendar:'Calendrier',plans:'Plans',new_plan:'Nouveau Plan',
    challenge_ttl:'DÃ©fi 30 Jours',day:'Jour',rest_day:'Repos',
    ph1:'Ã‰chauff.',ph2:'BrÃ»lage',ph3:'Pic',ph4:'BÃªte',
    today_stats:'Stats',completed:'TerminÃ©',total:'Total',
    badges_sec:'Badges',history_sec:'Historique',all_tab:'Tout',custom_tab:'Perso',fav_tab:'Favoris',
    settings:'ParamÃ¨tres',profile:'Profil',language:'Langue',
    theme:'ThÃ¨me',start_date:'Date dÃ©but',sound:'Son',auto_adv:'Avance auto',
    reset_data:'RÃ©initialiser',badge_earned:'Nouveau Badge!',
    day_complete:'JournÃ©e complÃ¨te! ðŸŽ‰',well_done:'Bravo!',
    confirm_restore:'Restaurer le programme par dÃ©faut?',
    confirm_reset:'RÃ©initialiser toutes les donnÃ©es?',
    wt_kg:'Poids (kg)',ht_cm:'Taille (cm)',age:'Ã‚ge',
    chest:'Poitrine (cm)',waist:'Taille (cm)',hip:'Hanches (cm)',
    save_meas:'Sauvegarder',
    burn_ttl:'Calculateur',weight:'Poids',intensity:'IntensitÃ©',dur_min:'DurÃ©e (min)',
    i_low:'LÃ©gÃ¨re',i_med:'ModÃ©rÃ©e',i_high:'Ã‰levÃ©e',i_max:'Max',
    calc:'Calculer',kcal_burned:'Calories brÃ»lÃ©es',
    rope:'Corde Ã  sauter',total_jumps:'Total sauts',best_sess:'Meilleure session',
    log_sess:'Enregistrer',jumps:'Sauts',dur_lbl:'DurÃ©e',
    drag_hint:'Appui long pour dÃ©placer',
    beginner:'DÃ©butant',intermediate:'IntermÃ©diaire',advanced:'AvancÃ©',elite:'Expert',
    burn_fat:'BrÃ»ler les graisses',build_muscle:'Musculation',fitness:'Forme',health:'SantÃ©',
    t_workout:'EntraÃ®n.',t_challenge:'DÃ©fi',t_timer:'Timer',t_track:'Suivi',t_tips:'Conseils',
    muscle_grp:'Groupe musculaire',instructions:'Instructions',photos:'Photos (3 max)',
  }
};
function T(k){return (LANG[S.lang]||LANG.ar)[k]||k;}

// ============================================================
// EXERCISE DATABASE
// ============================================================
const DB = [
  {id:'burpee',nameAr:'Ø¨ÙŠØ±Ø¨ÙŠ',nameEn:'Burpee',nameFr:'Burpee',emoji:'ðŸ’¥',muscle:'full',type:'hiit',sets:3,reps:10,dur:40,rest:20,kcal:12,
   steps:['Ø§Ø¨Ø¯Ø£ ÙˆØ§Ù‚ÙØ§Ù‹','Ø§Ù†Ø­Ù†Ù ÙˆØ¶Ø¹ ÙŠØ¯ÙŠÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶','Ø§Ù‚ÙØ² Ù„ÙˆØ¶Ø¹ÙŠØ© Ø§Ù„Ø¶ØºØ·','Ø§Ø¹Ù…Ù„ Ø¶ØºØ·Ø©','Ø§Ù‚ÙØ² Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù…Ø¹ Ø±ÙØ¹ Ø§Ù„ÙŠØ¯ÙŠÙ†'],
   stepsEn:['Stand with feet shoulder-width','Bend down, place hands on floor','Jump to plank','Do one push-up','Jump up raising arms overhead']},
  {id:'jumpingjack',nameAr:'Ø§Ù„Ù‚ÙØ² Ø§Ù„Ù…ØªÙØ±Ø¬',nameEn:'Jumping Jacks',nameFr:'Jumping Jacks',emoji:'ðŸ™Œ',muscle:'cardio',type:'hiit',sets:3,reps:30,dur:40,rest:15,kcal:8,
   steps:['Ø§Ø¨Ø¯Ø£ ÙˆØ§Ù‚ÙØ§Ù‹ Ù…Ø¹ Ø§Ù„Ù‚Ø¯Ù…ÙŠÙ† Ù…Ø¹Ø§Ù‹','Ø§ÙØ±Ø¯ Ù‚Ø¯Ù…ÙŠÙƒ ÙˆØ§Ø±ÙØ¹ Ø°Ø±Ø§Ø¹ÙŠÙƒ','Ø§Ø±Ø¬Ø¹ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ','ÙƒØ±Ø± Ø¨Ø¥ÙŠÙ‚Ø§Ø¹ Ø³Ø±ÙŠØ¹'],
   stepsEn:['Stand with feet together','Jump feet out while raising arms overhead','Return to start position','Repeat at fast pace']},
  {id:'highknees',nameAr:'Ø±ÙƒØ¶ ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù†',nameEn:'High Knees',nameFr:'Genoux Hauts',emoji:'ðŸ¦µ',muscle:'cardio',type:'hiit',sets:3,reps:0,dur:30,rest:15,kcal:9,
   steps:['Ø§Ø¨Ø¯Ø£ ÙˆØ§Ù‚ÙØ§Ù‹','Ø§Ø±ÙØ¹ Ø±ÙƒØ¨ØªÙƒ Ø§Ù„ÙŠÙ…Ù†Ù‰ Ù„Ù„ØµØ¯Ø±','Ø¨Ø¯Ù‘Ù„ Ù„Ù„Ø±ÙƒØ¨Ø© Ø§Ù„ÙŠØ³Ø±Ù‰ Ø¨Ø³Ø±Ø¹Ø©','Ø§Ø¨Ù‚Ù Ø¸Ù‡Ø±Ùƒ Ù…Ø³ØªÙ‚ÙŠÙ…Ø§Ù‹'],
   stepsEn:['Stand upright','Drive right knee to chest level','Switch to left knee quickly','Keep back straight throughout']},
  {id:'mountainclimber',nameAr:'Ø§Ù„Ù…ØªØ³Ù„Ù‚',nameEn:'Mountain Climber',nameFr:'Grimpeur',emoji:'ðŸ§—',muscle:'core',type:'hiit',sets:3,reps:0,dur:30,rest:15,kcal:9,
   steps:['Ø§Ø¨Ø¯Ø£ ÙÙŠ ÙˆØ¶Ø¹ÙŠØ© Ø§Ù„Ø¶ØºØ·','Ø§Ø¬Ù„Ø¨ Ø±ÙƒØ¨ØªÙƒ Ø§Ù„ÙŠÙ…Ù†Ù‰ Ù†Ø­Ùˆ ØµØ¯Ø±Ùƒ','Ø§Ø±Ø¬Ø¹ ÙˆÙƒØ±Ø± Ø¨Ø§Ù„ÙŠØ³Ø±Ù‰','Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø³Ø±Ø¹Ø© Ø«Ø§Ø¨ØªØ©'],
   stepsEn:['Start in plank/push-up position','Drive right knee toward chest','Return and repeat with left knee','Maintain steady alternating pace']},
  {id:'pushup',nameAr:'ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø¶ØºØ·',nameEn:'Push-Up',nameFr:'Pompes',emoji:'ðŸ’ª',muscle:'chest',type:'strength',sets:3,reps:15,dur:0,rest:60,kcal:7,
   steps:['Ø¶Ø¹ ÙŠØ¯ÙŠÙƒ Ø£ÙˆØ³Ø¹ Ù…Ù† Ø§Ù„ÙƒØªÙÙŠÙ†','Ø§Ø¨Ù‚Ù Ø¬Ø³Ù…Ùƒ Ù…Ø³ØªÙ‚ÙŠÙ…Ø§Ù‹ ÙƒØ§Ù„Ø®Ø´Ø¨Ø©','Ø§Ù†Ø²Ù„ Ø­ØªÙ‰ ØªÙ„Ø§Ù…Ø³ ØµØ¯Ø±Ùƒ Ø§Ù„Ø£Ø±Ø¶','Ø§Ø¯ÙØ¹ Ù„Ù„Ø£Ø¹Ù„Ù‰ Ø¨Ù‚ÙˆØ©'],
   stepsEn:['Place hands wider than shoulders','Keep body straight like a plank','Lower chest toward floor','Push explosively back to start']},
  {id:'squat',nameAr:'Ø§Ù„Ù‚Ø±ÙØµØ§Ø¡',nameEn:'Squat',nameFr:'Squat',emoji:'ðŸ‹ï¸',muscle:'legs',type:'strength',sets:3,reps:20,dur:0,rest:60,kcal:8,
   steps:['Ø§Ø¨Ø¯Ø£ ÙˆØ§Ù‚ÙØ§Ù‹ Ø¨Ø¹Ø±Ø¶ Ø§Ù„ÙƒØªÙÙŠÙ†','Ø§Ù†Ø²Ù„ ÙƒØ£Ù†Ùƒ ØªØ¬Ù„Ø³ Ø¹Ù„Ù‰ ÙƒØ±Ø³ÙŠ','Ø§Ø¨Ù‚Ù ØµØ¯Ø±Ùƒ Ù…Ø±ÙÙˆØ¹Ø§Ù‹ ÙˆØ±ÙƒØ¨ØªÙŠÙƒ Ù„Ù„Ø£Ù…Ø§Ù…','Ø§Ø¯ÙØ¹ Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„ÙƒØ¹Ø¨ÙŠÙ†'],
   stepsEn:['Stand shoulder-width apart','Lower as if sitting back in a chair','Keep chest up, knees tracking toes','Drive through heels to stand']},
  {id:'plank',nameAr:'Ø§Ù„Ø¨Ù„Ø§Ù†Ùƒ',nameEn:'Plank',nameFr:'Planche',emoji:'âš¡',muscle:'core',type:'strength',sets:3,reps:0,dur:45,rest:30,kcal:5,
   steps:['Ø§Ø³ØªÙ„Ù‚Ù Ø¹Ù„Ù‰ Ø¨Ø·Ù†Ùƒ','Ø§Ø±ÙØ¹ Ø¬Ø³Ù…Ùƒ Ø¹Ù„Ù‰ Ø³Ø§Ø¹Ø¯ÙŠÙƒ ÙˆØ£ØµØ§Ø¨Ø¹ Ù‚Ø¯Ù…ÙŠÙƒ','Ø§Ø¨Ù‚Ù Ø¬Ø³Ù…Ùƒ Ù…Ø³ØªÙ‚ÙŠÙ…Ø§Ù‹ Ù…Ù† Ø§Ù„Ø±Ø£Ø³ Ù„Ù„ÙƒØ¹Ø¨','Ø´Ø¯ Ø¹Ø¶Ù„Ø§Øª Ø§Ù„Ø¨Ø·Ù† Ø·ÙˆØ§Ù„ Ø§Ù„ÙˆÙ‚Øª'],
   stepsEn:['Lie face down','Lift body onto forearms and toes','Keep body straight from head to heels','Tighten core throughout hold']},
  {id:'lunge',nameAr:'Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©',nameEn:'Lunges',nameFr:'Fentes',emoji:'ðŸ¦µ',muscle:'legs',type:'strength',sets:3,reps:12,dur:0,rest:60,kcal:7,
   steps:['Ø§Ø¨Ø¯Ø£ ÙˆØ§Ù‚ÙØ§Ù‹ Ù…Ø³ØªÙ‚ÙŠÙ…Ø§Ù‹','Ø®Ø·ÙˆØ© ÙƒØ¨ÙŠØ±Ø© Ù„Ù„Ø£Ù…Ø§Ù… Ø¨Ù‚Ø¯Ù…Ùƒ Ø§Ù„ÙŠÙ…Ù†Ù‰','Ø§Ù†Ø²Ù„ Ø­ØªÙ‰ ØªÙƒÙˆÙ† Ø±ÙƒØ¨ØªØ§Ùƒ Ø¨Ø²Ø§ÙˆÙŠØ© 90Â°','Ø§Ø±Ø¬Ø¹ ÙˆÙƒØ±Ø± Ù…Ø¹ Ø§Ù„Ù‚Ø¯Ù… Ø§Ù„Ø£Ø®Ø±Ù‰'],
   stepsEn:['Stand tall','Step forward with right foot','Lower until both knees at 90Â°','Return and repeat on left side']},
  {id:'crunch',nameAr:'Ø¹Ø¶Ù„Ø§Øª Ø§Ù„Ø¨Ø·Ù†',nameEn:'Crunches',nameFr:'Abdominaux',emoji:'ðŸ”¥',muscle:'core',type:'strength',sets:3,reps:20,dur:0,rest:45,kcal:5,
   steps:['Ø§Ø³ØªÙ„Ù‚Ù Ø¹Ù„Ù‰ Ø¸Ù‡Ø±Ùƒ Ù…Ø¹ Ø«Ù†ÙŠ Ø§Ù„Ø±ÙƒØ¨ØªÙŠÙ†','Ø¶Ø¹ ÙŠØ¯ÙŠÙƒ Ø®Ù„Ù Ø±Ø£Ø³Ùƒ','Ø§Ø±ÙØ¹ ÙƒØªÙÙŠÙƒ Ù…Ù† Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ø¹ØµØ± Ø§Ù„Ø¨Ø·Ù†','Ø§Ù†Ø²Ù„ Ø¨Ø¨Ø·Ø¡ Ø¯ÙˆÙ† Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø±Ø£Ø³ Ù„Ù„Ø£Ø±Ø¶'],
   stepsEn:['Lie on back with knees bent','Hands behind head for support','Lift shoulders squeezing abs hard','Lower slowly without touching floor']},
  {id:'glute_bridge',nameAr:'Ø¬Ø³Ø± Ø§Ù„Ø£Ø±Ø¯Ø§Ù',nameEn:'Glute Bridge',nameFr:'Pont Fessier',emoji:'ðŸ‘',muscle:'legs',type:'strength',sets:3,reps:15,dur:0,rest:45,kcal:5,
   steps:['Ø§Ø³ØªÙ„Ù‚Ù Ø¹Ù„Ù‰ Ø¸Ù‡Ø±Ùƒ Ù…Ø¹ Ø«Ù†ÙŠ Ø§Ù„Ø±ÙƒØ¨ØªÙŠÙ†','Ø¶Ø¹ Ù‚Ø¯Ù…ÙŠÙƒ Ù…Ø³Ø·Ø­ØªÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶','Ø§Ø±ÙØ¹ ÙˆØ±ÙƒÙŠÙƒ ÙˆØ§Ø¹ØµØ± Ø§Ù„Ø£Ø±Ø¯Ø§Ù ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰','Ø§Ù†Ø²Ù„ Ø¨Ø¨Ø·Ø¡ ÙˆÙƒØ±Ø±'],
   stepsEn:['Lie on back with knees bent','Feet flat on floor hip-width apart','Drive hips up squeezing glutes hard','Lower slowly and repeat']},
  {id:'dip',nameAr:'Ø¯ÙŠØ¨Ø³ Ø§Ù„ÙƒØ±Ø³ÙŠ',nameEn:'Chair Dips',nameFr:'Dips sur Chaise',emoji:'ðŸª‘',muscle:'arms',type:'strength',sets:3,reps:12,dur:0,rest:60,kcal:6,
   steps:['Ø¶Ø¹ ÙŠØ¯ÙŠÙƒ Ø¹Ù„Ù‰ Ø­Ø§ÙØ© ÙƒØ±Ø³ÙŠ Ø«Ø§Ø¨Øª','Ø§Ù…Ø¯ Ø³Ø§Ù‚ÙŠÙƒ Ù„Ù„Ø£Ù…Ø§Ù…','Ø§Ù†Ø²Ù„ Ø­ØªÙ‰ ØªÙƒÙˆÙ† Ø°Ø±Ø§Ø¹Ø§Ùƒ Ø¨Ø²Ø§ÙˆÙŠØ© 90Â°','Ø§Ø¯ÙØ¹ Ù„Ù„Ø£Ø¹Ù„Ù‰'],
   stepsEn:['Place hands on edge of stable chair','Extend legs forward','Lower until arms at 90Â°','Push back to start']},
  {id:'jumprope',nameAr:'Ù‚ÙØ² Ø§Ù„Ø­Ø¨Ù„',nameEn:'Jump Rope',nameFr:'Corde Ã  Sauter',emoji:'ðŸª¢',muscle:'cardio',type:'rope',sets:4,reps:0,dur:60,rest:30,kcal:14,
   steps:['Ø£Ù…Ø³Ùƒ Ø§Ù„Ø­Ø¨Ù„ Ø¨ÙƒÙ„ØªØ§ ÙŠØ¯ÙŠÙƒ','Ø§Ø¨Ø¯Ø£ Ø¨ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø­Ø¨Ù„ Ù…Ù† Ø§Ù„Ø±Ø³ØºÙŠÙ†','Ø§Ù‚ÙØ² Ø¨ÙƒÙ„ØªØ§ Ø§Ù„Ù‚Ø¯Ù…ÙŠÙ† Ø¹Ù†Ø¯ Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø¨Ù„','Ø§Ø¨Ù‚Ù Ø±ÙƒØ¨ØªÙŠÙƒ Ù…Ø±Ù†ØªÙŠÙ† Ù‚Ù„ÙŠÙ„Ø§Ù‹'],
   stepsEn:['Hold rope handles in each hand','Rotate rope using wrists, not arms','Jump with both feet as rope passes','Keep knees slightly soft']},
  {id:'superman',nameAr:'Ø³ÙˆØ¨Ø±Ù…Ø§Ù†',nameEn:'Superman',nameFr:'Superman',emoji:'ðŸ¦¸',muscle:'back',type:'strength',sets:3,reps:12,dur:0,rest:45,kcal:4,
   steps:['Ø§Ø³ØªÙ„Ù‚Ù Ø¹Ù„Ù‰ Ø¨Ø·Ù†Ùƒ','Ù…Ø¯ Ø°Ø±Ø§Ø¹ÙŠÙƒ ÙÙˆÙ‚ Ø±Ø£Ø³Ùƒ','Ø§Ø±ÙØ¹ Ø°Ø±Ø§Ø¹ÙŠÙƒ ÙˆØµØ¯Ø±Ùƒ ÙˆØ³Ø§Ù‚ÙŠÙƒ Ù…Ø¹Ø§Ù‹','Ø«Ø¨Ù‘Øª Ø«Ø§Ù†ÙŠØªÙŠÙ† Ø«Ù… Ø§Ù†Ø²Ù„'],
   stepsEn:['Lie face down on mat','Arms extended overhead','Lift arms, chest, and legs simultaneously','Hold 2 seconds then lower']},
  {id:'boxjump',nameAr:'Ù‚ÙØ² Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚',nameEn:'Box Jump',nameFr:'Saut en BoÃ®te',emoji:'ðŸ“¦',muscle:'legs',type:'hiit',sets:3,reps:10,dur:0,rest:60,kcal:11,
   steps:['Ø§Ø¨Ø¯Ø£ Ø£Ù…Ø§Ù… Ù…Ù†ØµØ© Ø£Ùˆ ÙƒØ±Ø³ÙŠ Ù…Ø±ØªÙØ¹','Ø§Ù†Ø­Ù†Ù ÙˆØ§Ø³ØªØ¹Ø¯ Ù„Ù„Ù‚ÙØ²','Ø§Ù‚ÙØ² Ø¨ÙƒÙ„ØªØ§ Ø§Ù„Ù‚Ø¯Ù…ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©','Ù‡Ø¨Ø· Ø¨Ø£Ù…Ø§Ù† ÙˆØ§Ù†Ø²Ù„ Ø¨Ø¨Ø·Ø¡'],
   stepsEn:['Stand before an elevated platform','Bend knees and prepare','Jump with both feet landing on top','Land soft, step down carefully']},
  {id:'wallsit',nameAr:'Ø§Ù„Ø¬Ù„ÙˆØ³ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯Ø§Ø±',nameEn:'Wall Sit',nameFr:'Chaise au Mur',emoji:'ðŸ§±',muscle:'legs',type:'strength',sets:3,reps:0,dur:45,rest:60,kcal:5,
   steps:['Ù‚Ù Ø¨Ø¸Ù‡Ø±Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯Ø§Ø±','Ø§Ù†Ø²Ù„ Ø­ØªÙ‰ ØªÙƒÙˆÙ† Ø±ÙƒØ¨ØªØ§Ùƒ Ø¨Ø²Ø§ÙˆÙŠØ© 90Â°','Ø§Ø¨Ù‚Ù Ø¸Ù‡Ø±Ùƒ Ù…Ø³Ù†ÙˆØ¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯Ø§Ø±','Ø«Ø¨Ù‘Øª Ø·ÙˆØ§Ù„ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©'],
   stepsEn:['Stand with back flat against wall','Slide down until knees at 90Â°','Keep back pressed into wall','Hold for target duration']},
  {id:'sideplank',nameAr:'Ø§Ù„Ø¨Ù„Ø§Ù†Ùƒ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ',nameEn:'Side Plank',nameFr:'Planche LatÃ©rale',emoji:'â†”ï¸',muscle:'core',type:'strength',sets:2,reps:0,dur:30,rest:30,kcal:4,
   steps:['Ø§Ø³ØªÙ„Ù‚Ù Ø¹Ù„Ù‰ Ø¬Ù†Ø¨Ùƒ Ø§Ù„Ø£ÙŠÙ…Ù†','Ø§Ø±ÙØ¹ Ø¬Ø³Ù…Ùƒ Ø¹Ù„Ù‰ Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø£ÙŠÙ…Ù†','Ø§Ø¨Ù‚Ù Ø¬Ø³Ù…Ùƒ Ù…Ø³ØªÙ‚ÙŠÙ…Ø§Ù‹ Ù…Ù† Ø§Ù„Ø±Ø£Ø³ Ù„Ù„Ù‚Ø¯Ù…ÙŠÙ†','ÙƒØ±Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø£Ø®Ø±Ù‰'],
   stepsEn:['Lie on right side','Lift body on right forearm','Keep body straight head to feet','Repeat on left side']},
];

// ============================================================
// DEFAULT 30-DAY PLAN
// ============================================================
const DEFAULT_PLAN = {
  id:'default',
  nameAr:'Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© â€” 30 ÙŠÙˆÙ…',
  nameEn:'Default Plan â€” 30 Days',
  nameFr:'Plan par dÃ©faut â€” 30 jours',
  protected:true,
  days:[
    // â”€â”€ Ø£Ø³Ø¨ÙˆØ¹ 1: Ø§Ù„Ø£Ø³Ø§Ø³ â”€â”€
    {day:1,rest:false,exercises:[{id:'pushup',sets:3,reps:10,dur:0},{id:'squat',sets:3,reps:15,dur:0},{id:'plank',sets:3,reps:0,dur:30},{id:'highknees',sets:3,reps:0,dur:30}]},
    {day:2,rest:false,exercises:[{id:'crunch',sets:3,reps:15,dur:0},{id:'lunge',sets:3,reps:10,dur:0},{id:'dip',sets:3,reps:10,dur:0},{id:'jumpingjack',sets:3,reps:0,dur:30}]},
    {day:3,rest:true,exercises:[]},
    {day:4,rest:false,exercises:[{id:'burpee',sets:3,reps:8,dur:0},{id:'mountainclimber',sets:3,reps:0,dur:30},{id:'oblique',sets:3,reps:15,dur:0},{id:'glute',sets:3,reps:15,dur:0}]},
    {day:5,rest:false,exercises:[{id:'pushup',sets:3,reps:12,dur:0},{id:'wallsit',sets:3,reps:0,dur:40},{id:'superman',sets:3,reps:12,dur:0},{id:'jumprope',sets:3,reps:0,dur:60}]},
    {day:6,rest:false,exercises:[{id:'squat',sets:3,reps:20,dur:0},{id:'sideplank',sets:3,reps:0,dur:30},{id:'crunch',sets:3,reps:20,dur:0},{id:'highknees',sets:3,reps:0,dur:45}]},
    {day:7,rest:true,exercises:[]},
    // â”€â”€ Ø£Ø³Ø¨ÙˆØ¹ 2: Ø§Ù„Ø¨Ù†Ø§Ø¡ â”€â”€
    {day:8,rest:false,exercises:[{id:'pushup',sets:4,reps:12,dur:0},{id:'lunge',sets:4,reps:12,dur:0},{id:'plank',sets:3,reps:0,dur:40},{id:'mountainclimber',sets:3,reps:0,dur:30}]},
    {day:9,rest:false,exercises:[{id:'burpee',sets:3,reps:10,dur:0},{id:'dip',sets:4,reps:12,dur:0},{id:'oblique',sets:3,reps:20,dur:0},{id:'jumpingjack',sets:3,reps:0,dur:45}]},
    {day:10,rest:false,exercises:[{id:'squat',sets:4,reps:20,dur:0},{id:'glute',sets:4,reps:20,dur:0},{id:'superman',sets:3,reps:15,dur:0},{id:'highknees',sets:3,reps:0,dur:45}]},
    {day:11,rest:true,exercises:[]},
    {day:12,rest:false,exercises:[{id:'pushup',sets:4,reps:15,dur:0},{id:'wallsit',sets:3,reps:0,dur:45},{id:'crunch',sets:4,reps:20,dur:0},{id:'jumprope',sets:3,reps:0,dur:90}]},
    {day:13,rest:false,exercises:[{id:'burpee',sets:4,reps:10,dur:0},{id:'lunge',sets:3,reps:15,dur:0},{id:'sideplank',sets:3,reps:0,dur:35},{id:'mountainclimber',sets:3,reps:0,dur:40}]},
    {day:14,rest:true,exercises:[]},
    // â”€â”€ Ø£Ø³Ø¨ÙˆØ¹ 3: Ø§Ù„Ø´Ø¯Ø© â”€â”€
    {day:15,rest:false,exercises:[{id:'pushup',sets:4,reps:15,dur:0},{id:'squat',sets:4,reps:25,dur:0},{id:'plank',sets:4,reps:0,dur:45},{id:'highknees',sets:4,reps:0,dur:45}]},
    {day:16,rest:false,exercises:[{id:'burpee',sets:4,reps:12,dur:0},{id:'dip',sets:4,reps:15,dur:0},{id:'crunch',sets:4,reps:25,dur:0},{id:'jumprope',sets:4,reps:0,dur:90}]},
    {day:17,rest:false,exercises:[{id:'lunge',sets:4,reps:15,dur:0},{id:'glute',sets:4,reps:25,dur:0},{id:'oblique',sets:4,reps:20,dur:0},{id:'jumpingjack',sets:4,reps:0,dur:60}]},
    {day:18,rest:true,exercises:[]},
    {day:19,rest:false,exercises:[{id:'pushup',sets:5,reps:15,dur:0},{id:'mountainclimber',sets:4,reps:0,dur:40},{id:'wallsit',sets:4,reps:0,dur:50},{id:'highknees',sets:4,reps:0,dur:60}]},
    {day:20,rest:false,exercises:[{id:'burpee',sets:4,reps:15,dur:0},{id:'superman',sets:4,reps:20,dur:0},{id:'sideplank',sets:4,reps:0,dur:40},{id:'jumprope',sets:4,reps:0,dur:120}]},
    {day:21,rest:true,exercises:[]},
    // â”€â”€ Ø£Ø³Ø¨ÙˆØ¹ 4: Ø§Ù„Ø°Ø±ÙˆØ© â”€â”€
    {day:22,rest:false,exercises:[{id:'pushup',sets:5,reps:18,dur:0},{id:'squat',sets:5,reps:25,dur:0},{id:'plank',sets:4,reps:0,dur:60},{id:'mountainclimber',sets:4,reps:0,dur:45}]},
    {day:23,rest:false,exercises:[{id:'burpee',sets:5,reps:15,dur:0},{id:'lunge',sets:4,reps:20,dur:0},{id:'crunch',sets:5,reps:25,dur:0},{id:'highknees',sets:4,reps:0,dur:60}]},
    {day:24,rest:false,exercises:[{id:'dip',sets:5,reps:15,dur:0},{id:'glute',sets:5,reps:25,dur:0},{id:'oblique',sets:4,reps:25,dur:0},{id:'jumprope',sets:4,reps:0,dur:120}]},
    {day:25,rest:true,exercises:[]},
    {day:26,rest:false,exercises:[{id:'pushup',sets:5,reps:20,dur:0},{id:'wallsit',sets:4,reps:0,dur:60},{id:'superman',sets:4,reps:20,dur:0},{id:'jumpingjack',sets:4,reps:0,dur:60}]},
    {day:27,rest:false,exercises:[{id:'burpee',sets:5,reps:18,dur:0},{id:'squat',sets:5,reps:30,dur:0},{id:'plank',sets:5,reps:0,dur:60},{id:'highknees',sets:5,reps:0,dur:60}]},
    {day:28,rest:true,exercises:[]},
    // â”€â”€ Ø£Ø³Ø¨ÙˆØ¹ 5: Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ø®ÙŠØ± â”€â”€
    {day:29,rest:false,exercises:[{id:'pushup',sets:5,reps:20,dur:0},{id:'burpee',sets:5,reps:20,dur:0},{id:'squat',sets:5,reps:30,dur:0},{id:'plank',sets:5,reps:0,dur:60},{id:'mountainclimber',sets:4,reps:0,dur:60},{id:'highknees',sets:4,reps:0,dur:60}]},
    {day:30,rest:false,exercises:[{id:'pushup',sets:5,reps:20,dur:0},{id:'squat',sets:5,reps:30,dur:0},{id:'burpee',sets:5,reps:20,dur:0},{id:'lunge',sets:5,reps:20,dur:0},{id:'plank',sets:5,reps:0,dur:60},{id:'jumprope',sets:5,reps:0,dur:120},{id:'crunch',sets:5,reps:30,dur:0}]},
  ]
};

// ============================================================
// BADGES
// ============================================================
const BADGES_DEF=[
  {id:'first',  icon:'ðŸŒ±',ar:'Ø£ÙˆÙ„ Ø®Ø·ÙˆØ©',   en:'First Step',      fr:'Premier Pas',    fn:s=>s.completedDays.length>=1},
  {id:'week1',  icon:'7ï¸âƒ£',ar:'Ø£Ø³Ø¨ÙˆØ¹',      en:'One Week',        fr:'Une Semaine',    fn:s=>s.completedDays.length>=7},
  {id:'week2',  icon:'ðŸ”¥',ar:'Ø£Ø³Ø¨ÙˆØ¹Ø§Ù†',    en:'Two Weeks',       fr:'Deux Semaines',  fn:s=>s.completedDays.length>=14},
  {id:'week3',  icon:'âš¡',ar:'Ø«Ù„Ø§Ø«Ø© Ø£Ø³Ø§Ø¨ÙŠØ¹',en:'Three Weeks',    fr:'Trois Semaines', fn:s=>s.completedDays.length>=21},
  {id:'champ',  icon:'ðŸ†',ar:'Ø§Ù„Ø¨Ø·Ù„',       en:'Champion',        fr:'Champion',       fn:s=>s.completedDays.length>=30},
  {id:'str5',   icon:'ðŸ”—',ar:'5 Ø£ÙŠØ§Ù…',      en:'5-Day Streak',    fr:'5 Jours',        fn:s=>s.streak>=5},
  {id:'str10',  icon:'ðŸ’«',ar:'10 Ø£ÙŠØ§Ù…',     en:'10-Day Streak',   fr:'10 Jours',       fn:s=>s.streak>=10},
  {id:'kcal1k', icon:'ðŸ”¥',ar:'1000 Ø³Ø¹Ø±Ø©',   en:'1000 Kcal',       fr:'1000 Kcal',      fn:s=>(s.totalKcal||0)>=1000},
  {id:'kcal5k', icon:'ðŸ’¥',ar:'5000 Ø³Ø¹Ø±Ø©',   en:'5000 Kcal',       fr:'5000 Kcal',      fn:s=>(s.totalKcal||0)>=5000},
  {id:'creator',icon:'âœï¸',ar:'Ù…Ø¨Ø¯Ø¹',        en:'Creator',         fr:'CrÃ©ateur',       fn:s=>(s.customEx||[]).length>=1},
  {id:'early',  icon:'ðŸŒ…',ar:'Ø§Ù„Ø·Ø§Ø¦Ø± Ø§Ù„Ù…Ø¨ÙƒØ±',en:'Early Bird',     fr:'LÃ¨ve-tÃ´t',       fn:s=>(s.earlyWorkouts||0)>=3},
  {id:'perfect',icon:'â­',ar:'Ø£Ø³Ø¨ÙˆØ¹ Ù…Ø«Ø§Ù„ÙŠ', en:'Perfect Week',    fr:'Semaine Parfaite',fn:s=>checkPerfectWeek(s)},
];
function checkPerfectWeek(s){
  if(s.completedDays.length<6)return false;
  const sorted=[...s.completedDays].sort((a,b)=>a-b);
  for(let i=0;i<=sorted.length-6;i++)if(sorted[i+5]-sorted[i]===6)return true;
  return false;
}

const QUOTES={
  ar:['Ø§Ù„Ø¬Ø³Ù… ÙŠØªØ­Ù…Ù„ Ù…Ø§ ÙŠØªØ­Ù…Ù„Ù‡ Ø§Ù„Ø¹Ù‚Ù„.','ÙƒÙ„ ÙŠÙˆÙ… ÙØ±ØµØ© Ù„ØªÙƒÙˆÙ† Ø£ÙØ¶Ù„.','Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø¬Ø³Ø± Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ÙˆØ§Ù„Ø¥Ù†Ø¬Ø§Ø².','Ù„Ø§ ØªØªÙˆÙ‚Ù Ø­ØªÙ‰ ØªÙƒÙˆÙ† ÙØ®ÙˆØ±Ø§Ù‹ Ø¨Ù†ÙØ³Ùƒ.','Ø§Ù„Ø£Ù„Ù… Ù…Ø¤Ù‚ØªØŒ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ù„Ù„Ø£Ø¨Ø¯.'],
  en:['The body achieves what the mind believes.','Every day is a chance to get better.','Discipline bridges goals and achievement.',"Don't stop until you're proud.",'Pain is temporary, glory is forever.'],
  fr:["Le corps accomplit ce que l'esprit croit.",'Chaque jour est une chance de progresser.',"La discipline relie objectifs et rÃ©ussite.","Ne t'arrÃªte pas tant que tu n'es pas fier.",'La douleur est temporaire, la gloire Ã©ternelle.'],
};
const TIPS={
  ar:[
    {icon:'ðŸ’§',title:'Ø§Ù„ØªØ±Ø·ÙŠØ¨',text:'Ø§Ø´Ø±Ø¨ 8 Ø£ÙƒÙˆØ§Ø¨ Ù…Ø§Ø¡ ÙŠÙˆÙ…ÙŠØ§Ù‹. ÙƒÙˆØ¨ Ù‚Ø¨Ù„ Ø§Ù„ØªÙ…Ø±ÙŠÙ† ÙˆØ§Ø«Ù†Ø§Ù† Ø¨Ø¹Ø¯Ù‡.'},
    {icon:'ðŸ˜´',title:'Ø§Ù„Ù†ÙˆÙ…',text:'7â€“9 Ø³Ø§Ø¹Ø§Øª Ù†ÙˆÙ… Ø¶Ø±ÙˆØ±ÙŠØ© Ù„Ù„ØªØ¹Ø§ÙÙŠ ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª.'},
    {icon:'ðŸ¥—',title:'Ø§Ù„ØªØºØ°ÙŠØ©',text:'ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† Ø¨Ø¹Ø¯ ÙƒÙ„ ØªÙ…Ø±ÙŠÙ†. Ø¨ÙŠØ¶ØŒ Ù…ÙˆØ²ØŒ Ø£Ùˆ Ù…ÙƒØ³Ø±Ø§Øª.'},
    {icon:'ðŸ”¥',title:'Ø§Ù„Ø¥Ø­Ù…Ø§Ø¡',text:'5 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¥Ø­Ù…Ø§Ø¡ Ù‚Ø¨Ù„ ÙƒÙ„ ØªÙ…Ø±ÙŠÙ† ØªÙ‚Ù„Ù„ Ø®Ø·Ø± Ø§Ù„Ø¥ØµØ§Ø¨Ø© Ø¨Ù†Ø³Ø¨Ø© 70%.'},
    {icon:'ðŸ“ˆ',title:'Ø§Ù„ØªØ·ÙˆØ±',text:'Ø²ÙØ¯ Ø§Ù„Ø­Ù…Ù„ ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹ ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†. Ø§Ù„ØªØ·ÙˆØ± Ø§Ù„Ø¨Ø·ÙŠØ¡ Ø£ÙØ¶Ù„ Ù…Ù† Ø§Ù„Ø¥ØµØ§Ø¨Ø©.'},
    {icon:'ðŸ§˜',title:'Ø§Ù„ØªØ¹Ø§ÙÙŠ',text:'Ø£ÙŠØ§Ù… Ø§Ù„Ø±Ø§Ø­Ø© Ù…Ù‡Ù…Ø© ÙƒØ£ÙŠØ§Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ†. Ø§Ù„Ù…Ø´ÙŠ Ø§Ù„Ø®ÙÙŠÙ ÙŠØ³Ø§Ø¹Ø¯.'},
    {icon:'ðŸ’ª',title:'Ø§Ù„Ø§ØªØ³Ø§Ù‚',text:'3 Ø£ÙŠØ§Ù… Ù…Ù†ØªØ¸Ù…Ø© Ø£ÙØ¶Ù„ Ù…Ù† 7 Ø£ÙŠØ§Ù… ØºÙŠØ± Ù…Ù†ØªØ¸Ù…Ø©.'},
    {icon:'ðŸŽ¯',title:'Ø§Ù„Ù‡Ø¯Ù',text:'Ø§ÙƒØªØ¨ Ù‡Ø¯ÙÙƒ ÙˆØ¶Ø¹Ù‡ ÙÙŠ Ù…ÙƒØ§Ù† ØªØ±Ø§Ù‡ ÙƒÙ„ ØµØ¨Ø§Ø­.'},
  ],
  en:[
    {icon:'ðŸ’§',title:'Hydration',text:'Drink 8 glasses of water daily. One before workout, two after.'},
    {icon:'ðŸ˜´',title:'Sleep',text:'7â€“9 hours of sleep is essential for recovery and muscle building.'},
    {icon:'ðŸ¥—',title:'Nutrition',text:'Eat protein after every workout: eggs, banana, or nuts work well.'},
    {icon:'ðŸ”¥',title:'Warm-Up',text:'5 minutes of warm-up reduces injury risk by up to 70%.'},
    {icon:'ðŸ“ˆ',title:'Progression',text:'Increase intensity every two weeks. Slow progress beats fast injuries.'},
    {icon:'ðŸ§˜',title:'Recovery',text:"Rest days are as important as workout days. Light walks help."},
    {icon:'ðŸ’ª',title:'Consistency',text:'3 regular sessions beat 7 inconsistent ones every time.'},
    {icon:'ðŸŽ¯',title:'Goal Setting',text:'Write your goal and place it somewhere you see it every morning.'},
  ],
  fr:[
    {icon:'ðŸ’§',title:'Hydratation',text:"Buvez 8 verres d'eau par jour. Un avant, deux aprÃ¨s l'entraÃ®nement."},
    {icon:'ðŸ˜´',title:'Sommeil',text:'7â€“9 heures de sommeil sont essentielles pour rÃ©cupÃ©rer.'},
    {icon:'ðŸ¥—',title:'Nutrition',text:'Mangez des protÃ©ines aprÃ¨s chaque sÃ©ance. Å’ufs, banane, noix.'},
    {icon:'ðŸ”¥',title:'Ã‰chauffement',text:"5 minutes d'Ã©chauffement rÃ©duit les blessures de 70%."},
    {icon:'ðŸ“ˆ',title:'Progression',text:"Augmentez l'intensitÃ© toutes les deux semaines progressivement."},
    {icon:'ðŸ§˜',title:'RÃ©cupÃ©ration',text:'Les jours de repos sont aussi importants que les entraÃ®nements.'},
    {icon:'ðŸ’ª',title:'Constance',text:'3 entraÃ®nements rÃ©guliers valent mieux que 7 irrÃ©guliers.'},
    {icon:'ðŸŽ¯',title:'Objectif',text:'Ã‰crivez votre objectif et placez-le bien en vue chaque matin.'},
  ],
};

// ============================================================
// STATE MANAGEMENT
// ============================================================
const STORAGE_KEY = 'fp6';
let S = {
  lang:'ar', theme:'gold', mode:'mobile', day:1,
  completedDays:[], dayExercises:{}, exSets:{},
  customEx:[], activePlanId:'default', plans:[],
  profile:null, startDate:null, streak:0, totalKcal:0, totalMin:0, earlyWorkouts:0,
  bodyLog:{}, ropeLog:[], earnedBadges:[],
  settings:{sound:true, autoAdvance:true},
  pendingStartDate:null
};
function save(){try{localStorage.setItem(STORAGE_KEY,JSON.stringify(S));}catch(e){}}
function load(){try{const r=localStorage.getItem(STORAGE_KEY);if(r){const p=JSON.parse(r);S={...S,...p};}}catch(e){}}

// ============================================================
// HELPERS
// ============================================================
function exName(ex){return S.lang==='ar'?ex.nameAr:S.lang==='fr'?(ex.nameFr||ex.nameEn):ex.nameEn;}
function exSteps(ex){return S.lang==='ar'?(ex.steps||[]):(ex.stepsEn||ex.steps||[]);}
function planName(p){return S.lang==='ar'?p.nameAr:S.lang==='fr'?(p.nameFr||p.nameEn):p.nameEn;}
function getEx(id){return DB.find(e=>e.id===id)||(S.customEx||[]).find(e=>e.id===id)||null;}
function getAllEx(){return [...DB,...(S.customEx||[])];}

// ============================================================
// LANGUAGE
// ============================================================
function applyLang(){
  const l=LANG[S.lang]||LANG.ar;
  document.documentElement.lang=S.lang;
  document.documentElement.dir=l.dir;
  // Update all language buttons
  ['lngBtn','dtLngBtn'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=S.lang.toUpperCase();});
  // Nav tabs
  ['workout','challenge','timer','track','tips'].forEach(k=>{
    ['nt-'+k,'bn-'+k].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=T('t_'+k);});
  });
  // Stat labels
  const slabels={streak:'streak',done:'days',kcal:'kcal',min:'min',badges:'badges'};
  Object.entries(slabels).forEach(([k,v])=>{const el=document.getElementById('sl-'+k);if(el)el.textContent=T(v);});
  // Misc IDs
  const misc={
    'ob-sub0':'challenge_ttl','obl-name':'profile','obl-age':'age','obl-wt':'wt_kg','obl-ht':'ht_cm',
    'lv-b':'beginner','lv-i':'intermediate','lv-a':'advanced','lv-e':'elite',
    'g-burn':'burn_fat','g-muscle':'build_muscle','g-fit':'fitness','g-health':'health',
    'de-hint':'drag_hint',
    'dt-startsess':'start_sess','dt-editday':'edit_day','dt-exlbl':'exercises',
    'dt-statslbl':'today_stats','dt-donel':'completed','dt-kcall':'kcal',
    'dt-strkl':'streak','dt-totl':'total','dt-timerl':'timer',
    't-work':'work_t','t-rest':'rest_t','t-rounds':'rounds','t-tabata':'start_tabata',
    't-badgeearn':'badge_earned','coL':'get_ready',
    't-yes':'save'
  };
  Object.entries(misc).forEach(([id,k])=>{const el=document.getElementById(id);if(el)el.textContent=T(k);});
}
function cycleLang(){
  const ls=['ar','en','fr'];S.lang=ls[(ls.indexOf(S.lang)+1)%3];save();applyLang();renderAll();
}

// ============================================================
// AUDIO
// ============================================================
let AC=null, soundOn=true;
function getAC(){if(!AC)AC=new(window.AudioContext||window.webkitAudioContext)();if(AC.state==='suspended')AC.resume();return AC;}
function unlockAudio(){try{getAC();}catch(e){}}
function beep(f=880,d=.15,v=.35){
  if(!soundOn)return;
  try{const ctx=getAC(),o=ctx.createOscillator(),g=ctx.createGain();
  o.connect(g);g.connect(ctx.destination);o.frequency.value=f;
  g.gain.setValueAtTime(v,ctx.currentTime);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+d);
  o.start(ctx.currentTime);o.stop(ctx.currentTime+d);}catch(e){}
}
function playWork(){beep(880,.15,.4);setTimeout(()=>beep(1100,.2,.4),200);}
function playRest(){beep(440,.2,.3);}
function playSet(){beep(660,.1,.3);setTimeout(()=>beep(880,.15,.35),150);}

function playFanfare(){[660,880,1100,1320].forEach((hz,i)=>setTimeout(()=>beep(hz,.25,.4),i*200));}
function playCountdown(r){if(r<=3&&r>0)beep(r===1?1100:660,.2,.35);}

// ============================================================
// TIMER ENGINE
// ============================================================
let TM={secs:0,total:0,running:false,iv:null,mode:'countdown',label:'',
  tab:{work:20,rest:10,rounds:8,cur:0,phase:'work'}};
const fmtT=s=>{const m=Math.floor(s/60),sc=s%60;return`${String(m).padStart(2,'0')}:${String(sc).padStart(2,'0')}`;};

function setTimer(secs,label=''){tStop();TM.secs=TM.total=secs;TM.label=label;TM.mode='countdown';updateTUI();}
function tAct(a){
  unlockAudio();
  if(a==='toggle')TM.running?tStop():tStart();
  else if(a==='reset'){tStop();TM.secs=TM.total;TM.tab.cur=0;TM.tab.phase='work';updateTUI();}
  else if(a==='sound'){soundOn=!soundOn;if(S.settings)S.settings.sound=soundOn;save();updateTUI();}

  if(TM){if(TM.running)startTabTimer();else stopTabTimer();}}
function tStart(){if(TM.running)return;TM.running=true;TM.iv=setInterval(tTick,1000);updateTUI();startTickForTimer();}
function tStop(){clearInterval(TM.iv);TM.running=false;updateTUI();stopTick();}
function tTick(){
  if(!TM.running)return;
  if(TM.mode==='tabata'){tabTick();return;}
  TM.secs--;playCountdown(TM.secs);
  if(TM.secs<=0){tStop();playFanfare();}
  updateTUI();
}
function tabTick(){
  TM.secs--;playCountdown(TM.secs);
  if(TM.secs<=0){
    if(TM.tab.phase==='work'){playRest();TM.tab.phase='rest';TM.secs=TM.tab.rest;TM.total=TM.tab.rest;}
    else{TM.tab.cur++;if(TM.tab.cur>=TM.tab.rounds){tStop();playFanfare();TM.mode='countdown';return;}
      playWork();TM.tab.phase='work';TM.secs=TM.tab.work;TM.total=TM.tab.work;}
  }
  updateTUI();
}
function updateTUI(){
  const d=fmtT(TM.secs);
  ['tDisp','dtTDisp'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=d;});
  const pct=TM.total>0?1-(TM.secs/TM.total):0;
  const tp=document.getElementById('tProg');if(tp)tp.style.strokeDashoffset=534-(534*pct);
  const dtp=document.getElementById('dtTProg');
  if(dtp){const c=2*Math.PI*50;dtp.style.strokeDasharray=c;dtp.style.strokeDashoffset=c*(1-pct);}
  ['tMainBtn','dtTMain'].forEach(id=>{const b=document.getElementById(id);if(b)b.textContent=TM.running?'â¸':'â–¶';});
  ['tSndBtn','dtSnd'].forEach(id=>{const b=document.getElementById(id);if(b)b.textContent=soundOn?'ðŸ””':'ðŸ”•';});
  const ph=TM.mode==='tabata'?(TM.tab.phase==='work'?'ðŸ”¥ Work':'ðŸ’š Rest'):(TM.label||T('ready'));
  ['tPhase','dtTPhase'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=ph;});
}
function adjT(k,d){
  if(k==='work')TM.tab.work=Math.max(5,TM.tab.work+d);
  else if(k==='rest')TM.tab.rest=Math.max(0,TM.tab.rest+d);
  else TM.tab.rounds=Math.max(1,TM.tab.rounds+d);
  ['work','rest','rounds'].forEach(k2=>{const el=document.getElementById('tv-'+k2);if(el)el.textContent=TM.tab[k2];});
}
function startTabata(){unlockAudio();TM.mode='tabata';TM.tab.cur=0;TM.tab.phase='work';TM.secs=TM.tab.work;TM.total=TM.tab.work;tStart();}

// ============================================================
// PLAN & DAY
// ============================================================
function getActivePlan(){
  if(S.activePlanId==='default')return DEFAULT_PLAN;
  return S.plans.find(p=>p.id===S.activePlanId)||DEFAULT_PLAN;
}
function getDayData(n){
  const plan=getActivePlan(),base=plan.days.find(d=>d.day===n);
  if(!base)return null;
  if(base.rest)return base;
  const ov=S.dayExercises[`${n}-${S.activePlanId}`];
  return ov?{...base,exercises:ov}:base;
}

// ============================================================
// ONBOARDING
// ============================================================
let obStep=0,obData={lang:'ar',level:'',goal:''};
function obLang(l){
  obData.lang=l;S.lang=l;applyLang();
  document.querySelectorAll('#op0 .ob-opt').forEach(o=>{
    const oc=o.getAttribute('onclick')||'';
    o.classList.toggle('sel',oc.includes("'"+l+"'"));
  });
}
function obSel(el,field,val){
  obData[field]=val;
  el.closest('.ob-field').querySelectorAll('.ob-opt').forEach(o=>o.classList.remove('sel'));
  el.classList.add('sel');
}
function obNext(){
  if(obStep===0){
    const n=(document.getElementById('ob-name')||{}).value?.trim();
    if(!n){shakeEl('ob-name');return;}
    obData.name=n;if(!obData.lang)obData.lang='ar';
  }
  if(obStep===1){
    obData.age=+document.getElementById('ob-age').value||25;
    obData.weight=+document.getElementById('ob-wt').value||70;
    obData.height=+document.getElementById('ob-ht').value||175;
    obData.gender=(document.getElementById('ob-sex')||{}).value||'male';
  }
  if(obStep===2){
    if(!obData.level){notify('!');return;}
    if(!obData.goal){notify('!');return;}
    const ll={beginner:T('beginner'),intermediate:T('intermediate'),advanced:T('advanced'),elite:T('elite')};
    const gl={burn:T('burn_fat'),muscle:T('build_muscle'),fitness:T('fitness'),health:T('health')};
    const el=document.getElementById('ob-sum');
    if(el)el.innerHTML=`<div style="display:flex;flex-direction:column;gap:9px">
      <div style="display:flex;justify-content:space-between"><span style="color:var(--dim)">ðŸ‘¤</span><strong>${obData.name}</strong></div>
      <div style="display:flex;justify-content:space-between"><span style="color:var(--dim)">ðŸ“Š</span><strong style="color:var(--g)">${ll[obData.level]||obData.level}</strong></div>
      <div style="display:flex;justify-content:space-between"><span style="color:var(--dim)">ðŸŽ¯</span><strong style="color:var(--g)">${gl[obData.goal]||obData.goal}</strong></div>
      <div style="display:flex;justify-content:space-between"><span style="color:var(--dim)">âš–ï¸</span><strong>${obData.weight}kg Â· ${obData.height}cm</strong></div></div>`;
  }
  obStep=Math.min(obStep+1,3);renderObStep();
}
function obBack(){obStep=Math.max(obStep-1,0);renderObStep();}
function renderObStep(){
  document.querySelectorAll('.ob-pg').forEach((p,i)=>p.classList.toggle('on',i===obStep));
  document.querySelectorAll('.ob-dot').forEach((d,i)=>{d.classList.toggle('done',i<obStep);d.classList.toggle('on',i===obStep);d.classList.remove('on');if(i===obStep)d.classList.add('on');});
}
function obFinish(){
  // Apply challenge duration to default plan
  const numDays=S.challengeDays||30;
  if(numDays!==30){
    DEFAULT_PLAN.days=generatePlanForDays(numDays);
    DEFAULT_PLAN.nameAr=`Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© â€” ${numDays} ÙŠÙˆÙ…`;
    DEFAULT_PLAN.nameEn=`Default Plan â€” ${numDays} Days`;
  }
  // Save start date from onboarding
  if(S.pendingStartDate){S.startDate=S.pendingStartDate;}
  else if(!S.startDate){S.startDate=new Date().toISOString().split('T')[0];}

  S.lang=obData.lang||'ar';
  S.profile={name:obData.name||'User',age:obData.age||25,weight:obData.weight||70,height:obData.height||175,gender:obData.gender||'male',level:obData.level||'beginner',goal:obData.goal||'fitness'};
  S.startDate=new Date().toISOString().split('T')[0];
  autoDay();save();
  const ob=document.getElementById('ob');if(ob)ob.classList.add('hidden');
  initApp();
}

// ============================================================
// AUTO DAY
// ============================================================
function autoDay(){
  if(!S.startDate)return;
  const diff=Math.floor((Date.now()-new Date(S.startDate).getTime())/86400000)+1;
  const maxDay=getActivePlan().days.length;
  S.day=Math.min(Math.max(diff,1),maxDay);
}

// ============================================================
// VIEW SYSTEM
// ============================================================
let curView='workout';
function showView(v){
  curView=v;
  document.querySelectorAll('.view').forEach(el=>el.classList.remove('on'));
  const vEl=document.getElementById('v-'+v);if(vEl)vEl.classList.add('on');
  document.querySelectorAll('[data-view]').forEach(el=>el.classList.toggle('on',el.dataset.view===v));
  if(v==='workout')renderWorkout();
  if(v==='challenge'){renderChallenge();renderPlans();renderCal();}
  if(v==='timer'){renderTimerPresets();renderRopeTracker();}
  if(v==='track'){renderTrack();renderBadges();renderHistory();}
  if(v==='tips')renderTips();
  if(v==='settings')renderSettings();
}

// ============================================================
// WORKOUT VIEW
// ============================================================
function renderWorkout(){
  renderDaySel();
  renderWorkoutContent();
}
function renderDaySel(){
  const plan=getActivePlan();
  const sel=document.getElementById('daySel');if(!sel)return;
  sel.innerHTML=plan.days.map(d=>{
    const done=S.completedDays.includes(d.day),active=S.day===d.day;
    return`<button class="day-btn${active?' act':''}${done?' done':''}${d.rest?' rest':''}" onclick="selDay(${d.day})">
      <span class="dn">${d.day}</span><span>${d.rest?'ðŸ˜´':done?'âœ“':'â–¸'}</span></button>`;
  }).join('');
  setTimeout(()=>{const a=sel.querySelector('.act');if(a)a.scrollIntoView({behavior:'smooth',inline:'center',block:'nearest'});},80);
}
function selDay(d){S.day=d;save();renderDaySel();renderWorkoutContent();updateStats();}
function navDay(delta){
  const plan=getActivePlan(),n=S.day+delta;
  if(n>=1&&n<=plan.days.length)selDay(n);
}
function renderWorkoutContent(){
  const c=document.getElementById('wkContent');if(!c)return;
  const dd=getDayData(S.day);
  if(!dd){c.innerHTML='';return;}
  if(dd.rest){
    c.innerHTML=`<div class="rest-view">
      <div style="font-size:54px;margin-bottom:12px">ðŸŒ™</div>
      <h3 style="font-size:20px;font-weight:900;color:var(--g);margin-bottom:8px">${T('rest_day')}</h3>
      <p style="color:var(--dim);font-size:12px;line-height:1.8;margin-bottom:14px">${S.lang==='ar'?'Ø§Ù„ØªØ¹Ø§ÙÙŠ Ø¬Ø²Ø¡ Ø£Ø³Ø§Ø³ÙŠ Ù…Ù† Ø§Ù„ØªØ¯Ø±ÙŠØ¨. Ø§Ø³ØªØ±Ø­ ÙˆØ§Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ ÙˆÙ†Ù… Ø¬ÙŠØ¯Ø§Ù‹.':'Recovery is essential. Rest, hydrate and sleep well.'}</p>
      <div class="rest-tips"><ul style="list-style:none">
        ${S.lang==='ar'?'<li>âœ¦ Ø§Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ Ø¨ÙƒÙ…ÙŠØ§Øª ÙƒØ§ÙÙŠØ©</li><li>âœ¦ Ù†Ù… 7â€“8 Ø³Ø§Ø¹Ø§Øª</li><li>âœ¦ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…Ø´ÙŠ Ø§Ù„Ø®ÙÙŠÙ</li>':'<li>âœ¦ Stay well hydrated</li><li>âœ¦ Sleep 7â€“8 hours</li><li>âœ¦ Light walking is fine</li>'}
      </ul></div>
      <div style="display:flex;gap:8px;margin-top:16px">
        <button class="bigbtn gold" onclick="navDay(-1)" style="font-size:12px">â† ${T('back')}</button>
        <button class="bigbtn gold" onclick="navDay(1)" style="font-size:12px">${T('start')} â†’</button>
      </div></div>`;
    return;
  }
  const done=dd.exercises.filter(e=>(S.exSets[`${e.id}-${S.day}`]||0)>=(e.sets||3)).length;
  const allDone=done===dd.exercises.length&&dd.exercises.length>0;
  const mod=!!S.dayExercises[`${S.day}-${S.activePlanId}`];
  let h=`<div class="wk-hdr">
    <div class="wk-title">${T('day')} ${S.day}${mod?` <span style="font-size:9px;color:var(--g)">âœï¸</span>`:''}</div>
    <button class="edit-btn" onclick="openDayEditor(${S.day})">âœï¸ ${T('edit_day')}</button>
  </div>
  <div class="prog-bar"><div class="prog-fill" style="width:${dd.exercises.length?done/dd.exercises.length*100:0}%"></div></div>`;
  dd.exercises.forEach(er=>{
    const ex=getEx(er.id);if(!ex)return;
    const sk=`${er.id}-${S.day}`,sd=S.exSets[sk]||0,ts=er.sets||ex.sets||3,isDone=sd>=ts;
    h+=`<div class="ec${isDone?' done':''}" id="ec-${er.id}">
      <div class="ec-hd" onclick="toggleDet('${er.id}')">
        <div class="ec-thumb">${ex.photos?.length?`<img src="${ex.photos[0]}">`:(ex.emoji||'ðŸ’ª')}</div>
        <div class="ec-info">
          <div class="ec-nm">${exName(ex)}</div>
          <div class="ec-meta">${er.sets||ex.sets} ${T('sets')} ${er.reps||ex.reps?`Â· ${er.reps||ex.reps} ${T('reps')}`:''} ${er.dur||ex.dur?`Â· ${er.dur||ex.dur}Ø«`:''}</div>
          <div class="ec-tags"><span class="tag">${ex.muscle||''}</span><span class="tag">${ex.type||''}</span></div>
        </div>
        <div class="ec-right">
          <div class="ec-chk" onclick="toggleDone(event,'${er.id}',${ts})">${isDone?'âœ“':''}</div>
          ${er.dur||ex.dur?`<span class="ec-ttag" onclick="event.stopPropagation();launchTimer('${er.id}',${er.dur||ex.dur})">${er.dur||ex.dur}Ø« â±</span>`:''}
        </div>
      </div>
      <div class="ec-det" id="ed-${er.id}">
        ${renderIllus(ex)}
        <ul class="steps-list">${exSteps(ex).map((s,i)=>`<li><span class="sn">${i+1}</span><span>${s}</span></li>`).join('')}</ul>
        <div class="adj-grid">
          <div class="adj-box"><div class="adj-lbl">${T('sets')}</div><div class="adj-row">
            <button class="adj-btn" onclick="adjEx('${er.id}','sets',-1)">âˆ’</button>
            <div class="adj-val" id="adj-s-${er.id}">${er.sets||ex.sets}</div>
            <button class="adj-btn" onclick="adjEx('${er.id}','sets',1)">+</button></div></div>
          <div class="adj-box"><div class="adj-lbl">${T('reps')}</div><div class="adj-row">
            <button class="adj-btn" onclick="adjEx('${er.id}','reps',-1)">âˆ’</button>
            <div class="adj-val" id="adj-r-${er.id}">${er.reps||ex.reps||0}</div>
            <button class="adj-btn" onclick="adjEx('${er.id}','reps',1)">+</button></div></div>
          <div class="adj-box"><div class="adj-lbl">${T('dur')}</div><div class="adj-row">
            <button class="adj-btn" onclick="adjEx('${er.id}','dur',-5)">âˆ’</button>
            <div class="adj-val" id="adj-d-${er.id}">${er.dur||ex.dur||0}</div>
            <button class="adj-btn" onclick="adjEx('${er.id}','dur',5)">+</button></div></div>
        </div>
        <div class="set-track">
          <div class="set-dots">${Array(ts).fill(0).map((_,i)=>`<div class="sd${i<sd?' done':i===sd?' cur':''}"></div>`).join('')}</div>
          <div class="set-acts">
            <button class="set-go" onclick="completeSet('${er.id}',${ts})" ${isDone?'disabled':''}>${isDone?'âœ“ '+T('completed'):`â–¶ ${T('start')} (${sd}/${ts})`}</button>
            ${ex.dur||er.dur?`<button class="set-t" onclick="launchTimer('${er.id}',${ex.dur||er.dur})">â±</button>`:''}
          </div>
        </div>
      </div></div>`;
  });
  h+=`<button class="bigbtn red" onclick="startGuided(${S.day})">ðŸ”¥ ${T('start_sess')}</button>`;
  if(allDone)h+=`<button class="bigbtn green" onclick="markDayDone(${S.day})">âœ“ ${T('mark_done')}</button>`;
  c.innerHTML=h;
}
function launchTimer(exId,dur){
  const ex=getEx(exId);
  setTimer(dur,ex?exName(ex):'');
  showView('timer');
  setTimeout(()=>tAct('toggle'),200);
}
function renderIllus(ex){
  if(ex.photos?.length>1)return`<div class="carousel"><div class="ci" id="ci-${ex.id}">${ex.photos.map(p=>`<div class="slide"><img src="${p}" alt=""></div>`).join('')}</div><div class="c-dots">${ex.photos.map((_,i)=>`<div class="cdot${i===0?' on':''}" onclick="carGo('${ex.id}',${i})"></div>`).join('')}</div></div>`;
  if(ex.photos?.length===1)return`<div class="ex-illus"><img src="${ex.photos[0]}" style="width:100%;height:100%;object-fit:cover"></div>`;
  const gif=getExGif(ex.id);
  if(gif)return`<div class="ex-illus" style="height:180px;background:#000"><img src="${gif}" style="width:100%;height:100%;object-fit:contain" loading="lazy"></div>`;
  return`<div class="ex-illus">${svgEx(ex.id)}</div>`;
}
function svgEx(id){
  const c='var(--g)',s={
    pushup:`<svg viewBox="0 0 120 80" fill="none"><circle cx="90" cy="12" r="9" fill="${c}" opacity=".9"/><line x1="90" y1="21" x2="60" y2="45" stroke="${c}" stroke-width="3" stroke-linecap="round"/><line x1="60" y1="45" x2="10" y2="45" stroke="${c}" stroke-width="3" stroke-linecap="round"/><line x1="60" y1="45" x2="55" y2="65" stroke="${c}" stroke-width="3" stroke-linecap="round"/><line x1="60" y1="45" x2="80" y2="65" stroke="${c}" stroke-width="3" stroke-linecap="round"/></svg>`,
    squat:`<svg viewBox="0 0 100 90" fill="none"><circle cx="50" cy="10" r="8" fill="${c}"/><line x1="50" y1="18" x2="50" y2="40" stroke="${c}" stroke-width="3" stroke-linecap="round"/><line x1="50" y1="40" x2="30" y2="65" stroke="${c}" stroke-width="3" stroke-linecap="round"/><line x1="50" y1="40" x2="70" y2="65" stroke="${c}" stroke-width="3" stroke-linecap="round"/><line x1="50" y1="30" x2="30" y2="38" stroke="${c}" stroke-width="2.5" stroke-linecap="round"/><line x1="50" y1="30" x2="70" y2="38" stroke="${c}" stroke-width="2.5" stroke-linecap="round"/></svg>`,
    plank:`<svg viewBox="0 0 130 70" fill="none"><circle cx="110" cy="20" r="8" fill="${c}"/><line x1="110" y1="28" x2="70" y2="45" stroke="${c}" stroke-width="3" stroke-linecap="round"/><line x1="70" y1="45" x2="20" y2="45" stroke="${c}" stroke-width="3" stroke-linecap="round"/><line x1="70" y1="45" x2="65" y2="60" stroke="${c}" stroke-width="3" stroke-linecap="round"/><line x1="70" y1="45" x2="90" y2="60" stroke="${c}" stroke-width="3" stroke-linecap="round"/></svg>`,
  };
  const svg=s[id]||`<svg viewBox="0 0 100 100" fill="none"><circle cx="50" cy="20" r="10" fill="${c}"/><line x1="50" y1="30" x2="50" y2="65" stroke="${c}" stroke-width="3" stroke-linecap="round"/><line x1="50" y1="45" x2="30" y2="55" stroke="${c}" stroke-width="3" stroke-linecap="round"/><line x1="50" y1="45" x2="70" y2="55" stroke="${c}" stroke-width="3" stroke-linecap="round"/><line x1="50" y1="65" x2="35" y2="85" stroke="${c}" stroke-width="3" stroke-linecap="round"/><line x1="50" y1="65" x2="65" y2="85" stroke="${c}" stroke-width="3" stroke-linecap="round"/></svg>`;
  return`<div style="width:100%;height:100%;background:var(--c2);display:flex;align-items:center;justify-content:center">${svg}</div>`;
}
function carGo(id,idx){
  const ci=document.getElementById('ci-'+id);if(ci)ci.style.transform=`translateX(${idx*-100}%)`;
  document.querySelectorAll(`[onclick*="carGo('${id}'"]`).forEach((d,i)=>{d.classList.toggle('on',i===idx);});
}
function toggleDet(id){const el=document.getElementById('ed-'+id);if(el)el.classList.toggle('open');}
function toggleDone(e,id,ts){
  e.stopPropagation();
  const k=`${id}-${S.day}`;
  S.exSets[k]=(S.exSets[k]||0)>=ts?0:ts;
  save();renderWorkoutContent();updateStats();checkBadges();
}
function completeSet(id,ts){
  const k=`${id}-${S.day}`,cur=S.exSets[k]||0;if(cur>=ts)return;
  S.exSets[k]=cur+1;playSet();save();renderWorkoutContent();updateStats();
}
function adjEx(id,field,delta){
  const dd=getDayData(S.day);if(!dd)return;
  const er=dd.exercises.find(e=>e.id===id);if(!er)return;
  const elId={sets:'adj-s-',reps:'adj-r-',dur:'adj-d-'}[field]+id;
  const el=document.getElementById(elId);if(!el)return;
  const nv=Math.max(0,+(el.textContent||0)+delta);el.textContent=nv;
  const ovk=`${S.day}-${S.activePlanId}`;
  let ov=S.dayExercises[ovk]||dd.exercises.map(e=>({...e}));
  const oe=ov.find(e=>e.id===id);if(oe)oe[field]=nv;
  S.dayExercises[ovk]=ov;save();
}
function markDayDone(day){
  if(!S.completedDays.includes(day)){
    S.completedDays.push(day);S.completedDays.sort((a,b)=>a-b);
    calcStreak();
    const dd=getDayData(day);
    if(dd&&!dd.rest){
      const kcal=dd.exercises.reduce((s,e)=>{const ex=getEx(e.id);return s+(ex?ex.kcal*(e.sets||3):0);},0);
      S.totalKcal=(S.totalKcal||0)+kcal;S.totalMin=(S.totalMin||0)+dd.exercises.length*4;
    }
    const h=new Date().getHours();if(h>=5&&h<9)S.earlyWorkouts=(S.earlyWorkouts||0)+1;
    save();checkBadges();showCompletion(day);
  }
  updateStats();renderWorkoutContent();
}
function calcStreak(){
  if(!S.completedDays.length){S.streak=0;return;}
  const sorted=[...S.completedDays].sort((a,b)=>a-b);
  let streak=0,prev=null;
  for(const d of sorted.reverse()){
    if(prev===null||prev-d===1)streak++;
    else break;
    prev=d;
  }
  S.streak=streak;
}

// ============================================================
// CHALLENGE VIEW
// ============================================================
function renderChallenge(){
  const plan=getActivePlan();
  const workDays=plan.days.filter(d=>!d.rest).length,done=S.completedDays.length;
  const pct=workDays?done/workDays*100:0;
  const phases=[{n:T('ph1'),c:'#2196F3',r:[1,7]},{n:T('ph2'),c:'#FF9800',r:[8,14]},{n:T('ph3'),c:'#F44336',r:[15,21]},{n:T('ph4'),c:'#9C27B0',r:[22,30]}];
  const cp=phases.findIndex(p=>S.day>=p.r[0]&&S.day<=p.r[1]);
  const el=document.getElementById('chCard');if(!el)return;
  el.innerHTML=`
    <div style="font-size:14px;font-weight:900;margin-bottom:4px">ðŸ”¥ ${T('challenge_ttl')}</div>
    <div style="font-size:11px;color:var(--dim);margin-bottom:10px">${done} / ${workDays} ${T('days')}</div>
    <div style="display:flex;gap:2px;margin:10px 0">
      ${phases.map((p,i)=>`<div style="flex:1;height:36px;border-radius:7px;background:${p.c}22;color:${p.c};border:1px solid ${p.c}44;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:9px;font-weight:700;opacity:${i<cp?.6:i===cp?1:.25};transform:${i===cp?'scaleY(1.08)':'none'}">
        <span>${p.n}</span><span style="font-size:7px;opacity:.7">${p.r[0]}â€“${p.r[1]}</span></div>`).join('')}
    </div>
    <div style="height:9px;background:rgba(255,255,255,.06);border-radius:5px;overflow:hidden;margin:8px 0 5px"><div style="height:100%;width:${pct}%;background:linear-gradient(90deg,var(--gd),var(--gl));border-radius:5px;transition:width .8s ease"></div></div>
    <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--dim)"><span>${done} ${T('days')}</span><span>${Math.round(pct)}%</span><span>${workDays-done} ${S.lang==='ar'?'Ù…ØªØ¨Ù‚ÙŠ':'left'}</span></div>
    <div style="text-align:center;margin-top:10px;font-size:12px;font-weight:700;padding:8px;background:rgba(212,168,67,.08);border-radius:8px">
      ${T('day')} ${S.day} â€” ${phases[cp>=0?cp:0]?.n||''}
    </div>`;
}
function renderCal(){
  const plan=getActivePlan(),el=document.getElementById('calGrid');if(!el)return;
  el.innerHTML=plan.days.map(d=>{
    const done=S.completedDays.includes(d.day),today=d.day===S.day,rest=d.rest,future=d.day>S.day&&!done;
    return`<div class="cal-d${done?' done':today?' today':rest?' rest-d':future?' fut':''}">${rest?'ðŸ˜´':d.day}</div>`;
  }).join('');
}
function renderPlans(){
  const el=document.getElementById('plansList');if(!el)return;
  const plans=[DEFAULT_PLAN,...S.plans];
  el.innerHTML=plans.map(p=>{
    const active=p.id===S.activePlanId;
    return`<div class="plan-card${active?' act':''}" onclick="activatePlan('${p.id}')">
      <div class="plan-ico">ðŸ“‹</div>
      <div class="plan-info"><div class="plan-nm">${planName(p)}</div><div class="plan-meta">${p.days.length} ${T('day')}</div></div>
      <div style="display:flex;flex-direction:column;gap:4px;align-items:flex-end">
        <span style="font-size:9px;padding:2px 7px;border-radius:10px;background:${p.protected?'rgba(29,185,84,.12)':'rgba(212,168,67,.12)'};color:${p.protected?'var(--green)':'var(--g)'}">${p.protected?(S.lang==='ar'?'Ø§ÙØªØ±Ø§Ø¶ÙŠØ©':'Default'):(active?'âœ“ Active':'')}</span>
        ${!p.protected?`<button onclick="event.stopPropagation();deletePlan('${p.id}')" style="width:26px;height:26px;border-radius:7px;border:1px solid rgba(231,76,60,.25);background:rgba(231,76,60,.06);color:var(--red);font-size:13px;cursor:pointer">ðŸ—‘</button>`:''}
      </div></div>`;
  }).join('');
}
function activatePlan(id){S.activePlanId=id;autoDay();save();renderPlans();renderChallenge();renderCal();renderWorkout();updateStats();}
function createNewPlan(){
  const name=prompt(S.lang==='ar'?'Ø§Ø³Ù… Ø§Ù„Ø®Ø·Ø©:':'Plan name:');
  if(!name)return;
  const id='p'+Date.now();
  S.plans.push({id,nameAr:name,nameEn:name,nameFr:name,protected:false,days:JSON.parse(JSON.stringify(DEFAULT_PLAN.days))});
  save();activatePlan(id);notify('âœ“ '+name);
}
function deletePlan(id){
  confirm2(S.lang==='ar'?'Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©ØŸ':'Delete this plan?',()=>{
    S.plans=S.plans.filter(p=>p.id!==id);
    if(S.activePlanId===id)S.activePlanId='default';
    save();renderPlans();notify('âœ“');
  });
}

// ============================================================
// DAY EDITOR
// ============================================================
let editDay=null,deItems=[],dragSrc=null,touchDragIdx=null,touchHold=null;
function openDayEditor(day){
  editDay=day;
  const dd=getDayData(day);
  if(!dd||dd.rest){notify(T('rest_day'));return;}
  deItems=dd.exercises.map(e=>({...e}));
  const el=document.getElementById('deTitle');if(el)el.textContent=`${T('edit_day')} ${day}`;
  renderDeList();
  const ov=document.getElementById('dayEditor');if(ov)ov.classList.add('open');
}
function closeDayEditor(){const ov=document.getElementById('dayEditor');if(ov)ov.classList.remove('open');}
function renderDeList(){
  const el=document.getElementById('deList');if(!el)return;
  el.innerHTML=deItems.map((er,i)=>{
    const ex=getEx(er.id);if(!ex)return'';
    return`<div class="de-card" draggable="true" data-i="${i}"
      ondragstart="ddStart(event,${i})" ondragover="ddOver(event,${i})" ondrop="ddDrop(event,${i})" ondragend="ddEnd()"
      ontouchstart="tdStart(event,${i})" ontouchmove="tdMove(event)" ontouchend="tdEnd(${i})">
      <span class="de-drag">â ¿</span>
      <div class="de-thumb">${ex.photos?.length?`<img src="${ex.photos[0]}" style="width:100%;height:100%;object-fit:cover">`:(ex.emoji||'ðŸ’ª')}</div>
      <div class="de-info"><div class="de-nm">${exName(ex)}</div><div class="de-meta">${er.sets||ex.sets} ${T('sets')}</div></div>
      <button class="de-del" onclick="deRemove(${i})">âœ•</button></div>`;
  }).join('');
}
function ddStart(e,i){dragSrc=i;e.currentTarget.classList.add('dragging');}
function ddOver(e,i){e.preventDefault();}
function ddDrop(e,i){
  if(dragSrc===null||dragSrc===i)return;
  const t=deItems.splice(dragSrc,1)[0];deItems.splice(i,0,t);dragSrc=null;renderDeList();
}
function ddEnd(){dragSrc=null;document.querySelectorAll('.de-card').forEach(c=>c.classList.remove('dragging','drag-tgt'));}
function tdStart(e,i){touchHold=setTimeout(()=>{touchDragIdx=i;playTick();e.currentTarget.classList.add('dragging');},500);}
function tdMove(e){
  clearTimeout(touchHold);if(touchDragIdx===null)return;e.preventDefault();
  const y=e.touches[0].clientY;
  document.querySelectorAll('.de-card').forEach((c,ci)=>{const r=c.getBoundingClientRect();c.classList.toggle('drag-tgt',y>r.top&&y<r.bottom&&ci!==touchDragIdx);});
}
function tdEnd(origI){
  clearTimeout(touchHold);if(touchDragIdx===null)return;
  let target=touchDragIdx;
  document.querySelectorAll('.de-card.drag-tgt').forEach((c)=>{target=+c.dataset.i;});
  if(target!==touchDragIdx){const t=deItems.splice(touchDragIdx,1)[0];deItems.splice(target,0,t);}
  touchDragIdx=null;renderDeList();
}
function deRemove(i){deItems.splice(i,1);renderDeList();}
function saveDayEdit(){
  S.dayExercises[`${editDay}-${S.activePlanId}`]=deItems.map(e=>({...e}));
  save();closeDayEditor();renderWorkout();notify('âœ“ '+T('save'));
}
function restoreDefaultDay(){
  confirm2(T('confirm_restore'),()=>{
    delete S.dayExercises[`${editDay}-${S.activePlanId}`];save();
    const dd=getDayData(editDay);if(dd&&!dd.rest)deItems=dd.exercises.map(e=>({...e}));renderDeList();renderWorkout();notify('âœ“');
  });
}

// ============================================================
// EXERCISE PICKER
// ============================================================
let epTab='all',epCallback=null;
function openExPicker(cb){
  epCallback=cb;epTab='all';
  const s=document.getElementById('epSearch');if(s)s.value='';
  document.querySelectorAll('.ep-tab').forEach((t,i)=>t.classList.toggle('on',i===0));
  renderExPicker();
  const ov=document.getElementById('exPicker');if(ov)ov.classList.add('open');
}
function closeExPicker(){const ov=document.getElementById('exPicker');if(ov)ov.classList.remove('open');}
function epSwitchTab(t){
  epTab=t;
  document.querySelectorAll('.ep-tab').forEach(b=>b.classList.toggle('on',b.dataset.tab===t));
  renderExPicker();
}
function renderExPicker(){
  const q=(document.getElementById('epSearch')?.value||'').toLowerCase();
  let exs=getAllEx();
  if(epTab==='custom')exs=S.customEx||[];
  else if(epTab==='fav')exs=exs.filter(e=>e.fav);
  if(q)exs=exs.filter(e=>(e.nameAr+e.nameEn).toLowerCase().includes(q));
  const body=document.getElementById('epList');if(!body)return;
  if(!exs.length){body.innerHTML=`<div style="text-align:center;padding:20px;color:var(--dim);font-size:12px">${S.lang==='ar'?'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬':'No results found'}</div>`;return;}
  body.innerHTML=exs.map(ex=>`<div class="ep-card" onclick="epPick('${ex.id}')">
    <div class="ep-thumb">${ex.photos?.length?`<img src="${ex.photos[0]}">`:(ex.emoji||'ðŸ’ª')}</div>
    <div class="ep-info"><div class="ep-nm">${exName(ex)}</div><div class="ep-meta">${ex.muscle||''} Â· ${ex.type||''}</div></div>
    <span onclick="event.stopPropagation();toggleFav('${ex.id}')" style="font-size:16px;cursor:pointer;padding:4px">${ex.fav?'â­':'â˜†'}</span>
  </div>`).join('');
}
function epPick(id){
  const ex=getEx(id);if(!ex)return;
  const er={id,sets:ex.sets||3,reps:ex.reps||0,dur:ex.dur||0,rest:ex.rest||60};
  deItems.push(er);renderDeList();closeExPicker();notify('âœ“ '+exName(ex));
  if(epCallback)epCallback(id);
}
function toggleFav(id){
  const cx=(S.customEx||[]).find(e=>e.id===id);
  if(cx){cx.fav=!cx.fav;save();}else{const db=DB.find(e=>e.id===id);if(db)db.fav=!db.fav;}
  renderExPicker();
}

// ============================================================
// CREATE EXERCISE
// ============================================================
let cePhotos=[null,null,null],ceSlot=0;
function openCreateEx(){
  cePhotos=[null,null,null];
  ['ceNameAr','ceNameEn','ceInst'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  const sets=document.getElementById('ce-sets'),reps=document.getElementById('ce-reps'),dur=document.getElementById('ce-dur'),rest=document.getElementById('ce-rest');
  if(sets)sets.value='3';if(reps)reps.value='12';if(dur)dur.value='30';if(rest)rest.value='60';
  [0,1,2].forEach(i=>updatePhotoSlot(i,null));
  document.getElementById('createExOv').classList.add('open');
}
function closeCreateEx(){document.getElementById('createExOv').classList.remove('open');}
function triggerPhoto(slot){ceSlot=slot;document.getElementById('photoInput').click();}
function handlePhoto(e){
  const file=e.target.files[0];if(!file)return;
  const r=new FileReader();
  r.onload=ev=>{cePhotos[ceSlot]=ev.target.result;updatePhotoSlot(ceSlot,ev.target.result);if(ceSlot<2){const next=document.getElementById('ps'+(ceSlot+1));if(next)next.style.opacity='1';}};
  r.readAsDataURL(file);e.target.value='';
}
function updatePhotoSlot(i,url){
  const s=document.getElementById('ps'+i);if(!s)return;
  if(url)s.innerHTML=`<img src="${url}" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover"><div onclick="removePhoto(${i})" style="position:absolute;top:4px;right:4px;width:20px;height:20px;border-radius:50%;background:rgba(0,0,0,.7);color:#fff;font-size:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:2">âœ•</div>`;
  else s.innerHTML=`<span class="ps-ico">ðŸ“·</span><span class="ps-lbl">${T('add_photo')}</span>`;
}
function removePhoto(i){cePhotos[i]=null;updatePhotoSlot(i,null);}
function saveCustomEx(){
  const nameAr=(document.getElementById('ce-nameAr')||{}).value?.trim();
  if(!nameAr){shakeEl('ceNameAr');return;}
  const photos=cePhotos.filter(Boolean);
  const ex={id:'cx'+Date.now(),nameAr,nameEn:document.getElementById('ce-nameEn')?.value?.trim()||nameAr,nameFr:nameAr,
    emoji:'âœï¸',muscle:document.getElementById('ce-muscle')?.value||'full',type:'custom',
    sets:+document.getElementById('ce-sets')?.value||3,reps:+document.getElementById('ce-reps')?.value||12,
    dur:+document.getElementById('ce-dur')?.value||30,rest:+document.getElementById('ce-rest')?.value||60,
    kcal:8,steps:(document.getElementById('ce-instr')?.value||'').split('\n').filter(Boolean),
    stepsEn:(document.getElementById('ce-instr')?.value||'').split('\n').filter(Boolean),
    photos,custom:true};
  if(!S.customEx)S.customEx=[];S.customEx.push(ex);save();checkBadges();
  closeCreateEx();closeExPicker();notify('âœ“ '+nameAr);
}

// ============================================================
// GUIDED SESSION
// ============================================================
let GD={exs:[],idx:0,phase:'ready',secs:0,iv:null,sesMin:0,sesKcal:0,paused:false,listOpen:false};
function startGuidedImpl(day){
  const dd=getDayData(day);if(!dd||dd.rest){notify(T('rest_day'));return;}
  GD.exs=dd.exercises.map(e=>({...e,exData:getEx(e.id)})).filter(e=>e.exData);
  GD.idx=0;GD.phase='ready';GD.secs=0;GD.sesMin=0;GD.sesKcal=0;GD.paused=false;
  clearInterval(GD.iv);
  const ov=document.getElementById('guidedOv');if(ov)ov.classList.add('open');
  doCountdown(()=>{renderGuidedEx();setGuidedPhase('ready');});
}
function closeGuided(){clearInterval(GD.iv);const ov=document.getElementById('guidedOv');if(ov)ov.classList.remove('open');}
function doCountdown(cb){
  let n=3;
  const co=document.getElementById('cdownOv'),cn=document.getElementById('cdownN');
  if(co)co.classList.add('open');if(cn)cn.textContent=n;beep(440,.15,.3);
  const iv=setInterval(()=>{n--;beep(660,.15,.35);if(n<=0){clearInterval(iv);if(co)co.classList.remove('open');cb();}else if(cn)cn.textContent=n;},1000);
}
function renderGuidedEx(){
  if(GD.idx>=GD.exs.length){finishGuided();return;}
  const er=GD.exs[GD.idx],ex=er.exData;
  setText('gd-nm',exName(ex));
  setText('gd-sub',`${er.sets||ex.sets} ${T('sets')} ${er.reps||ex.reps?`Â· ${er.reps||ex.reps} ${T('reps')}`:''} ${er.dur||ex.dur?`Â· ${er.dur||ex.dur}Ø«`:''}`);
  const illus=document.getElementById('gdIllus');
  if(illus)illus.innerHTML=ex.photos?.length?`<img src="${ex.photos[0]}" style="width:100%;height:100%;object-fit:cover">`:getExGif(ex.id)?`<img src="${getExGif(ex.id)}" style="width:100%;height:100%;object-fit:contain" loading="lazy">`:svgEx(ex.id);
  const ts=er.sets||ex.sets||3,sd=(S.exSets||{})[`${er.id}-${S.day}`]||0;
  const dots=document.getElementById('gdDots');
  if(dots)dots.innerHTML=Array(ts).fill(0).map((_,i)=>`<div class="gd-dot${i<sd?' done':i===sd?' cur':''}"></div>`).join('');
  setText('gd-cnt',`${GD.idx+1}/${GD.exs.length}`);
  const pf=document.getElementById('gdPF');if(pf)pf.style.width=`${GD.idx/GD.exs.length*100}%`;
  updateGdStats();
}
function setText(id,v){const el=document.getElementById(id);if(el)el.textContent=v;}
function setGuidedPhase(p){
  GD.phase=p;
  const pill=document.getElementById('gdPill');
  if(pill){pill.className='ph-pill '+p;pill.textContent={ready:T('ready'),work:'ðŸ”¥ Work',rest:'ðŸ’š Rest'}[p]||p;}
  const timer=document.getElementById('gdTimer');
  if(timer)timer.className='gd-timer '+(p==='work'?'work':p==='rest'?'rest-t':'ready-t');
  const er=GD.exs[GD.idx],ex=er?.exData;
  clearInterval(GD.iv);
  if(p==='work'&&ex){GD.secs=er.dur||ex.dur||30;playWork();startGdTimer();}
  else if(p==='rest'){GD.secs=er?.rest||ex?.rest||60;playRest();startGdTimer();}
  else{setText('gd-timer','GO');setText('gdMain',T('start'));}
}
function startGdTimer(){
  GD.iv=setInterval(()=>{
    if(GD.paused)return;GD.secs=Math.max(0,GD.secs-1);GD.sesMin+=(1/60);
    playCountdown(GD.secs);
    setText('gd-timer',GD.secs>0?String(GD.secs):'âœ“');
    setText('gds-time',fmtT(Math.round(GD.sesMin*60)));
    if(GD.secs<=0){clearInterval(GD.iv);
      if(GD.phase==='work'){
        completeSet(GD.exs[GD.idx].id,GD.exs[GD.idx].sets||3);
        const sd=(S.exSets||{})[`${GD.exs[GD.idx].id}-${S.day}`]||0;
        if(sd>=(GD.exs[GD.idx].sets||3))gdNextEx();else setGuidedPhase('rest');
      }else setGuidedPhase('work');}
  },1000);
}
function gdAction(){unlockAudio();if(GD.phase==='ready')setGuidedPhase('work');else gdTogglePause();}
function gdTogglePause(){GD.paused=!GD.paused;const b=document.getElementById('gdPauseBtn');if(b)b.textContent=GD.paused?'â–¶':'â¸';}
function gdSkip(){clearInterval(GD.iv);gdNextEx();}
function gdNextEx(){GD.idx++;if(GD.idx>=GD.exs.length){finishGuided();return;}renderGuidedEx();setGuidedPhase('ready');}
function finishGuided(){clearInterval(GD.iv);closeGuided();markDayDone(S.day);}
function updateGdStats(){setText('gds-ex',GD.idx);setText('gds-kcal',Math.round(GD.sesKcal||0));}
function toggleGdList(){
  GD.listOpen=!GD.listOpen;
  const p=document.getElementById('gdListPanel');if(!p)return;
  p.style.display=GD.listOpen?'block':'none';
  if(GD.listOpen)p.innerHTML=GD.exs.map((e,i)=>`<div onclick="gdJump(${i})" style="padding:7px 8px;border-radius:8px;cursor:pointer;font-size:12px;display:flex;align-items:center;gap:8px;${i===GD.idx?'background:rgba(212,168,67,.1);color:var(--g)':'color:var(--dim)'}">
    <span>${e.exData.emoji||'ðŸ’ª'}</span><span>${exName(e.exData)}</span>
    ${i<GD.idx?'<span style="color:var(--green);margin-right:auto">âœ“</span>':''}${i===GD.idx?'<span style="color:var(--g);margin-right:auto">â–¶</span>':''}</div>`).join('');
}
function gdJump(i){GD.idx=i;renderGuidedEx();setGuidedPhase('ready');GD.listOpen=true;toggleGdList();}

// ============================================================
// COMPLETION
// ============================================================
function showCompletion(day){
  playFanfare();spawnConfetti();
  const dd=getDayData(day);
  const exCnt=dd?.exercises?.length||0;
  const kcal=dd?.exercises?.reduce((s,e)=>{const ex=getEx(e.id);return s+(ex?ex.kcal*(e.sets||3):0);},0)||0;
  const ov=document.getElementById('compOv');if(!ov)return;
  setText('comp-title',T('well_done')+(S.profile?.name?' '+S.profile.name:'')+'! ðŸŽ‰');
  setText('comp-sub',`${T('day')} ${day} â€” ${T('day_complete')}`);
  const cs=document.getElementById('compStats');
  if(cs)cs.innerHTML=`
    <div class="comp-stat"><b>${exCnt}</b><span>${T('exercises')}</span></div>
    <div class="comp-stat"><b>${Math.round(kcal)}</b><span>${T('kcal')}</span></div>
    <div class="comp-stat"><b>${S.streak}</b><span>${T('streak')}</span></div>`;
  ov.classList.add('open');
}
function closeCompletion(){const ov=document.getElementById('compOv');if(ov)ov.classList.remove('open');}
function spawnConfetti(); vibrate([100,50,200,50,300]);{
  const colors=['#D4A843','#F2C95C','#1DB954','#E74C3C','#2980B9','#9C27B0'],cont=document.getElementById('confetti');if(!cont)return;
  for(let i=0;i<35;i++)setTimeout(()=>{
    const c=document.createElement('div');
    c.style.cssText=`position:absolute;width:8px;height:8px;border-radius:2px;background:${colors[i%6]};left:${Math.random()*100}%;top:0;animation:confetti ${2+Math.random()}s ease forwards;animation-delay:${Math.random()*.5}s`;
    cont.appendChild(c);setTimeout(()=>c.remove(),3500);
  },i*25);
}

// ============================================================
// TRACK VIEW
// ============================================================
function renderTrack(){
  const plan=getActivePlan(),total=plan.days.filter(d=>!d.rest).length;
  const el=document.getElementById('trackGrid');if(!el)return;
  el.innerHTML=`
    <div class="track-stat"><div class="track-ico">ðŸ”¥</div><span class="track-val">${S.completedDays.length}</span><div class="track-lbl">${T('days')}</div></div>
    <div class="track-stat"><div class="track-ico">âš¡</div><span class="track-val">${S.streak}</span><div class="track-lbl">${T('streak')}</div></div>
    <div class="track-stat"><div class="track-ico">ðŸ”¥</div><span class="track-val">${Math.round(S.totalKcal||0)}</span><div class="track-lbl">${T('kcal')}</div></div>
    <div class="track-stat"><div class="track-ico">â±</div><span class="track-val">${Math.round(S.totalMin||0)}</span><div class="track-lbl">${T('min')}</div></div>
    <div class="track-stat"><div class="track-ico">ðŸ†</div><span class="track-val">${S.earnedBadges.length}</span><div class="track-lbl">${T('badges')}</div></div>
    <div class="track-stat"><div class="track-ico">ðŸ“‹</div><span class="track-val">${total}</span><div class="track-lbl">${T('total')}</div></div>`;
  renderBodyLog();renderBurnCalc();
}
function renderBodyLog(){
  const el=document.getElementById('bodyCard');if(!el)return;
  const today=new Date().toISOString().split('T')[0],log=(S.bodyLog||{})[today]||{};
  el.innerHTML=`<div class="bl-title">ðŸ“ ${S.lang==='ar'?'Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø¬Ø³Ù…':'Body Measurements'}</div>
    <div class="bl-row"><span class="bl-lbl">${T('wt_kg')}</span><input class="bl-in" id="bl-w" type="number" value="${log.weight||''}" placeholder="kg"></div>
    <div class="bl-row"><span class="bl-lbl">${T('chest')}</span><input class="bl-in" id="bl-ch" type="number" value="${log.chest||''}" placeholder="cm"></div>
    <div class="bl-row"><span class="bl-lbl">${T('waist')}</span><input class="bl-in" id="bl-wa" type="number" value="${log.waist||''}" placeholder="cm"></div>
    <div class="bl-row"><span class="bl-lbl">${T('hip')}</span><input class="bl-in" id="bl-hi" type="number" value="${log.hip||''}" placeholder="cm"></div>
    <button class="bigbtn gold" style="font-size:12px;margin-top:6px" onclick="saveBodyLog()">ðŸ’¾ ${T('save_meas')}</button>`;
}
function saveBodyLog(){
  const today=new Date().toISOString().split('T')[0];
  if(!S.bodyLog)S.bodyLog={};
  S.bodyLog[today]={weight:+document.getElementById('bl-w')?.value||null,chest:+document.getElementById('bl-ch')?.value||null,waist:+document.getElementById('bl-wa')?.value||null,hip:+document.getElementById('bl-hi')?.value||null};
  save();notify('âœ“ '+T('save_meas'));renderHistory();
}
function renderBurnCalc(){
  const el=document.getElementById('burnCard');if(!el)return;
  el.innerHTML=`<h4 style="font-size:13px;font-weight:700;color:#F1948A;margin-bottom:12px">ðŸ”¥ ${T('burn_ttl')}</h4>
    <div class="bc-row"><span class="bc-lbl">${T('wt_kg')}</span><input class="bc-in" id="bc-w" type="number" value="${S.profile?.weight||70}"></div>
    <div class="bc-row"><span class="bc-lbl">${T('dur_min')}</span><input class="bc-in" id="bc-d" type="number" value="30"></div>
    <div class="bc-row"><span class="bc-lbl">${T('intensity')}</span><select class="bc-sel" id="bc-i">
      <option value="3">${T('i_low')}</option><option value="5" selected>${T('i_med')}</option>
      <option value="8">${T('i_high')}</option><option value="11">${T('i_max')}</option></select></div>
    <button class="bigbtn red" style="font-size:12px;margin-top:6px;animation:none" onclick="calcBurn()">ðŸ”¥ ${T('calc')}</button>
    <div id="burnRes" class="burn-result" style="display:none">
      <div id="burnNum" class="burn-num">0</div>
      <div style="font-size:11px;color:var(--dim)">${T('kcal_burned')}</div>
      <div style="display:flex;justify-content:center;gap:14px;margin-top:7px">
        <div style="text-align:center"><b id="burnFat" style="display:block;font-size:15px;font-weight:900;color:var(--orange)">0g</b><span style="font-size:9px;color:var(--dim)">${T('burn_fat')}</span></div>
        <div style="text-align:center"><b id="burnMins" style="display:block;font-size:15px;font-weight:900;color:var(--orange)">0</b><span style="font-size:9px;color:var(--dim)">${T('dur_min')}</span></div>
      </div></div>`;
}
function calcBurn(){
  const w=+document.getElementById('bc-w')?.value||70,d=+document.getElementById('bc-d')?.value||30,met=+document.getElementById('bc-i')?.value||5;
  const k=Math.round(w*met*d/60*1.05);
  setText('burnNum',k);setText('burnFat',Math.round(k*.08*10)/10+'g');setText('burnMins',d);
  const r=document.getElementById('burnRes');if(r)r.style.display='block';
}
function renderBadges(){
  const el=document.getElementById('badgeGrid');if(!el)return;
  el.innerHTML=BADGES_DEF.map(b=>{
    const earned=S.earnedBadges.includes(b.id);
    const name=S.lang==='ar'?b.ar:S.lang==='fr'?b.fr:b.en;
    return`<div class="badge-item${earned?' earned':''}"><span class="badge-ico">${b.icon}</span><div class="badge-nm">${name}</div></div>`;
  }).join('');
}
function checkBadges(){
  BADGES_DEF.forEach(b=>{
    if(!S.earnedBadges.includes(b.id)&&b.fn(S)){S.earnedBadges.push(b.id);showBadgeToast(b);}
  });
  save();if(curView==='track')renderBadges();updateStats();
}
function showBadgeToast(b){
  const name=S.lang==='ar'?b.ar:S.lang==='fr'?b.fr:b.en;
  setText('btIcon',b.icon);setText('btName',name);
  const t=document.getElementById('badgeToast');if(t){t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3500);}
  playFanfare();
}
function renderHistory(){
  const el=document.getElementById('histList');if(!el)return;
  const items=[];
  Object.entries(S.bodyLog||{}).forEach(([date,d])=>{if(d.weight)items.push({date,lbl:S.lang==='ar'?'Ù‚ÙŠØ§Ø³Ø§Øª':'Measurements',val:d.weight+'kg'});});
  (S.ropeLog||[]).slice(-5).reverse().forEach(r=>items.push({date:r.date,lbl:T('rope'),val:`${r.jumps} ${T('jumps')}`}));
  S.completedDays.slice(-5).reverse().forEach(d=>items.push({date:`${T('day')} ${d}`,lbl:T('mark_done'),val:'âœ“'}));
  if(!items.length){el.innerHTML=`<div style="text-align:center;padding:20px;color:var(--dim);font-size:12px">${S.lang==='ar'?'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø¨Ø¹Ø¯':'No history yet'}</div>`;return;}
  el.innerHTML=items.slice(0,10).map(e=>`<div class="history-item"><div class="hist-date">${e.date}</div><div><div class="hist-lbl">${e.lbl}</div></div><div class="hist-val">${e.val}</div></div>`).join('');
}

// ============================================================
// ROPE TRACKER
// ============================================================
function renderRopeTracker(){
  const el=document.getElementById('ropeCard');if(!el)return;
  const logs=S.ropeLog||[],total=logs.reduce((s,l)=>s+l.jumps,0),best=logs.reduce((b,l)=>Math.max(b,l.jumps),0);
  const today=new Date().toISOString().split('T')[0],tl=logs.find(l=>l.date===today);
  el.innerHTML=`<div style="font-size:13px;font-weight:700;color:#A9DFBF;margin-bottom:12px">ðŸª¢ ${T('rope')}</div>
    <div style="text-align:center;margin-bottom:12px"><div style="font-family:'Tajawal',sans-serif;font-size:42px;font-weight:900;color:var(--green)">${tl?.jumps||0}</div><div style="font-size:12px;color:var(--dim);margin-top:3px">${S.lang==='ar'?'Ù‚ÙØ²Ø© Ø§Ù„ÙŠÙˆÙ…':"Today's Jumps"}</div></div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px">
      <div class="rt-stat"><b>${total.toLocaleString()}</b><span>${T('total_jumps')}</span></div>
      <div class="rt-stat"><b>${best.toLocaleString()}</b><span>${T('best_sess')}</span></div>
      <div class="rt-stat"><b>${logs.length}</b><span>${S.lang==='ar'?'Ø¬Ù„Ø³Ø©':'Sessions'}</span></div>
    </div>
    <button class="bigbtn green" style="font-size:12px" onclick="toggleRopeForm()">âž• ${T('log_sess')}</button>
    <div id="ropeForm" style="display:none;margin-top:10px;animation:fadeUp .3s ease">
      <div style="display:flex;gap:8px;margin-top:8px">
        <input class="rt-in" id="rt-j" type="number" placeholder="${T('jumps')}">
        <input class="rt-in" id="rt-d" type="number" placeholder="${T('dur_lbl')}">
        <button class="rt-save" onclick="saveRope()">âœ“</button>
      </div>
    </div>`;
}
function toggleRopeForm(){const f=document.getElementById('ropeForm');if(f)f.style.display=f.style.display==='none'?'block':'none';}
function saveRope(){
  const j=+document.getElementById('rt-j')?.value||0,d=+document.getElementById('rt-d')?.value||0;if(!j)return;
  if(!S.ropeLog)S.ropeLog=[];
  S.ropeLog.push({date:new Date().toISOString().split('T')[0],jumps:j,duration:d});
  save();renderRopeTracker();notify('âœ“ '+j+' '+T('jumps'));
}

// ============================================================
// TIMER PRESETS
// ============================================================
function renderTimerPresets(){
  const presets=[30,60,90,120,180,300];
  const h=presets.map(s=>`<button class="preset" onclick="setTimer(${s},'');setAP(${s})">${s>=60?s/60+'m':s+'s'}</button>`).join('');
  ['timerPresets','dtPresets'].forEach(id=>{const el=document.getElementById(id);if(el)el.innerHTML=h;});
  renderRopeTracker();
}
function setAP(s){const lbl=s>=60?s/60+'m':s+'s';document.querySelectorAll('.preset').forEach(p=>p.classList.toggle('active',p.textContent===lbl));}

// ============================================================
// TIPS
// ============================================================
function renderTips(){
  const el=document.getElementById('tipsContent');if(!el)return;
  const tips=TIPS[S.lang]||TIPS.ar;
  el.innerHTML=tips.map(t=>`<div class="tip-card"><div class="tip-ico">${t.icon}</div><div class="tip-c"><h4>${t.title}</h4><p>${t.text}</p></div></div>`).join('');
}

// ============================================================
// SETTINGS
// ============================================================
function renderSettings(){
  const p=S.profile||{};
  const ll={beginner:T('beginner'),intermediate:T('intermediate'),advanced:T('advanced'),elite:T('elite')};
  const gl={burn:T('burn_fat'),muscle:T('build_muscle'),fitness:T('fitness'),health:T('health')};
  const pc=document.getElementById('profCard');
  if(pc)pc.innerHTML=`<div class="profile-av">ðŸ‘¤</div>
    <div class="profile-info"><div class="profile-nm">${p.name||'â€”'}</div><div class="profile-meta">${ll[p.level]||''} Â· ${gl[p.goal]||''} Â· ${p.weight||'â€”'}kg</div></div>
    <button class="profile-edit" onclick="editProfile()">âœï¸ ${S.lang==='ar'?'ØªØ¹Ø¯ÙŠÙ„':'Edit'}</button>`;
  const sc=document.getElementById('settContent');if(!sc)return;
  sc.innerHTML=`
    <div class="sett-card"><div class="sett-title">ðŸŒ ${T('language')}</div>
      <div style="display:flex;gap:8px">${['ar','en','fr'].map(l=>`<button onclick="setLang('${l}')" style="flex:1;padding:9px;border:1.5px solid ${S.lang===l?'var(--g)':'rgba(212,168,67,.2)'};background:${S.lang===l?'rgba(212,168,67,.12)':'var(--c2)'};color:${S.lang===l?'var(--g)':'var(--dim)'};border-radius:9px;font-size:14px;font-weight:700;cursor:pointer">${l.toUpperCase()}</button>`).join('')}</div>
    </div>
    <div class="sett-card"><div class="sett-title">ðŸ“… ${T('start_date')}</div>
      <div class="sett-row"><div><div class="sett-lbl">${T('start_date')}</div><div class="sett-sub">${S.startDate||'â€”'}</div></div>
        <div style="display:flex;gap:6px"><input type="date" class="sett-val" id="settDate" value="${S.startDate||''}" style="width:140px"><button class="sett-save" onclick="saveDate()">âœ“</button></div>
      </div>
    </div>
    <div class="sett-card"><div class="sett-title">âš™ï¸ ${T('settings')}</div>
      <div class="sett-row"><div class="sett-lbl">${T('sound')}</div>
        <label class="toggle-sw"><input type="checkbox" ${S.settings?.sound!==false?'checked':''} onchange="setSetting('sound',this.checked)"><span class="toggle-sl"></span></label>
      </div>
      <div class="sett-row"><div class="sett-lbl">${T('auto_adv')}</div>
        <label class="toggle-sw"><input type="checkbox" ${S.settings?.autoAdvance?'checked':''} onchange="setSetting('autoAdvance',this.checked)"><span class="toggle-sl"></span></label>
      </div>
    </div>
    <div class="sett-card"><div class="sett-title">âœï¸ ${S.lang==='ar'?'ØªÙ…Ø§Ø±ÙŠÙ† Ù…Ø®ØµØµØ©':'Custom Exercises'}</div>
      ${!(S.customEx?.length)?`<div style="font-size:12px;color:var(--dim);text-align:center;padding:10px">${S.lang==='ar'?'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ…Ø§Ø±ÙŠÙ† Ù…Ø®ØµØµØ©':'No custom exercises yet'}</div>`:''}
      ${(S.customEx||[]).map(ex=>`<div class="sett-row"><div style="display:flex;align-items:center;gap:8px"><span style="font-size:18px">${ex.emoji||'âœï¸'}</span><div><div style="font-size:12px;font-weight:700">${ex.nameAr}</div><div style="font-size:10px;color:var(--dim)">${ex.nameEn}</div></div></div>
        <button onclick="delCustomEx('${ex.id}')" style="padding:4px 9px;border:1px solid rgba(231,76,60,.25);background:rgba(231,76,60,.06);color:var(--red);font-size:11px;border-radius:7px;cursor:pointer">ðŸ—‘</button></div>`).join('')}
      <button class="bigbtn gold" style="font-size:12px;margin-top:8px" onclick="openCreateEx()">âž• ${T('create_ex')}</button>
    </div>
    <div class="sett-card" style="border-color:rgba(231,76,60,.2)"><div class="sett-title" style="color:var(--red)">âš ï¸ ${T('reset_data')}</div>
      <button class="bigbtn red" style="font-size:12px;animation:none" onclick="doReset()">ðŸ—‘ ${T('reset_data')}</button>
    </div>`;
}
function setLang(l){S.lang=l;save();applyLang();renderAll();}
function setSetting(k,v){if(!S.settings)S.settings={};S.settings[k]=v;if(k==='sound')soundOn=v;save();}
function saveDate(){const d=document.getElementById('settDate')?.value;if(d){S.startDate=d;autoDay();save();notify('âœ“');renderWorkout();}}
function delCustomEx(id){confirm2(S.lang==='ar'?'Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ…Ø±ÙŠÙ†ØŸ':'Delete?',()=>{S.customEx=(S.customEx||[]).filter(e=>e.id!==id);save();renderSettings();notify('âœ“');});}
function doReset(){confirm2(T('confirm_reset'),()=>{localStorage.removeItem(STORAGE_KEY);location.reload();});}
function editProfile(){const p=S.profile||{};const n=prompt(S.lang==='ar'?'Ø§Ù„Ø§Ø³Ù…:':'Name:',p.name||'');if(n){S.profile={...S.profile,name:n};save();renderSettings();}}

// ============================================================
// STATS UPDATE
// ============================================================
function updateStats(){
  calcStreak();
  const sv=(id,v)=>{const el=document.getElementById(id);if(el)el.textContent=v;};
  sv('sv-streak',S.streak);sv('sv-done',S.completedDays.length);
  sv('sv-kcal',Math.round(S.totalKcal||0));sv('sv-min',Math.round(S.totalMin||0));sv('sv-badges',S.earnedBadges.length);
  sv('dt-strk',S.streak);sv('dt-tot',S.completedDays.length);
  const dd=getDayData(S.day);
  if(dd&&!dd.rest){
    const kcal=dd.exercises.reduce((s,e)=>{const ex=getEx(e.id);return s+(ex?ex.kcal*(e.sets||3):0);},0);
    const done=dd.exercises.filter(e=>(S.exSets[`${e.id}-${S.day}`]||0)>=(e.sets||3)).length;
    sv('dt-kcal',Math.round(kcal));sv('dt-done',`${done}/${dd.exercises.length}`);
  }
}

// ============================================================
// THEME & MODE
// ============================================================
const THEMES=[
  {id:'gold',dot:'#D4A843',name:'Ø°Ù‡Ø¨ÙŠ / Gold'},{id:'fire',dot:'#E85D04',name:'Ù†Ø§Ø±ÙŠ / Fire'},
  {id:'ocean',dot:'#0096C7',name:'Ù…Ø­ÙŠØ· / Ocean'},{id:'nature',dot:'#2D6A4F',name:'Ø·Ø¨ÙŠØ¹Ø© / Nature'},
  {id:'neon',dot:'#F900BF',name:'Ù†ÙŠÙˆÙ† / Neon'},{id:'light',dot:'#B8860B',name:'ÙØ§ØªØ­ / Light'},
  {id:'purple',dot:'#9D4EDD',name:'Ø¨Ù†ÙØ³Ø¬ÙŠ / Purple'},
];
function applyTheme(){document.documentElement.setAttribute('data-theme',S.theme);buildStars();}
function buildStars(){
  const c=document.getElementById('stars');if(!c)return;
  c.innerHTML=Array(40).fill(0).map(()=>{
    const sz=1+Math.random()*2.5,x=Math.random()*100,y=Math.random()*100,d=(2+Math.random()*5)+'s';
    return`<div class="star" style="width:${sz}px;height:${sz}px;left:${x}%;top:${y}%;background:rgba(212,168,67,${.2+Math.random()*.6});--d:${d}"></div>`;
  }).join('');
}
function toggleTheme(){
  const panel=document.getElementById('themePanel');if(!panel)return;
  if(!panel.innerHTML)panel.innerHTML=THEMES.map(t=>`<div class="th-opt${S.theme===t.id?' on':''}" onclick="setTheme('${t.id}')"><div class="th-dot" style="background:${t.dot}"></div><div class="th-nm">${t.name}</div></div>`).join('');
  panel.classList.toggle('open');
}
function setTheme(t){S.theme=t;save();applyTheme();document.querySelectorAll('.th-opt').forEach(o=>o.classList.toggle('on',o.getAttribute('onclick')?.includes("'"+t+"'")));}


const MODE_INFO={
  mobile:{ar:{name:'ÙˆØ¶Ø¹ Ø§Ù„Ø¬ÙˆØ§Ù„',desc:'ÙˆØ§Ø¬Ù‡Ø© Ù…Ø­Ø³Ù‘Ù†Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø©'},en:{name:'Mobile Mode',desc:'Optimized for small screens'},fr:{name:'Mode Mobile',desc:'OptimisÃ© pour petits Ã©crans'},icon:'ðŸ“±',color:'#4ECDC4'},
  desktop:{ar:{name:'ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨',desc:'ØªØ®Ø·ÙŠØ· Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù…Ø¹ Ù„ÙˆØ­Ø© Ù…ÙØ§ØªÙŠØ­'},en:{name:'Desktop Mode',desc:'3-column layout with shortcuts'},fr:{name:'Mode Bureau',desc:'Mise en page 3 colonnes'},icon:'ðŸ–¥ï¸',color:'#A78BFA'},
  tv:{ar:{name:'ÙˆØ¶Ø¹ Ø§Ù„ØªÙ„ÙØ§Ø²',desc:'Ø®Ø·ÙˆØ· ÙƒØ¨ÙŠØ±Ø© ÙˆØ£Ø²Ø±Ø§Ø± ØªØ­ÙƒÙ… Ø¹Ù† Ø¨ÙØ¹Ø¯'},en:{name:'TV Mode',desc:'Large text and remote controls'},fr:{name:'Mode TV',desc:'Grand texte et tÃ©lÃ©commande'},icon:'ðŸ“º',color:'#FB923C'},
};
function showModeToast(mode){
  const info=MODE_INFO[mode]||MODE_INFO.mobile;
  const lang=S.lang||'ar';
  const linfo=info[lang]||info.ar;
  const el=document.getElementById('modeToast');
  const ico=document.getElementById('modeToastIco');
  const name=document.getElementById('modeToastName');
  const desc=document.getElementById('modeToastDesc');
  if(!el)return;
  ico.textContent=info.icon;
  name.textContent=linfo.name;
  name.style.color=info.color;
  desc.textContent=linfo.desc;
  el.style.borderColor=info.color+'44';
  el.classList.add('show');
  clearTimeout(el._t);
  el._t=setTimeout(()=>el.classList.remove('show'),2800);
}
function cycleMode(){
  const ms=['mobile','desktop','tv'];S.mode=ms[(ms.indexOf(S.mode)+1)%3];save();
  showModeToast(S.mode);
  applyMode();
}
functionfunction applyMode(){
  document.body.classList.remove('desktop-mode','tv-mode');
  const icons={mobile:'ðŸ“±',desktop:'ðŸ–¥ï¸',tv:'ðŸ“º'};
  document.querySelectorAll('[id*="odeBtn"],[id="fabMode"]').forEach(el=>{if(el)el.textContent=icons[S.mode]||'ðŸ“±';});
  if(S.mode==='desktop'||S.mode==='tv'){
    document.body.classList.add('desktop-mode');
    if(S.mode==='tv')document.body.classList.add('tv-mode');
    dtRender();initKb();
  }else renderAll();
}

// ============================================================
// DESKTOP
// ============================================================
function dtRender(){dtBuildDayStrip();dtRenderExList();updateStats();}
function dtBuildDayStrip(){
  const plan=getActivePlan(),strip=document.getElementById('dtDays');if(!strip)return;
  strip.innerHTML=plan.days.map(d=>`<button class="dt-day${S.day===d.day?' act':''}${S.completedDays.includes(d.day)?' done':''}" onclick="dtSelDay(${d.day})">
    <span class="dn">${d.day}</span><span style="font-size:8px">${d.rest?'ðŸ˜´':S.completedDays.includes(d.day)?'âœ“':'â–¸'}</span></button>`).join('');
  setTimeout(()=>{const a=strip.querySelector('.act');if(a)a.scrollIntoView({inline:'center',block:'nearest'});},80);
}
function dtSelDay(d){S.day=d;save();dtBuildDayStrip();dtRenderExList();updateStats();}
function dtRenderExList(){
  const dd=getDayData(S.day),list=document.getElementById('dtExList'),center=document.getElementById('dtCenter');
  if(!dd||dd.rest){
    if(list)list.innerHTML=`<div style="text-align:center;padding:20px;color:var(--dim);font-size:12px">ðŸŒ™ ${T('rest_day')}</div>`;
    if(center)center.innerHTML=`<div style="text-align:center;padding:40px;"><div style="font-size:50px;margin-bottom:14px">ðŸŒ™</div><div style="font-size:18px;font-weight:900;color:var(--g)">${T('rest_day')}</div></div>`;
    return;
  }
  if(list)list.innerHTML=dd.exercises.map((er)=>{
    const ex=getEx(er.id);if(!ex)return'';
    const done=(S.exSets[`${er.id}-${S.day}`]||0)>=(er.sets||ex.sets||3);
    return`<div class="dt-exitem${done?' done':''}" onclick="dtShowEx('${er.id}')">
      <div class="dt-exthumb">${ex.photos?.length?`<img src="${ex.photos[0]}">`:(ex.emoji||'ðŸ’ª')}</div>
      <div class="dt-exinfo"><div class="dt-exnm">${exName(ex)}</div><div class="dt-exmeta">${er.sets||ex.sets}x${er.reps||ex.reps||er.dur||ex.dur}</div></div>
      <div class="dt-extick">${done?'âœ“':''}</div></div>`;
  }).join('');
  if(dd.exercises.length>0)dtShowEx(dd.exercises[0].id,dd.exercises[0]);
}
function dtShowEx(exId,erOv){
  const dd=getDayData(S.day),er=erOv||dd?.exercises?.find(e=>e.id===exId)||{id:exId,sets:3,reps:0,dur:0};
  const ex=getEx(exId);if(!ex)return;
  const sk=`${exId}-${S.day}`,sd=S.exSets[sk]||0,ts=er.sets||ex.sets||3,done=sd>=ts;
  const center=document.getElementById('dtCenter');if(!center)return;
  center.innerHTML=`<div style="background:var(--c);border:1px solid rgba(212,168,67,.1);border-radius:14px;overflow:hidden;margin-bottom:14px">
    <div style="height:200px;overflow:hidden;background:var(--c2);display:flex;align-items:center;justify-content:center">
      ${ex.photos?.length?`<img src="${ex.photos[0]}" style="width:100%;height:100%;object-fit:cover">`:`<div style="width:100%;height:100%">${svgEx(ex.id)}</div>`}
    </div>
    <div style="padding:18px 20px">
      <div style="font-size:22px;font-weight:900;margin-bottom:3px">${exName(ex)}</div>
      <div style="font-size:12px;color:var(--dim);margin-bottom:12px">${ex.muscle} Â· ${ex.type}</div>
      <ul class="steps-list" style="margin-bottom:16px">${exSteps(ex).map((s,i)=>`<li><span class="sn">${i+1}</span><span>${s}</span></li>`).join('')}</ul>
      <div class="set-track">
        <div class="set-dots">${Array(ts).fill(0).map((_,i)=>`<div class="sd${i<sd?' done':i===sd?' cur':''}"></div>`).join('')}</div>
        <div class="set-acts">
          <button class="set-go" onclick="completeSet('${exId}',${ts});dtRenderExList();dtShowEx('${exId}')" ${done?'disabled':''}>${done?'âœ“ '+T('completed'):`â–¶ ${T('start')} (${sd}/${ts})`}</button>
          ${ex.dur||er.dur?`<button class="set-t" onclick="launchTimer('${exId}',${ex.dur||er.dur})">â±</button>`:''}
        </div>
      </div>
    </div></div>`;
}
function dtStartSession(){openSoundModal(S.day);}

// ============================================================
// KEYBOARD SHORTCUTS
// ============================================================
const KB=[
  {key:'ArrowRight',ar:'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ',  en:'Next Day',      fn:()=>navDay(1)},
  {key:'ArrowLeft', ar:'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚', en:'Prev Day',      fn:()=>navDay(-1)},
  {key:'Space',     ar:'ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù',  en:'Timer Toggle',  fn:()=>tAct('toggle')},
  {key:'KeyR',      ar:'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†',  en:'Reset Timer',   fn:()=>tAct('reset')},
  {key:'KeyS',      ar:'Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©',   en:'Start Session', fn:()=>startGuided(S.day)},
  {key:'KeyE',      ar:'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…',  en:'Edit Day',      fn:()=>openDayEditor(S.day)},
  {key:'KeyM',      ar:'ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹',  en:'Toggle Mode',   fn:()=>cycleMode()},
  {key:'KeyL',      ar:'ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©',  en:'Toggle Lang',   fn:()=>cycleLang()},
  {key:'Digit1',    ar:'Ø«ÙŠÙ… Ø°Ù‡Ø¨ÙŠ',     en:'Gold Theme',    fn:()=>setTheme('gold')},
  {key:'Digit2',    ar:'Ø«ÙŠÙ… Ù†Ø§Ø±ÙŠ',     en:'Fire Theme',    fn:()=>setTheme('fire')},
  {key:'Digit3',    ar:'Ø«ÙŠÙ… Ù…Ø­ÙŠØ·',     en:'Ocean Theme',   fn:()=>setTheme('ocean')},
  {key:'Slash',     ar:'Ø§Ø®ØªØµØ§Ø±Ø§Øª',     en:'Shortcuts',     fn:()=>toggleKb()},
];
function initKb(){document.removeEventListener('keydown',handleKb);document.addEventListener('keydown',handleKb);renderKbList();}
function handleKb(e){if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA'||e.target.tagName==='SELECT')return;const sc=KB.find(s=>s.key===e.code);if(sc){e.preventDefault();sc.fn();}}
function toggleKb(){const p=document.getElementById('kbPanel');if(p)p.classList.toggle('open');}
function renderKbList(){
  const el=document.getElementById('kbList');if(!el)return;
  el.innerHTML=KB.map(s=>`<div class="kb-item"><span class="kb-lbl">${S.lang==='ar'?s.ar:s.en}</span><kbd class="kb-key">${s.key.replace('Key','').replace('Digit','').replace('Arrow','')}</kbd></div>`).join('');
}

// ============================================================
// NOTIFY & CONFIRM
// ============================================================
function notify(msg,dur=2200){
  const n=document.getElementById('notify');if(!n)return;
  n.textContent=msg;n.classList.add('show');clearTimeout(n._t);n._t=setTimeout(()=>n.classList.remove('show'),dur);
}
let _cb=null;
function confirm2(msg,cb,ico='âš ï¸'){_cb=cb;setText('confirmIco',ico);setText('confirmMsg',msg);const ov=document.getElementById('confirmOv');if(ov)ov.classList.add('open');}
function doConfirmYes(){const ov=document.getElementById('confirmOv');if(ov)ov.classList.remove('open');if(_cb){_cb();_cb=null;}}
function closeConfirm(){const ov=document.getElementById('confirmOv');if(ov)ov.classList.remove('open');_cb=null;}
function shakeEl(id){const el=document.getElementById(id);if(el){el.style.animation='shake .4s ease';setTimeout(()=>el.style.animation='',500);}}

// ============================================================
// DAILY QUOTE & MESSAGE
// ============================================================
function renderQuote(){
  const qs=QUOTES[S.lang]||QUOTES.ar;
  const el=document.getElementById('quoteCard');if(el)el.textContent='"'+(qs[Math.floor((S.day-1)%qs.length)]||qs[0])+'"';
}
function renderDailyMsg(){
  const el=document.getElementById('dailyMsg');if(!el)return;
  const plan=getActivePlan(),workDays=plan.days.filter(d=>!d.rest).length;
  const pct=S.completedDays.length/workDays*100;
  let msg='',color='var(--g)',bg='rgba(212,168,67,.08)',border='rgba(212,168,67,.2)';
  if(pct>=80){msg=S.lang==='ar'?'ðŸ† Ø±Ø§Ø¦Ø¹! Ø£Ù†Øª Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ù‡Ø¯Ù!':'ðŸ† Amazing! Almost there!';color='var(--green)';bg='rgba(29,185,84,.07)';border='rgba(29,185,84,.2)';}
  else if(S.streak>=5){msg=S.lang==='ar'?`ðŸ”¥ ${S.streak} Ø£ÙŠØ§Ù… Ù…ØªÙˆØ§ØµÙ„Ø©!`:`ðŸ”¥ ${S.streak}-day streak!`;}
  else if(S.completedDays.includes(S.day)){msg=S.lang==='ar'?'âœ“ Ø£ÙƒÙ…Ù„Øª Ø§Ù„ÙŠÙˆÙ…!':'âœ“ Day complete!';}
  else{msg=S.lang==='ar'?`ðŸ’ª ${T('day')} ${S.day} â€” Ø£Ù†Øª ØªØ³ØªØ·ÙŠØ¹!`:`ðŸ’ª Day ${S.day} â€” You got this!`;}
  el.textContent=msg;
  el.style.cssText=`display:block;margin:8px 14px 0;padding:10px 14px;border-radius:10px;border:1px solid ${border};font-size:12px;font-weight:600;text-align:center;color:${color};background:${bg}`;
}

// ============================================================
// RENDER ALL
// ============================================================
function renderAll(){applyLang();applyTheme();renderQuote();renderDailyMsg();updateStats();showView(curView);}

// ============================================================
// PWA
// ============================================================
function initPWA(){if('serviceWorker' in navigator)navigator.serviceWorker.register('./sw.js').catch(()=>{});}

// ============================================================
// INIT
// ============================================================
function init(){
  load();
  soundOn=S.settings?.sound!==false;
  initPWA();applyTheme();applyLang();
  const ob=document.getElementById('ob');
  if(!S.profile){if(ob)ob.classList.remove('hidden');return;}
  if(ob)ob.classList.add('hidden');
  autoDay();initApp();
}
function initApp(){
  initNewFeatures();
  applyLang();applyTheme();buildStars();renderQuote();renderDailyMsg();
  updateStats();applyMode();checkBadges();renderWorkout();
}


// ============================================================
// FITPULSE PRO v7 â€” NEW FEATURES
// ============================================================

// â”€â”€â”€ GIF HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getExGif(exId){
  if(typeof GIFS==='undefined')return null;
  const map={
    burpee:'burpee',pushup:'pushup',squat:'squat',plank:'plank',
    highknees:'highknees',jumpingjack:'jumpingjack',jumprope:'jumprope',
    dip:'dip',crunch:'crunch',sideplank:'sideplank',
    superman:'superman',boxjump:'boxjump',lunge:'lunge',
    glute:'glute',glute_bridge:'glute',mountainclimber:'mountainclimber',
    oblique:'oblique',wallsit:'wallsit',shadowbox:'shadowbox',
    russian:'russian',russian_twist:'russian',
  };
  const key=map[exId]||map[exId?.toLowerCase()]||exId;
  return GIFS[key]||GIFS[exId]||null;
}

function buildGifDisplay(ex,erec){
  const gif=getExGif(ex.id);
  if(gif){
    return`<div style="position:relative;border-radius:12px;overflow:hidden;background:#000;min-height:160px;max-height:220px;display:flex;align-items:center;justify-content:center">
      <img src="${gif}" class="ex-gif" style="max-height:220px;width:100%;object-fit:contain" alt="${exName(ex)}" loading="lazy">
      <div style="position:absolute;bottom:6px;right:6px;padding:3px 8px;background:rgba(0,0,0,.65);border-radius:6px;font-size:9px;color:rgba(255,255,255,.7)">GIF</div>
    </div>`;
  }
  return`<div style="height:160px;display:flex;align-items:center;justify-content:center;background:var(--card2);border-radius:12px;font-size:60px">${ex.emoji||'ðŸ’ª'}</div>`;
}

// â”€â”€â”€ MODE CHANGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


// Override cycleMode to add toast
const _origCycleMode=typeof cycleMode==='function'?cycleMode:null;

// â”€â”€â”€ TAB TITLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let tabTitleInterval=null;
function updateTabTitle(text){
  document.title=text?`${text} | âš¡ FITPULSE PRO`:'âš¡ FITPULSE PRO';
}
function startTabTimer(totalSecs){
  clearInterval(tabTitleInterval);
  tabTitleInterval=setInterval(()=>{
    if(TM&&TM.running)updateTabTitle(`â± ${fmtT(TM.secs)}`);
    else{clearInterval(tabTitleInterval);updateTabTitle('');}
  },1000);
}
function stopTabTimer(){clearInterval(tabTitleInterval);updateTabTitle('');}

// â”€â”€â”€ WATER REMINDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let waterTimer=null,waterInterval=20*60*1000;
function startWaterReminder(){
  stopWaterReminder();
  waterTimer=setInterval(()=>showWaterReminder(),waterInterval);
}
function stopWaterReminder(){clearInterval(waterTimer);waterTimer=null;}
function showWaterReminder(){
  const el=document.getElementById('waterToast');
  if(!el)return;
  const msgs={ar:{t:'ÙˆÙ‚Øª Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡! ðŸ’§',s:'Ø§Ø¨Ù‚ Ø±Ø·Ø¨Ø§Ù‹ â€” Ø§Ù„Ù…Ø§Ø¡ ÙŠØ­Ø³Ù‘Ù† Ø£Ø¯Ø§Ø¡Ùƒ'},en:{t:'Hydration Time! ðŸ’§',s:'Stay hydrated â€” water boosts performance'},fr:{t:'Bois de l\'eau! ðŸ’§',s:'Reste hydratÃ© â€” l\'eau amÃ©liore tes perfs'}};
  const m=msgs[S.lang]||msgs.ar;
  const tt=document.getElementById('wtTitle'),ts=document.getElementById('wtSub');
  if(tt)tt.textContent=m.t;if(ts)ts.textContent=m.s;
  el.classList.add('show');
}
function dismissWater(){
  const el=document.getElementById('waterToast');
  if(el)el.classList.remove('show');
}

// â”€â”€â”€ DND MODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkDND(){
  const h=new Date().getHours();
  const isDND=h>=0&&h<6;
  const badge=document.getElementById('dndBadge');
  const txt=document.getElementById('dndText');
  if(badge){badge.classList.toggle('active',isDND);}
  if(isDND&&soundOn){soundOn=false;if(txt)txt.textContent=S.lang==='ar'?'ÙˆØ¶Ø¹ Ø§Ù„Ù‡Ø¯ÙˆØ¡':'Do Not Disturb';}
  else if(!isDND&&S.settings?.sound!==false){soundOn=true;}
  return isDND;
}

// â”€â”€â”€ VIBRATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function vibrate(pattern){
  if(!navigator.vibrate)return;
  navigator.vibrate(pattern);
}

// â”€â”€â”€ WEEKLY SUMMARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkWeeklySummary(){
  if(!S.startDate)return;
  const start=new Date(S.startDate);
  const now=new Date();
  const daysSince=Math.floor((now-start)/(1000*60*60*24));
  const lastShown=S.lastWeeklySummary||0;
  const weekNum=Math.floor(daysSince/7);
  if(weekNum>0&&weekNum!==lastShown){
    S.lastWeeklySummary=weekNum;save();
    setTimeout(()=>showWeeklySummary(weekNum),2000);
  }
}

function showWeeklySummary(weekNum){
  const el=document.getElementById('weeklyOv');if(!el)return;
  const plan=getActivePlan();
  const totalWorkDays=plan.days.filter(d=>!d.rest).length;
  
  // Get this week's days
  const weekStart=(weekNum-1)*7+1,weekEnd=weekNum*7;
  const thisWeekDays=S.completedDays.filter(d=>d>=weekStart&&d<=weekEnd);
  const lastWeekDays=S.completedDays.filter(d=>d>=(weekStart-7)&&d<weekStart);
  
  const thisKcal=thisWeekDays.reduce((s,d)=>{
    const dd=getActivePlan().days.find(x=>x.day===d);
    return s+(dd?dd.exercises.reduce((ss,e)=>{const ex=getEx(e.id);return ss+(ex?ex.kcal*(e.sets||3):0);},0):0);
  },0);
  
  const diff=thisWeekDays.length-lastWeekDays.length;
  const trophy=thisWeekDays.length>=5?'ðŸ†':thisWeekDays.length>=3?'ðŸ¥ˆ':thisWeekDays.length>=1?'ðŸ¥‰':'ðŸ’ª';
  
  const titles={ar:['Ø£Ø³Ø¨ÙˆØ¹ Ø±Ø§Ø¦Ø¹!','Ø§Ø³ØªÙ…Ø± Ù‡ÙƒØ°Ø§!','Ø£Ø­Ø³Ù†Øª!','Ø¨Ø¯Ø§ÙŠØ© Ø¬ÙŠØ¯Ø©!'],en:['Amazing Week!','Keep Going!','Well Done!','Good Start!'],fr:['Semaine incroyable!','Continue!','Bien jouÃ©!','Bon dÃ©but!']};
  const lang=S.lang||'ar';
  const title=titles[lang][Math.min(Math.floor(thisWeekDays.length/2),3)];
  
  const el2=(id)=>document.getElementById(id);
  if(el2('wkTrophy'))el2('wkTrophy').textContent=trophy;
  if(el2('wkWeekLbl'))el2('wkWeekLbl').textContent=lang==='ar'?`Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${weekNum}`:`Week ${weekNum}`;
  if(el2('wkTitle'))el2('wkTitle').textContent=title;
  
  // Build stats grid
  const grid=el2('wkGrid');
  if(grid){
    const stats=[
      {val:thisWeekDays.length,lbl:lang==='ar'?'Ø£ÙŠØ§Ù… Ù…ÙƒØªÙ…Ù„Ø©':'Days Done',diff:diff},
      {val:Math.round(thisKcal),lbl:lang==='ar'?'Ø³Ø¹Ø±Ø© Ù…Ø­Ø±ÙˆÙ‚Ø©':'Calories',diff:null},
      {val:S.streak,lbl:lang==='ar'?'Ø£ÙŠØ§Ù… Ù…ØªÙˆØ§ØµÙ„Ø©':'Day Streak',diff:null},
      {val:S.earnedBadges.length,lbl:lang==='ar'?'Ø´Ø§Ø±Ø§Øª':'Badges',diff:null},
    ];
    grid.innerHTML=stats.map(s=>`
      <div class="wk-stat">
        <span class="wk-stat-val" style="animation:countUp .8s ease">${s.val}</span>
        <span class="wk-stat-lbl">${s.lbl}</span>
        ${s.diff!==null?`<span class="wk-stat-diff ${s.diff>=0?'up':'down'}">${s.diff>=0?'â†‘':'â†“'} ${Math.abs(s.diff)} ${lang==='ar'?'Ù…Ù† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¶ÙŠ':'vs last week'}</span>`:''}
      </div>`).join('');
  }
  
  // Day bars
  const bars=el2('wkDayBars');
  const dayNames={ar:['Ø³','Ø­','Ù†','Ø«','Ø±','Ø®','Ø¬'],en:['M','T','W','T','F','S','S'],fr:['L','M','M','J','V','S','D']};
  if(bars){
    bars.innerHTML=Array(7).fill(0).map((_,i)=>{
      const dayNum=weekStart+i;
      const done=S.completedDays.includes(dayNum);
      const isRest=getActivePlan().days.find(d=>d.day===dayNum)?.rest;
      const h=done?100:isRest?30:0;
      return`<div class="wk-bar-wrap">
        <div class="wk-bar ${done?'done':''}" style="height:${h}%"></div>
        <div class="wk-bar-day">${dayNames[lang]?.[i]||i+1}</div>
      </div>`;
    }).join('');
  }
  
  // Message
  const msgs={ar:['ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹ Ø®Ø·ÙˆØ© Ù†Ø­Ùˆ Ù‡Ø¯ÙÙƒ','Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ù‡ÙŠ Ø§Ù„Ù…ÙØªØ§Ø­','Ø£Ù†Øª Ø£Ù‚ÙˆÙ‰ Ù…Ù…Ø§ ØªØ¸Ù†','Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØªØ£ØªÙŠ Ø¨Ø§Ù„ØµØ¨Ø± ÙˆØ§Ù„ØªÙƒØ±Ø§Ø±'],
    en:['Every week is a step toward your goal','Consistency is the key','You are stronger than you think','Results come with patience'],
    fr:['Chaque semaine est un pas vers ton objectif','La rÃ©gularitÃ© est la clÃ©','Tu es plus fort que tu ne le penses','Les rÃ©sultats viennent avec la patience']};
  const msgEl=el2('wkMsg');
  if(msgEl)msgEl.textContent=`"${msgs[lang][weekNum%msgs[lang].length]}"`;
  
  el.classList.add('open');
}

function closeWeekly(){
  const el=document.getElementById('weeklyOv');
  if(el)el.classList.remove('open');
}

// â”€â”€â”€ REDO DAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function redoDay(day){
  const lang=S.lang||'ar';
  const msg=lang==='ar'?'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…ØŸ Ø³ÙŠØªÙ… Ù…Ø³Ø­ ØªÙ‚Ø¯Ù…Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ.':'Redo this day? Current progress will be cleared.';
  confirm2(msg,()=>{
    // Remove from completed
    S.completedDays=S.completedDays.filter(d=>d!==day);
    // Clear set data for this day
    const toDelete=Object.keys(S.exSets||{}).filter(k=>k.endsWith('-'+day));
    toDelete.forEach(k=>delete S.exSets[k]);
    save();renderWorkout();
    if(document.getElementById('compOv'))document.getElementById('compOv').classList.remove('open');
    const msg2=lang==='ar'?'ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙŠÙˆÙ… âœ“':'Day reset âœ“';
    notify(msg2);
  },'ðŸ”');
}

// â”€â”€â”€ SOUND MODAL (before session) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _pendingSessionDay=null;
function openSoundModal(day){
  _pendingSessionDay=day;
  const el=document.getElementById('soundModal');
  if(!el)return;
  // Update sound toggles from settings
  const ss=S.soundSettings||{countdown:true,rest:true,complete:true,set:true,vol:80};
  const ids=['sndCountdown','sndRest','sndComplete','sndSet'];
  const keys=['countdown','rest','complete','set'];
  ids.forEach((id,i)=>{const el2=document.getElementById(id);if(el2)el2.checked=ss[keys[i]!==undefined?keys[i]:keys[i]]!==false;});
  const vol=document.getElementById('masterVol');if(vol)vol.value=ss.vol||80;
  const pct=document.getElementById('volPct');if(pct)pct.textContent=(ss.vol||80)+'%';
  // Translate
  applyLangSoundModal();
  el.classList.add('open');
}
function applyLangSoundModal(){
  const lang=S.lang||'ar';
  const t={ar:{title:'ðŸŽµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª',sub:'Ø§Ø®ØªØ± Ø§Ù„Ø£ØµÙˆØ§Øª Ø®Ù„Ø§Ù„ Ø§Ù„Ø¬Ù„Ø³Ø©',s1n:'ØµÙˆØª Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ',s1d:'3-2-1 Ù‚Ø¨Ù„ ÙƒÙ„ ØªÙ…Ø±ÙŠÙ†',s2n:'Ø¬Ø±Ø³ Ø§Ù„Ø±Ø§Ø­Ø©',s2d:'ØµÙˆØª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ ÙˆÙ‚Øª Ø§Ù„Ø±Ø§Ø­Ø©',s3n:'ØµÙˆØª Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„',s3d:'Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø¹Ù†Ø¯ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØ¯Ø±ÙŠØ¨',s4n:'ØµÙˆØª Ø§Ù„Ø¬Ù„Ø³Ø©',s4d:'Ù†Ù‚Ø±Ø© Ø¹Ù†Ø¯ Ø¥Ù†Ù‡Ø§Ø¡ ÙƒÙ„ Ø¬Ù„Ø³Ø©',btn:'ðŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬Ù„Ø³Ø©'},
    en:{title:'ðŸŽµ Sound Settings',sub:'Choose sounds during session',s1n:'Countdown Sound',s1d:'3-2-1 before each exercise',s2n:'Rest Bell',s2d:'Sound when rest starts',s3n:'Completion Sound',s3d:'Music when workout ends',s4n:'Set Sound',s4d:'Click when set is done',btn:'ðŸš€ Start Session'},
    fr:{title:'ðŸŽµ ParamÃ¨tres Son',sub:'Choisissez les sons pendant la sÃ©ance',s1n:'Son de dÃ©compte',s1d:'3-2-1 avant chaque exercice',s2n:'Sonnerie de repos',s2d:'Son au dÃ©but du repos',s3n:'Son de fin',s3d:'Musique quand l\'entraÃ®nement se termine',s4n:'Son de sÃ©rie',s4d:'Clic quand la sÃ©rie est terminÃ©e',btn:'ðŸš€ DÃ©marrer'}};
  const v=t[lang]||t.ar;
  const s=(id,txt)=>{const e=document.getElementById(id);if(e)e.textContent=txt;};
  s('sndTitle',v.title);s('sndSub',v.sub);s('snd1n',v.s1n);s('snd1d',v.s1d);
  s('snd2n',v.s2n);s('snd2d',v.s2d);s('snd3n',v.s3n);s('snd3d',v.s3d);
  s('snd4n',v.s4n);s('snd4d',v.s4d);s('sndStartBtn',v.btn);
}
function setMasterVol(v){
  const pct=document.getElementById('volPct');if(pct)pct.textContent=v+'%';
  S.soundSettings=S.soundSettings||{};S.soundSettings.vol=+v;save();
}
function confirmStartSession(){
  // Save sound settings
  S.soundSettings=S.soundSettings||{};
  ['sndCountdown','sndRest','sndComplete','sndSet'].forEach((id,i)=>{
    const el=document.getElementById(id);
    const keys=['countdown','rest','complete','set'];
    if(el)S.soundSettings[keys[i]]=el.checked;
  });
  save();
  const el=document.getElementById('soundModal');
  if(el)el.classList.remove('open');
  if(_pendingSessionDay!==null){startGuidedImpl(_pendingSessionDay);startWaterReminder();startTabTimer();_pendingSessionDay=null;}
}
function closeSoundModal(){const el=document.getElementById('soundModal');if(el)el.classList.remove('open');}

// â”€â”€â”€ GIF GUIDE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openGifGuide(){
  const el=document.getElementById('gifGuideOv');
  if(!el)return;
  applyLangGifGuide();
  el.classList.add('open');
}
function closeGifGuide(){const el=document.getElementById('gifGuideOv');if(el)el.classList.remove('open');}
function applyLangGifGuide(){
  const lang=S.lang||'ar';
  const t={ar:{sub:'Ø¯Ù„ÙŠÙ„ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØµÙˆØ± Ù…ØªØ­Ø±ÙƒØ©',s1t:'Ø§ÙØªØ­ Google Ø£Ùˆ Giphy',s1d:'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© + gif Ù…Ø«Ù„: "push up gif"',s2t:'Ø§Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©',s2d:'Ù‡Ø§ØªÙ: Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹ â† Ø­ÙØ¸ | Ø­Ø§Ø³ÙˆØ¨: ÙƒÙ„ÙŠÙƒ ÙŠÙ…ÙŠÙ† â† Ø­ÙØ¸ Ø¨Ø§Ø³Ù…',s3t:'ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ù„Ù GIF',s3d:'ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙ†ØªÙ‡ÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø¨Ù€ .gif Ø­ØªÙ‰ ØªØ¸Ù‡Ø± Ø§Ù„Ø­Ø±ÙƒØ©',s4t:'Ø§Ø±ÙØ¹Ù‡Ø§ ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„ØµÙˆØ±',s4d:'Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙØ¹ ÙˆØ§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù â€” Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø­Ø±ÙƒØ© Ù…Ø¨Ø§Ø´Ø±Ø©!',tipt:'ðŸ’¡ Ù†ØµÙŠØ­Ø©',tipd:'Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ø£ÙØ¶Ù„: "squat exercise gif"'},
    en:{sub:'Step-by-step guide to get animated GIFs',s1t:'Open Google or Giphy',s1d:'Search exercise name + "gif" e.g. "push up exercise gif"',s2t:'Save the animated image',s2d:'Phone: long press â†’ Save Image | PC: right click â†’ Save As',s3t:'Make sure file is .gif',s3d:'The filename must end with .gif for animation to work',s4t:'Upload in the photo area',s4d:'Tap the upload area and pick the file â€” animation shows instantly!',tipt:'ðŸ’¡ Tip',tipd:'Search in English for better results: "squat exercise animation gif"'},
    fr:{sub:'Guide Ã©tape par Ã©tape pour les GIFs animÃ©s',s1t:'Ouvrir Google ou Giphy',s1d:'Chercher nom exercice + "gif" ex: "push up gif exercice"',s2t:'Sauvegarder l\'image animÃ©e',s2d:'Tel: appui long â†’ Enregistrer | PC: clic droit â†’ Enregistrer sous',s3t:'VÃ©rifier que le fichier est .gif',s3d:'Le nom du fichier doit finir par .gif pour l\'animation',s4t:'TÃ©lÃ©charger dans la zone photo',s4d:'Appuyer sur la zone de chargement et choisir le fichier',tipt:'ðŸ’¡ Conseil',tipd:'Chercher en anglais pour de meilleurs rÃ©sultats: "squat exercise gif"'}};
  const v=t[lang]||t.ar;
  const s=(id,txt)=>{const e=document.getElementById(id);if(e)e.textContent=txt;};
  s('ggSub',v.sub);s('gg1t',v.s1t);s('gg1d',v.s1d);s('gg2t',v.s2t);s('gg2d',v.s2d);
  s('gg3t',v.s3t);s('gg3d',v.s3d);s('gg4t',v.s4t);s('gg4d',v.s4d);
  s('ggTipTitle',v.tipt);s('ggTipText',v.tipd);
}

// â”€â”€â”€ TUTORIAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TUTORIAL_STEPS=[
  {target:'bnav',title:{ar:'Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„',en:'Navigation Bar',fr:'Barre de navigation'},desc:{ar:'Ø§Ù†ØªÙ‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø®Ù…Ø³Ø©: Ø§Ù„ØªØ¯Ø±ÙŠØ¨ØŒ Ø§Ù„ØªØ­Ø¯ÙŠØŒ Ø§Ù„Ù…Ø¤Ù‚ØªØŒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŒ Ø§Ù„Ù†ØµØ§Ø¦Ø­ ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',en:'Switch between 5 sections: Workout, Challenge, Timer, Track, Tips & Settings',fr:'Navigue entre 5 sections: EntraÃ®nement, DÃ©fi, Minuteur, Suivi, Conseils'},arrow:'up'},
  {target:'daySel',title:{ar:'Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙŠÙˆÙ…',en:'Day Selector',fr:'SÃ©lecteur de jour'},desc:{ar:'Ø§Ø³Ø­Ø¨ Ù„Ù„ÙŠÙ…ÙŠÙ† Ø£Ùˆ Ø§Ù„ÙŠØ³Ø§Ø± Ù„Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø£ÙŠØ§Ù… Ø§Ù„ØªØ­Ø¯ÙŠ. Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹ Ø¹Ù„Ù‰ Ø£ÙŠ ÙŠÙˆÙ… Ù„ØªØ¹Ø¯ÙŠÙ„Ù‡',en:'Swipe left/right to navigate days. Long press any day to edit it',fr:'Glisser pour naviguer. Appui long pour modifier'},arrow:'down'},
  {target:'wkContent',title:{ar:'Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†',en:'Exercise Cards',fr:'Cartes d\'exercice'},desc:{ar:'Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ù„ØªÙˆØ³ÙŠØ¹Ù‡ ÙˆØ¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª. Ø§Ø¶Ø¨Ø· Ø§Ù„Ø¬Ù„Ø³Ø§Øª ÙˆØ§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª Ø¨Ø§Ù„Ø£Ø²Ø±Ø§Ø± Â±',en:'Tap exercise to expand instructions. Adjust sets/reps with Â± buttons',fr:'Appuyer pour dÃ©velopper. Ajuster sÃ©ries/rÃ©pÃ©titions avec Â±'},arrow:'down'},
  {target:'fabMode',title:{ar:'ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¶Ø¹',en:'Change Mode',fr:'Changer de mode'},desc:{ar:'Ø¨Ø¯Ù‘Ù„ Ø¨ÙŠÙ† ÙˆØ¶Ø¹ Ø§Ù„Ø¬ÙˆØ§Ù„ ÙˆØ§Ù„Ø­Ø§Ø³ÙˆØ¨ ÙˆØ§Ù„ØªÙ„ÙØ§Ø². ÙƒÙ„ ÙˆØ¶Ø¹ Ù„Ù‡ ØªØµÙ…ÙŠÙ… Ù…Ø®ØªÙ„Ù Ù…Ø­Ø³Ù‘Ù† Ù„Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø©',en:'Switch between Mobile, Desktop & TV modes. Each has unique layout',fr:'Basculer entre Mobile, Bureau et TV'},arrow:'left'},
  {target:'fabTheme',title:{ar:'Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø«ÙŠÙ…',en:'Theme Selector',fr:'SÃ©lecteur de thÃ¨me'},desc:{ar:'Ø§Ø®ØªØ± Ù…Ù† 7 Ø«ÙŠÙ…Ø§Øª Ù…Ø®ØªÙ„ÙØ©. Ø§Ø¶ØºØ· Ù„Ù„ÙØªØ­ ÙˆØ§Ù„Ø§Ø®ØªÙŠØ§Ø±',en:'Choose from 7 themes. Tap to open and select',fr:'Choisir parmi 7 thÃ¨mes'},arrow:'left'},
  {target:'view-timer',title:{ar:'Ø§Ù„Ù…Ø¤Ù‚Øª',en:'Timer',fr:'Minuteur'},desc:{ar:'Ù…Ø¤Ù‚Øª Ø¯Ø§Ø¦Ø±ÙŠ Ù…Ø¹ ÙˆØ¶Ø¹ Tabata ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ø¨Ù‚Ø©. ÙŠØªØ²Ø§Ù…Ù† Ù…Ø¹ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…ÙˆØ¬Ù‡Ø©',en:'Circular timer with Tabata mode & presets. Syncs with guided session',fr:'Minuteur circulaire avec mode Tabata et prÃ©rÃ©glages'},arrow:'down'},
  {target:'app',title:{ar:'Ø£Ù†Øª Ø¬Ø§Ù‡Ø²!',en:'You\'re Ready!',fr:'Tu es prÃªt!'},desc:{ar:'Ù‡Ø°Ø§ ÙƒÙ„ Ø´ÙŠØ¡! Ø§Ø¶ØºØ· "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬Ù„Ø³Ø©" ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª Ù„Ø¨Ø¯Ø¡ ØªÙ…Ø±ÙŠÙ†Ùƒ Ø§Ù„Ù…ÙˆØ¬Ù‡. Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚! ðŸš€',en:'That\'s everything! Press "Start Session" anytime to begin guided workout. Good luck! ðŸš€',fr:'C\'est tout! Appuyer sur "DÃ©marrer" Ã  tout moment. Bonne chance! ðŸš€'},arrow:'down',last:true},
];
let tutStep=0;

function startTutorial(){
  tutStep=0;
  const ov=document.getElementById('tutorialOv');
  if(!ov)return;
  buildTutDots();
  ov.classList.add('active');
  showTutStep(0);
}
function buildTutDots(){
  const d=document.getElementById('tutDots');
  if(!d)return;
  d.innerHTML=TUTORIAL_STEPS.map((_,i)=>`<span id="td${i}"></span>`).join('');
  updateTutDots();
}
function updateTutDots(){
  TUTORIAL_STEPS.forEach((_,i)=>{
    const el=document.getElementById('td'+i);
    if(el)el.className=i===tutStep?'on':'';
  });
}
function showTutStep(i){
  const step=TUTORIAL_STEPS[i];
  if(!step)return skipTutorial();
  const lang=S.lang||'ar';
  const el=(id)=>document.getElementById(id);
  
  el('tutStep').textContent=`${lang==='ar'?'Ø§Ù„Ø®Ø·ÙˆØ©':'Step'} ${i+1} ${lang==='ar'?'Ù…Ù†':'of'} ${TUTORIAL_STEPS.length}`;
  el('tutTitle').textContent=step.title[lang]||step.title.ar;
  el('tutDesc').textContent=step.desc[lang]||step.desc.ar;
  el('tutNextBtn').textContent=step.last?(lang==='ar'?'ðŸš€ Ø§Ø¨Ø¯Ø£!':lang==='fr'?'ðŸš€ Commencer!':'ðŸš€ Start!'):(lang==='ar'?'Ø§Ù„ØªØ§Ù„ÙŠ â†':'Next â†’');
  el('tutSkipBtn').style.display=step.last?'none':'block';
  updateTutDots();
  
  // Position spotlight on target
  const target=document.getElementById(step.target)||document.querySelector('#'+step.target)||document.querySelector('.'+step.target)||document.querySelector('[data-view="'+step.target+'"]');
  const spotlight=el('tutSpotlight');
  const card=el('tutCard');
  if(target&&spotlight){
    const r=target.getBoundingClientRect();
    const pad=8;
    spotlight.style.cssText=`left:${r.left-pad}px;top:${r.top-pad}px;width:${r.width+pad*2}px;height:${r.height+pad*2}px;border-radius:14px`;
    
    // Position card
    const vh=window.innerHeight,vw=window.innerWidth;
    if(step.arrow==='up'||r.top>vh/2){
      card.style.cssText=`bottom:${vh-r.top+16}px;left:50%;transform:translateX(-50%)`;
      card.className='tutorial-card tc-arrow-down';
    }else{
      card.style.cssText=`top:${r.bottom+16}px;left:50%;transform:translateX(-50%)`;
      card.className='tutorial-card tc-arrow-up';
    }
  }else if(card){
    card.style.cssText='top:50%;left:50%;transform:translate(-50%,-50%)';
    card.className='tutorial-card';
    if(spotlight)spotlight.style.cssText='left:-1000px;top:-1000px;width:0;height:0';
  }
}
function nextTutorial(){
  tutStep++;
  if(tutStep>=TUTORIAL_STEPS.length){skipTutorial();return;}
  showTutStep(tutStep);
}
function skipTutorial(){
  const ov=document.getElementById('tutorialOv');
  if(ov)ov.classList.remove('active');
  S.tutorialDone=true;save();
}

// â”€â”€â”€ AI COACH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let aiHistory=[];
const AI_CHIPS={
  ar:['Ø¹Ø¯Ù‘Ù„ Ø¬Ø¯ÙˆÙ„ÙŠ ðŸ“‹','Ø­Ù„Ù‘Ù„ Ø£Ø¯Ø§Ø¦ÙŠ ðŸ“Š','Ø§Ù‚ØªØ±Ø­ ØªÙ…Ø±ÙŠÙ†Ø§Ù‹ ðŸ’ª','Ù†ØµÙŠØ­Ø© Ø§Ù„ÙŠÙˆÙ… âœ¨','ØªØ¹Ø¨ØªØŒ Ù…Ø§Ø°Ø§ Ø£ÙØ¹Ù„ØŸ ðŸ˜“','Ù‡Ù„ Ø£Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­ØŸ ðŸŽ¯'],
  en:['Edit my plan ðŸ“‹','Analyze my progress ðŸ“Š','Suggest exercise ðŸ’ª','Today\'s tip âœ¨','I\'m tired, what to do? ðŸ˜“','Am I on track? ðŸŽ¯'],
  fr:['Modifier mon plan ðŸ“‹','Analyser mes progrÃ¨s ðŸ“Š','SuggÃ©rer exercice ðŸ’ª','Conseil du jour âœ¨','Je suis fatiguÃ© ðŸ˜“','Suis-je sur la bonne voie? ðŸŽ¯'],
};

function openAI(){
  const el=document.getElementById('aiOverlay');
  if(!el)return;
  // Check API key
  const apiKey=S.aiApiKey||localStorage.getItem('fp6_ai_key')||'';
  const lang=S.lang||'ar';
  if(!apiKey){
    showAIApiPrompt();
  }else{
    if(aiHistory.length===0)sendAIWelcome();
  }
  renderAIChips();
  el.classList.add('open');
}
function closeAI(){
  const el=document.getElementById('aiOverlay');
  if(el)el.classList.remove('open');
}
function showAIApiPrompt(){
  const msgs=document.getElementById('aiMessages');
  if(!msgs)return;
  const lang=S.lang||'ar';
  const t={ar:{title:'Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„Ø°ÙƒÙŠ ðŸ¤–',body:'Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…ÙŠ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…ÙØªØ§Ø­ Anthropic API Ù…Ø¬Ø§Ù†ÙŠ.',placeholder:'sk-ant-...',btn:'Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­',note:'Ù…ÙØªØ§Ø­Ùƒ Ù…Ø­ÙÙˆØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ'},
    en:{title:'Hi! I\'m your AI Coach ðŸ¤–',body:'To use me you need a free Anthropic API key.',placeholder:'sk-ant-...',btn:'Save Key',note:'Your key is saved locally only'},
    fr:{title:'Bonjour! Je suis ton coach IA ðŸ¤–',body:'Pour m\'utiliser, tu as besoin d\'une clÃ© API Anthropic gratuite.',placeholder:'sk-ant-...',btn:'Sauvegarder',note:'ClÃ© sauvegardÃ©e localement seulement'}};
  const v=t[lang]||t.ar;
  msgs.innerHTML=`<div class="ai-msg bot">
    <b>${v.title}</b><br><br>${v.body}<br>
    <a href="https://console.anthropic.com/account/keys" target="_blank" style="color:#a78bfa;font-size:11px">ðŸ”— console.anthropic.com</a>
    <div class="ai-api-prompt">
      <input class="ai-api-input" id="aiKeyInput" type="password" placeholder="${v.placeholder}">
      <button onclick="saveAIKey()" style="width:100%;padding:10px;background:linear-gradient(135deg,#4f46e5,#7c3aed);color:#fff;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer">${v.btn}</button>
      <div style="font-size:10px;color:var(--dim);margin-top:8px">ðŸ”’ ${v.note}</div>
    </div>
  </div>`;
}
function saveAIKey(){
  const inp=document.getElementById('aiKeyInput');
  if(!inp||!inp.value.startsWith('sk-'))return;
  S.aiApiKey=inp.value;localStorage.setItem('fp6_ai_key',inp.value);save();
  sendAIWelcome();renderAIChips();
}
function renderAIChips(){
  const chips=document.getElementById('aiChips');if(!chips)return;
  const lang=S.lang||'ar';
  const list=AI_CHIPS[lang]||AI_CHIPS.ar;
  chips.innerHTML=list.map(c=>`<div class="ai-chip" onclick="sendAIChip('${c.replace(/'/g,"\\'").replace(/["]/g,'')}')">${c}</div>`).join('');
}
function sendAIWelcome(){
  const lang=S.lang||'ar';
  const greet={ar:`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${S.profile?.name||''}! ðŸ‘‹\n\nØ£Ù†Ø§ Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„Ø°ÙƒÙŠ. Ø£Ø¹Ø±Ù:\nâ€¢ Ø®Ø·ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ© (${getActivePlan().name})\nâ€¢ ØªÙ‚Ø¯Ù…Ùƒ (${S.completedDays.length} ÙŠÙˆÙ… Ù…ÙƒØªÙ…Ù„)\nâ€¢ Ù‡Ø¯ÙÙƒ ÙˆØ¥Ù…ÙƒØ§Ù†ÙŠØ§ØªÙƒ\n\nÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ`,
    en:`Hello ${S.profile?.name||''}! ðŸ‘‹\n\nI'm your AI coach. I know:\nâ€¢ Your current plan (${getActivePlan().name})\nâ€¢ Your progress (${S.completedDays.length} days done)\nâ€¢ Your goal and fitness level\n\nHow can I help you today?`,
    fr:`Bonjour ${S.profile?.name||''}! ðŸ‘‹\n\nJe suis ton coach IA. Je connais:\nâ€¢ Ton plan actuel (${getActivePlan().name})\nâ€¢ Ta progression (${S.completedDays.length} jours)\nâ€¢ Ton objectif\n\nComment puis-je t'aider?`};
  addAIMsg('bot',greet[lang]||greet.ar);
}
function addAIMsg(role,text){
  const msgs=document.getElementById('aiMessages');if(!msgs)return;
  const div=document.createElement('div');
  div.className=`ai-msg ${role}`;
  div.innerHTML=text.replace(/\n/g,'<br>')+`<span class="msg-time">${new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</span>`;
  msgs.appendChild(div);
  msgs.scrollTop=msgs.scrollHeight;
  aiHistory.push({role:role==='bot'?'assistant':'user',content:text});
}
function showAITyping(){
  const msgs=document.getElementById('aiMessages');if(!msgs)return;
  const div=document.createElement('div');div.id='aiTyping';div.className='ai-typing';
  div.innerHTML='<span></span><span></span><span></span>';
  msgs.appendChild(div);msgs.scrollTop=msgs.scrollHeight;
}
function removeAITyping(){const el=document.getElementById('aiTyping');if(el)el.remove();}
function sendAIChip(text){
  const inp=document.getElementById('aiInput');if(inp){inp.value=text;}
  sendAIMsg();
}
async function sendAIMsg(){
  const inp=document.getElementById('aiInput');
  if(!inp||!inp.value.trim())return;
  const text=inp.value.trim();inp.value='';
  const apiKey=S.aiApiKey||localStorage.getItem('fp6_ai_key')||'';
  if(!apiKey){openAI();return;}
  addAIMsg('user',text);
  showAITyping();
  const lang=S.lang||'ar';
  const plan=getActivePlan();
  const sysPrompt=`You are an expert personal fitness coach in the FITPULSE PRO app. Respond in ${lang==='ar'?'Arabic':lang==='fr'?'French':'English'}.

User Profile: ${JSON.stringify(S.profile||{})}
Current Plan: ${plan.name} (${plan.days.length} days)
Progress: ${S.completedDays.length} days completed, ${S.streak} day streak
Today: Day ${S.day}
Earned Badges: ${S.earnedBadges.length}
Total Kcal: ${Math.round(S.totalKcal||0)}

When modifying the plan, explain what you'd change and why. Be encouraging, specific, and actionable. Keep responses concise (max 200 words). Use emojis sparingly.`;

  try{
    const msgs=aiHistory.filter(m=>m.role==='user'||m.role==='assistant').slice(-8);
    const resp=await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{
        'content-type':'application/json',
        'x-api-key':apiKey,
        'anthropic-version':'2023-06-01',
        'anthropic-dangerous-direct-browser-access':'true'
      },
      body:JSON.stringify({model:'claude-haiku-4-5-20251001',max_tokens:600,system:sysPrompt,messages:msgs})
    });
    if(!resp.ok){
      const errData=await resp.json().catch(()=>({}));
      throw new Error(errData?.error?.message||'HTTP '+resp.status);
    }
    const data=await resp.json();
    const reply=data?.content?.[0]?.text||'...';
    removeAITyping();addAIMsg('bot',reply);
  }catch(e){
    removeAITyping();
    addAIMsg('bot',lang==='ar'?'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ù…ÙØªØ§Ø­ API.':'Sorry, an error occurred. Check your API key.');
  }
}

// â”€â”€â”€ ONBOARDING DATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function obSelectDate(type,btn){
  document.querySelectorAll('.ob-date-opt button').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  if(type==='today'){
    S.pendingStartDate=new Date().toISOString().split('T')[0];
    const inp=document.getElementById('ob-start-date');
    if(inp){inp.value=S.pendingStartDate;inp.style.opacity='.4';}
  }else{
    S.pendingStartDate=null;
    const inp=document.getElementById('ob-start-date');
    if(inp){inp.style.opacity='1';inp.focus();}
  }
}
function obDateChange(){
  const inp=document.getElementById('ob-start-date');
  if(inp&&inp.value)S.pendingStartDate=inp.value;
}

// â”€â”€â”€ INIT NEW FEATURES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initNewFeatures(){
  checkDND();
  setInterval(checkDND,60000);
  checkWeeklySummary();
  // Add AI button to bottom nav or header
  // Override startGuided to show sound modal first
  const _origStartGuided=startGuided;
  window._realStartGuided=_origStartGuided;
  // Hook startGuided to show sound modal first
const _realStartGuided2 = startGuided;
window.startGuided = function(day) { openSoundModal(day); };
  // Tutorial: show on first use after onboarding
  if(!S.tutorialDone){
    setTimeout(startTutorial,800);
  }
}

function addAIButton(){
  // Add AI coach button to header
  const hdrR=document.querySelector('.hdr-r');
  if(hdrR&&!document.getElementById('aiBtnHdr')){
    const btn=document.createElement('button');
    btn.id='aiBtnHdr';btn.className='hdr-ico';btn.textContent='ðŸ¤–';
    btn.onclick=openAI;btn.title='AI Coach';
    hdrR.insertBefore(btn,hdrR.firstChild);
  }
}

// Patch obFinish to save start date
const _origObFinish=typeof obFinish==='function'?obFinish:null;

// Update completion overlay to add redo button
const _origCloseComp=typeof closeComp==='function'?closeComp:null;
function openComp_enhanced(day){
  // Add redo button to completion overlay
  setTimeout(()=>{
    const compOv=document.getElementById('compOv');
    if(compOv&&!document.getElementById('redoDayBtn')){
      const lang=S.lang||'ar';
      const redoTxt={ar:'ðŸ” Ø£Ø¹Ø¯ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…',en:'ðŸ” Redo this day',fr:'ðŸ” Refaire ce jour'}[lang];
      const btn=document.createElement('button');
      btn.id='redoDayBtn';btn.className='redo-btn';btn.textContent=redoTxt;
      btn.onclick=()=>redoDay(day);
      compOv.querySelector('.comp-ov,.completion')?.appendChild(btn)||compOv.appendChild(btn);
    }
    // Vibrate on completion
    vibrate([100,50,200,50,300]);
    // Tab title
    updateTabTitle('âœ… '+(S.lang==='ar'?'Ø£Ø­Ø³Ù†Øª!':'Well Done!'));
    setTimeout(()=>updateTabTitle(''),5000);
  },500);
  startWaterReminder();
}

// â”€â”€â”€ OVERRIDE tAct to update tab title â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _origTAct=typeof tAct==='function'?tAct:null;


// â”€â”€â”€ CHALLENGE DURATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function obDur(days){
  document.querySelectorAll('[id^="dur-"]').forEach(b=>b.classList.remove('on'));
  const inp=document.getElementById('ob-custom-dur');
  if(days===0){
    document.getElementById('dur-custom').classList.add('on');
    if(inp)inp.style.display='block';
    S.challengeDays=+inp?.value||30;
  }else{
    const el=document.getElementById('dur-'+days);
    if(el)el.classList.add('on');
    if(inp)inp.style.display='none';
    S.challengeDays=days;
  }
  // Update subtitle
  const sub=document.getElementById('obs0');
  const lang=S.lang||'ar';
  const d=S.challengeDays||30;
  if(sub)sub.textContent=lang==='ar'?`ØªØ­Ø¯ÙŠ Ø§Ù„Ù„ÙŠØ§Ù‚Ø© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ© â€” ${d} ÙŠÙˆÙ…`:lang==='fr'?`DÃ©fi fitness â€” ${d} jours`:`Fitness Challenge â€” ${d} Days`;
}

// â”€â”€â”€ DYNAMIC PLAN GENERATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generatePlanForDays(numDays){
  const base=DEFAULT_PLAN.days; // 30-day base
  const days=[];
  for(let i=1;i<=numDays;i++){
    const base_day=base[(i-1)%30];
    // Progressive: increase sets/reps every 30-day cycle
    const cycle=Math.floor((i-1)/30);
    const d={...base_day,day:i,exercises:base_day.exercises.map(e=>({
      ...e,
      sets:Math.min(e.sets+cycle,6),
      reps:e.reps>0?Math.min(e.reps+cycle*3,50):0,
      dur:e.dur>0?Math.min(e.dur+cycle*15,180):0
    }))};
    days.push(d);
  }
  return days;
}

// â”€â”€â”€ TICK SOUND & SOUND SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let tickEnabled=true,tickVolume=0.15,tickFreq=800,tickIntervalId=null;
function playTick(){
  if(!tickEnabled||!soundOn)return;
  try{const ctx=getAC(),o=ctx.createOscillator(),g=ctx.createGain();
  const mv=(S.soundSettings?.vol||80)/100;
  o.connect(g);g.connect(ctx.destination);
  o.type='sine';o.frequency.value=tickFreq;
  g.gain.setValueAtTime(tickVolume*mv*0.4,ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.06);
  o.start();o.stop(ctx.currentTime+0.07);}catch(e){}
}
function startTickForTimer(){
  clearInterval(tickIntervalId);
  tickIntervalId=setInterval(()=>{if(TM&&TM.running)playTick();else stopTick();},1000);
}
function stopTick(){clearInterval(tickIntervalId);tickIntervalId=null;}
function openSoundSettings(){
  const el=document.getElementById('soundSettingsOv');if(!el)return;
  const ss=S.soundSettings||{};
  const ids={tickVol:Math.round((ss.tickVol||0.15)*100),tickFreqRange:ss.tickFreq||800,masterVolRange:ss.vol||80};
  Object.entries(ids).forEach(([id,val])=>{const e=document.getElementById(id);if(e)e.value=val;});
  const te=document.getElementById('tickEnabledCheck');if(te)te.checked=ss.tickEnabled!==false;
  tickEnabled=ss.tickEnabled!==false;tickVolume=(ss.tickVol||0.15);tickFreq=(ss.tickFreq||800);
  updateSndUI();el.classList.add('open');
}
function closeSoundSettings(){const el=document.getElementById('soundSettingsOv');if(el)el.classList.remove('open');}
function updateSndUI(){
  [['tickVol','tickVolVal','%'],['tickFreqRange','tickFreqVal','Hz'],['masterVolRange','masterVolVal','%']].forEach(([rid,vid,unit])=>{
    const r=document.getElementById(rid),v=document.getElementById(vid);
    if(r&&v)v.textContent=r.value+unit;
  });
  tickVolume=(+document.getElementById('tickVol')?.value||15)/100;
  tickFreq=+document.getElementById('tickFreqRange')?.value||800;
}
function saveSoundSettings(){
  const g=id=>document.getElementById(id);
  S.soundSettings={...(S.soundSettings||{}),
    tickVol:(+g('tickVol')?.value||15)/100,
    tickFreq:+g('tickFreqRange')?.value||800,
    tickEnabled:g('tickEnabledCheck')?.checked!==false,
    vol:+g('masterVolRange')?.value||80
  };
  tickEnabled=S.soundSettings.tickEnabled;tickVolume=S.soundSettings.tickVol;tickFreq=S.soundSettings.tickFreq;
  save();playTick();closeSoundSettings();
}

init();
</script>

<!-- SOUND SETTINGS OVERLAY -->
<div class="sound-modal" id="soundSettingsOv" style="z-index:9100">
  <div class="sound-box">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px">
      <div class="snd-title">ðŸ”Š Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª</div>
      <button onclick="closeSoundSettings()" style="padding:5px 10px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);color:var(--dim);border-radius:8px;cursor:pointer">âœ•</button>
    </div>
    <!-- Master Volume -->
    <div class="snd-row">
      <div class="snd-ico">ðŸ”Š</div>
      <div class="snd-info"><div class="si-name">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª Ø§Ù„ÙƒÙ„ÙŠ</div></div>
      <span id="masterVolVal" style="font-size:11px;color:var(--gold);min-width:35px;text-align:center">80%</span>
    </div>
    <input type="range" min="0" max="100" value="80" id="masterVolRange" class="vol-slider" style="width:100%;margin:4px 0 12px" oninput="updateSndUI()">
    <!-- Tick Sound -->
    <div class="snd-row">
      <div class="snd-ico">ðŸŽµ</div>
      <div class="snd-info"><div class="si-name">ØµÙˆØª Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Tick)</div><div class="si-desc">ØµÙˆØª Ø®ÙÙŠÙ Ù…Ø¹ ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø¤Ù‚Øª</div></div>
      <label class="snd-toggle"><input type="checkbox" id="tickEnabledCheck" checked onchange="tickEnabled=this.checked"><span class="snd-sl"></span></label>
    </div>
    <div style="padding:8px 0">
      <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--dim);margin-bottom:4px">
        <span>Ø­Ø¬Ù… Ø§Ù„ØµÙˆØª</span><span id="tickVolVal">15%</span>
      </div>
      <input type="range" min="1" max="100" value="15" id="tickVol" class="vol-slider" style="width:100%" oninput="updateSndUI()">
      <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--dim);margin:8px 0 4px">
        <span>Ø·Ø¨Ù‚Ø© Ø§Ù„ØµÙˆØª (Ù†Ø¨Ø±Ø©)</span><span id="tickFreqVal">800Hz</span>
      </div>
      <input type="range" min="300" max="1500" value="800" id="tickFreqRange" class="vol-slider" style="width:100%" oninput="updateSndUI()">
      <button onclick="playTick()" style="margin-top:8px;padding:6px 14px;background:rgba(212,168,67,.1);border:1px solid rgba(212,168,67,.3);color:var(--gold);border-radius:8px;font-size:11px;cursor:pointer">â–¶ ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØµÙˆØª</button>
    </div>
    <button onclick="saveSoundSettings()" class="snd-start-btn" style="margin-top:12px">ðŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
  </div>
</div>

</body>
</html>
